{"version":3,"mappings":"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","names":["cn","inputs","twMerge","clsx","avatarEmojis","productEmojis","bannerEmojis","getRandomAvatarEmoji","randomIndex","getConsistentEmoji","input","type","hash","acc","char","emojiList","index","API_BASE_URL","TIMEOUTS","CACHE_CONFIG","cache","key","ttl","item","data","handleApiError","error","message","statusCode","errorData","toast","createFetchOptions","method","body","timeout","controller","timeoutId","options","getTelegramWebApp","_a","initTelegramWebApp","miniApp","viewport","sdkError","webApp","setThemeClass","html","isDark","themeParams","getTelegramUser","_c","_b","user","e","showBackButton","callback","backButton","_d","hideBackButton","sendHapticFeedbackEvent","eventData","hapticImpact","style","hapticFeedback","hapticSelection","requestTelegramTheme","setTelegramColors","postEventError","setupThemeChangeListener","handleThemeChange","bgColor","secondaryBgColor","textColor","hintColor","linkColor","buttonColor","buttonTextColor","_e","_f","_g","_h","globalWebApp","_i","__vitePreload","postEvent","n","applyTelegramThemeCSS","mainBgColor","headerBgColor","isThemeDark","forcedMainBgColor","forcedHeaderBgColor","root","previousStyle","rootElement","bottomNavBar","openTelegramUrl","url","CACHE_KEYS","userId","userFromUtils","getTelegramUserFromUtils","checkUserExists","returnFullResponse","requestBody","clearTimeout","response","errorText","errorDetail","responseText","existsResponse","cacheKey","checkUserProfile","safeUserId","username","getDDCoinsBalance","cachedBalance","userResponse","balance","MOCK_PRODUCTS","fetchProducts","telegramUserId","cachedProducts","stockResponse","normalizedItems","price","photos","sizes","size","fetchCategories","cachedCategories","categoryResponse","fetchOrders","cachedOrders","ordersResponse","addProductToCart","productId","calculateShipping","priceCny","shippingType","category","userData","responseData","createUnifiedOrder","orderData","items","validCategoryTypes","validShippingTypes","requestData","fetchDeliveryTypes","getClientInfo","telegramId","safeId","clientInfo","updateClientInfo","phoneNumber","email","address","mailingFlg","REFERRAL_API_PATH","getUserReferralInfo","retryAttempt","newReferral","createReferralCode","referralInfo","getReferralStats","stats","shareReferralLink","clipboardError","registerReferral","referralCode","result","EXTENDED_CACHE","getCachedDDCoinsBalance","fetchInitialData","results","profile","orders","products","ddCoinsBalance","prefetchData","refreshUserData","profileCacheKey","ordersCacheKey","ddCoinsCacheKey","UserContext","createContext","UserProvider","children","telegramUser","setTelegramUser","useState","setUsername","displayName","setDisplayName","setProfile","avatarEmoji","setAvatarEmoji","loading","setLoading","initAttempted","setInitAttempted","updateTelegramUser","useCallback","fullName","usernameToUse","updateUserProfile","userProfile","defaultProfile","refreshAllUserData","rawUser","params","useEffect","telegramUserData","storedUser","apiUserData","getTelegramUserFromAPI","apiError","jsx","useUser","context","useContext","CartContext","CartProvider","setItems","itemCount","total","totalPrice","savedCart","addToCart","product","currentItems","existingItemIndex","updatedItems","addPreorderToCart","preorderItem","preorderId","removeFromCart","updateQuantity","quantity","getItemQuantity","clearCart","useCart","useReferral","setReferralCode","isProcessing","setIsProcessing","isProcessed","setIsProcessed","code","startParam","telegramCode","pathParts","pathCode","newPath","processedReferrals","useRegistration","isNewUser","setIsNewUser","isChecking","setIsChecking","hasChecked","setHasChecked","checkResponse","scrollToTop","scrollToTopWithRetries","timeouts","delay","managerBg","useScrollToTop","pathname","useLocation","cleanup","mainBanner","csBanner","ddCoinsBanner","calculatorBanner","shopBanner","sneakersBanner","clothesBanner","jeansBanner","beltBanner","stPreviewImage","stBeginnerGuide1","stBeginnerGuide2","stBeginnerGuide3","Home","navigate","useNavigate","setDDCoinsBalance","isLoadingDDCoins","setIsLoadingDDCoins","selectedStory","setSelectedStory","viewedStoryIds","setViewedStoryIds","stories","handleStoryClick","storyId","story","s","handleStoryViewed","prev","fetchDDCoins","banners","displayUsername","handleProfileClick","jsxs","PageLayout","UserAvatar","Stories","StoryViewer","BannerSwiper","Link","ArrowRight","LoadingSpinner","DDManagerCard","sortSizes","isNumeric","getLetterSizeValue","sizeMap","normalizedSize","numericSizes","letterSizes","sortedNumericSizes","a","b","sortedLetterSizes","CATEGORY_ORDER","Shop","searchParams","setSearchParams","useSearchParams","searchTerm","setSearchTerm","selectedSizes","setSelectedSizes","selectedBrands","setSelectedBrands","selectedCategories","setSelectedCategories","showFilters","setShowFilters","showSortOptions","setShowSortOptions","sortBy","setSortBy","isLoading","isError","refetch","useQuery","brandParam","categoryParam","sizeParam","searchParam","sortParam","newParams","availableSizes","useMemo","sizeObj","availableBrands","brands","availableCategories","categorySet","toggleSizeSelection","toggleBrandSelection","brand","toggleCategorySelection","c","filteredProducts","matchesSearch","matchesSize","matchesBrand","matchesCategory","clearFilters","removeSizeFilter","removeBrandFilter","removeCategoryFilter","hasActiveFilters","getCategoryOrder","sortedAndFilteredProducts","priceA","priceB","categoryOrderA","categoryOrderB","toggleSortOptions","handleSortChange","newSort","getSortLabel","sortType","ShoppingCart","Search","Filter","ArrowUpDown","X","option","Tag","ProductCard","ProductDetails","useParams","addItemToCart","selectedSize","setSelectedSize","p","productEmoji","currentQuantity","photoUrls","photo","getMaxAvailableQuantity","sizeInfo","handleAddToCart","tempProduct","handleIncreaseQuantity","handleDecreaseQuantity","handleViewCart","PhotoSwiper","SizeSelector","Fragment","ShoppingBag","Minus","Plus","TelegramContext","TelegramProvider","tg","contextValue","useTelegram","Profile","isRegistered","setIsRegistered","isInfoModalOpen","setIsInfoModalOpen","initWebApp","getUserData","retryUser","displayOrders","SettingsIcon","Coins","Info","ReferralCard","o","order","OrderCard","DDCoinsInfoModal","validatePromocode","promocodeText","calculateDiscountedPrice","originalPrice","promocode","finalPrice","percentageDiscount","Cart","isCreatingOrder","setIsCreatingOrder","isCheckingClientInfo","setIsCheckingClientInfo","showClientInfoForm","setShowClientInfoForm","currentPromocode","setCurrentPromocode","setFinalPrice","ddCoinsToUse","setDDCoinsToUse","selectedDeliveryRate","setSelectedDeliveryRate","setClientInfo","subtotal","sum","discountedPrice","calculatedPrice","maxDDCoinsToUse","finalPriceAfterDDCoins","handleDDCoinsChange","value","handlePromocodeApplied","handlePromocodeRemoved","handleCreateOrder","info","handleClientInfoComplete","deliveryRate","createOrderWithInfo","latestClientInfo","formattedItems","categoryType","ArrowLeft","CartItem","PromocodeInput","ClientInfoForm","NotFound","formatCategoryName","name","word","DeliveryCalculator","setPrice","itemType","setItemType","setShippingType","itemUrl","setItemUrl","setSize","isCalculating","setIsCalculating","isAddingToCart","setIsAddingToCart","categories","setCategories","isLoadingCategories","setIsLoadingCategories","priceError","setPriceError","urlError","setUrlError","setTotalPrice","fetchedCategories","shoesCategory","handleCalculate","apiCategoryType","mapToCategoryType","priceInCNY","shippingCost","internalCategory","handlePriceChange","handleUrlChange","extractedUrl","extractDewuUrl","cleanUrl","isValidUrl","text","urlPatterns","pattern","match","handleItemTypeChange","handleShippingTypeChange","Calculator","ExternalLink","Truck","Plane","Settings","setEmail","phone","setPhone","setAddress","setMailingFlg","isSubmitting","setIsSubmitting","setIsLoading","isSaving","setIsSaving","handleSubmit","ChevronLeft","Bell","Save","queryClient","QueryClient","TelegramInitializer","location","initialized","setInitialized","isProcessingReferral","isNew","cleanupThemeListener","checkUserInAPI","initializeTelegram","isTelegramBrowser","resolve","retryUserData","parsedUser","themeChangeHandler","App","ThemeProvider","QueryClientProvider","TooltipProvider","Toaster","HashRouter","ScrollToTop","Routes","Route","ReactDOM","React"],"ignoreList":[],"sources":["../../src/lib/utils.ts","../../src/utils/emojiUtils.ts","../../src/services/api/config.ts","../../src/utils/telegramUtils.ts","../../src/services/api/userService.ts","../../src/services/api/mockData.ts","../../src/services/api/productService.ts","../../src/services/api/orderService.ts","../../src/services/api/clientService.ts","../../src/services/api/referralService.ts","../../src/services/api/optimizedService.ts","../../src/contexts/UserContext.tsx","../../src/contexts/CartContext.tsx","../../src/hooks/useReferral.tsx","../../src/hooks/useRegistration.tsx","../../src/utils/scrollUtils.ts","../../src/assets/manager_banner.webp","../../src/hooks/useScrollToTop.ts","../../src/assets/jointgbanner.webp","../../src/assets/catsofa_banner.webp","../../src/assets/ddcoins_banner.webp","../../src/assets/calcbanner.webp","../../src/assets/gotoshopbanner.webp","../../src/assets/sneakers_category_banner.webp","../../src/assets/clothes_category_banner.webp","../../src/assets/jeans_category_banner.webp","../../src/assets/belt_category_banner.webp","../../src/assets/stories/guide_story_preview.png","../../src/assets/stories/story_rebuilt_1.png","../../src/assets/stories/Instagram story - 7.png","../../src/assets/stories/Instagram story - 8.png","../../src/pages/Home.tsx","../../src/utils/sizeUtils.ts","../../src/pages/Shop.tsx","../../src/pages/ProductDetails.tsx","../../src/contexts/TelegramContext.tsx","../../src/pages/Profile.tsx","../../src/services/api/promocodeService.ts","../../src/pages/Cart.tsx","../../src/pages/NotFound.tsx","../../src/pages/DeliveryCalculator.tsx","../../src/pages/Settings.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","\n// List of emojis that can be used as avatars\nconst avatarEmojis = [\n  '😀', '😃', '😄', '😁', '😆', '😅', '😂', '🤣', '😊', '😇',\n  '🙂', '🙃', '😉', '😌', '😍', '🥰', '😘', '😗', '😙', '😚',\n  '😋', '😛', '😝', '😜', '🤪', '🤨', '🧐', '🤓', '😎', '🤩',\n  '🥳', '😏', '😒', '😞', '😔', '😟', '😕', '🙁', '☹️', '😣',\n  '😖', '😫', '😩', '🥺', '😢', '😭', '😤', '😠', '😡', '🤬',\n  '🤯', '😳', '🥵', '🥶', '😱', '😨', '😰', '😥', '😓', '🤗',\n  '🤔', '🤭', '🤫', '🤥', '😶', '😐', '😑', '😬', '🙄', '😯',\n];\n\n// List of emojis that can be used as product placeholders\nconst productEmojis = [\n  '👕', '👚', '👔', '👗', '👖', '🧥', '🧦', '👟', '👞', '🧢',\n  '👒', '🎩', '🧣', '🧤', '👜', '👝', '👛', '👓', '🕶️', '🥾',\n  '🥿', '🌂', '☂️', '💼', '🎒', '👑', '💄', '💍', '💎', '⌚',\n  '🧸', '🔮', '🧩', '🧶', '🧵', '🔭', '🧬', '🔬', '🧪', '📱',\n  '💻', '🖥️', '🖱️', '🖨️', '📷', '🎮', '🎧', '🎵', '📚', '✏️',\n];\n\n// List of emojis for banners\nconst bannerEmojis = [\n  '🎉', '🎊', '🎁', '🎈', '🎀', '🎐', '🎇', '🎆', '✨', '🔥',\n  '💫', '⭐', '🌟', '💥', '💯', '💢', '💦', '💤', '💨', '🕊️',\n  '💝', '💖', '💗', '💓', '💞', '💕', '❤️', '🧡', '💛', '💚',\n];\n\n/**\n * Generates a random emoji from the avatar emoji list\n * @returns a random avatar emoji\n */\nexport const getRandomAvatarEmoji = (): string => {\n  const randomIndex = Math.floor(Math.random() * avatarEmojis.length);\n  return avatarEmojis[randomIndex];\n};\n\n/**\n * Generates a random emoji from the product emoji list\n * @returns a random product emoji\n */\nexport const getRandomProductEmoji = (): string => {\n  const randomIndex = Math.floor(Math.random() * productEmojis.length);\n  return productEmojis[randomIndex];\n};\n\n/**\n * Generates a random emoji from the banner emoji list\n * @returns a random banner emoji\n */\nexport const getRandomBannerEmoji = (): string => {\n  const randomIndex = Math.floor(Math.random() * bannerEmojis.length);\n  return bannerEmojis[randomIndex];\n};\n\n/**\n * Generates a consistent emoji based on a string input\n * @param input String to generate emoji from\n * @returns emoji\n */\nexport const getConsistentEmoji = (input: string, type: 'avatar' | 'product' | 'banner'): string => {\n  // Simple hash function for the input string\n  const hash = Array.from(input).reduce((acc, char) => {\n    return acc + char.charCodeAt(0);\n  }, 0);\n  \n  // Get the appropriate emoji list\n  const emojiList = type === 'avatar' \n    ? avatarEmojis \n    : type === 'product' \n      ? productEmojis \n      : bannerEmojis;\n  \n  // Use the hash to get a consistent index\n  const index = hash % emojiList.length;\n  \n  return emojiList[index];\n};\n","import { toast } from 'sonner';\n\n// API configuration\nexport const API_BASE_URL = 'https://v2786182.hosted-by-vdsina.ru/api/v1';\n\n// Increased timeout configuration for different API calls\nexport const TIMEOUTS = {\n  PRODUCTS: 15000, // 15 seconds (increased from 10)\n  ORDERS: 12000,   // 12 seconds (increased from 8)\n  PROFILE: 12000   // 12 seconds (increased from 8)\n};\n\n// Cache configuration\nexport const CACHE_CONFIG = {\n  PRODUCTS_TTL: 5 * 60 * 1000, // 5 minutes\n  PROFILE_TTL: 10 * 60 * 1000, // 10 minutes\n  ORDERS_TTL: 3 * 60 * 1000,   // 3 minutes\n};\n\n// Cache storage\ninterface CacheItem<T> {\n  data: T;\n  timestamp: number;\n}\n\n// Cache management\nexport const cache = {\n  _store: new Map<string, CacheItem<any>>(),\n  \n  get<T>(key: string, ttl: number): T | null {\n    const item = this._store.get(key);\n    if (!item) return null;\n    \n    const now = Date.now();\n    if (now - item.timestamp > ttl) {\n      // Cache expired\n      this._store.delete(key);\n      return null;\n    }\n    \n    return item.data as T;\n  },\n  \n  set<T>(key: string, data: T): void {\n    this._store.set(key, {\n      data,\n      timestamp: Date.now()\n    });\n  },\n  \n  invalidate(key: string): void {\n    this._store.delete(key);\n  },\n  \n  clear(): void {\n    this._store.clear();\n  }\n};\n\n// Helper function to handle API errors with detailed error messages\nexport const handleApiError = (error: any) => {\n  console.error('API Error:', error);\n  let message = 'An error occurred. Please try again.';\n  \n  if (error.response) {\n    // Server responded with an error status code\n    const statusCode = error.response.status;\n    \n    // Try to extract error detail from response\n    try {\n      const errorData = error.response.data;\n      if (errorData && errorData.detail) {\n        message = `API Error (${statusCode}): ${errorData.detail}`;\n      } else {\n        message = `API Error (${statusCode}): ${error.response.statusText}`;\n      }\n    } catch (e) {\n      message = `API Error (${statusCode}): Could not parse error details`;\n    }\n  } else if (error.request) {\n    // Request made but no response received\n    message = 'Network Error: No response from server. Using cached data instead.';\n  } else if (error instanceof Error) {\n    // Something else went wrong\n    message = `Error: ${error.message}`;\n  }\n  \n  if (message.includes('Using cached data')) {\n    toast.info(message);\n  } else {\n    toast.error(message);\n  }\n  \n  return Promise.reject(new Error(message));\n};\n\n// Helper function to create fetch options with proper headers and timeout\nexport const createFetchOptions = (\n  method: string = 'GET', \n  body?: any, \n  timeout: number = TIMEOUTS.PRODUCTS\n): { \n  signal: AbortSignal, \n  options: RequestInit,\n  clearTimeout: () => void \n} => {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\n  \n  const options: RequestInit = {\n    method,\n    signal: controller.signal,\n    mode: 'cors',\n    headers: {\n      'Accept': 'application/json',\n      ...(body ? { 'Content-Type': 'application/json' } : {})\n    },\n    ...(body ? { body: JSON.stringify(body) } : {})\n  };\n  \n  return {\n    signal: controller.signal,\n    options,\n    clearTimeout: () => clearTimeout(timeoutId)\n  };\n};\n","import { miniApp, hapticFeedback, backButton, mainButton, themeParams, viewport, retrieveLaunchParams, type LaunchParams } from '@telegram-apps/sdk';\n\n// Define RGB type for Telegram colors\nexport type RGB = `#${string}`;\n\n// Re-export the TelegramUser type from our central type definition\nexport interface TelegramUser {\n  id: number;\n  first_name: string;\n  last_name?: string;\n  username?: string;\n  language_code?: string;\n  is_premium?: boolean;\n  photo_url?: string;\n  allows_write_to_pm?: boolean;\n}\n\n// Define theme parameters interface\ninterface ThemeParams {\n  bg_color?: string;\n  text_color?: string;\n  hint_color?: string;\n  link_color?: string;\n  button_color?: string;\n  button_text_color?: string;\n  secondary_bg_color?: string;\n}\n\n// Define event types for Telegram WebApp\ntype TelegramEventType = 'themeChanged' | 'viewportChanged' | 'mainButtonClicked';\n\n// Define the complete TelegramWebApp interface\ninterface TelegramWebApp {\n  ready: () => void;\n  expand: () => void;\n  close: () => void;\n  onEvent: (eventType: TelegramEventType, eventHandler: () => void) => void;\n  offEvent: (eventType: TelegramEventType, eventHandler: () => void) => void;\n  sendData: (data: string) => void;\n  postEvent: (eventType: string, eventData?: string) => void;\n  themeParams: ThemeParams;\n  colorScheme: 'light' | 'dark';\n  initDataUnsafe?: {\n    user?: TelegramUser;\n  };\n  // Optional method that might be available in some Telegram clients\n  setHeaderColor?: (color: string) => void;\n  setBackgroundColor?: (color: string) => void;\n  openLink: (url: string, options?: { try_instant_view?: boolean }) => void;\n}\n\n/**\n * Helper function to safely access the Telegram WebApp instance\n * @returns The Telegram WebApp instance or undefined if not available\n */\nexport function getTelegramWebApp(): TelegramWebApp | undefined {\n  if (typeof window !== 'undefined' && window.Telegram?.WebApp) {\n    // Cast to unknown first to avoid type checking, then to our interface\n    // This is safe because we know the actual implementation has these methods\n    return window.Telegram.WebApp as unknown as TelegramWebApp;\n  }\n  return undefined;\n}\n\n/**\n * Initialize the Telegram WebApp\n * This must be called before any other Telegram WebApp functions\n */\nexport function initTelegramWebApp(): void {\n  try {\n    console.log(\"Initializing Telegram WebApp...\");\n    \n    // Try SDK method first\n    try {\n      // Tell Telegram the WebApp is ready\n      miniApp.ready();\n      \n      // Expand the WebApp to full height\n      viewport.expand();\n      \n      console.log(\"Telegram WebApp initialized successfully using SDK\");\n    } catch (sdkError) {\n      console.warn(\"SDK initialization failed, falling back to direct WebApp API:\", sdkError);\n      \n      // Fallback to direct WebApp API\n      const webApp = getTelegramWebApp();\n      if (webApp) {\n        webApp.ready();\n        webApp.expand();\n        console.log(\"Telegram WebApp initialized successfully using direct WebApp API\");\n      } else {\n        throw new Error(\"Telegram WebApp is not available\");\n      }\n    }\n  } catch (error) {\n    console.error(\"Error initializing Telegram WebApp:\", error);\n  }\n}\n\n/**\n * Set the HTML class based on Telegram's color scheme\n */\nexport function setThemeClass(): void {\n  try {\n    const html = document.documentElement;\n    \n    // Add telegram-webview class to html element\n    html.classList.add('telegram-webview');\n    \n    // Get isDark from SDK or WebApp\n    const webApp = getTelegramWebApp();\n    const isDark = themeParams.isDark || webApp?.colorScheme === 'dark';\n    \n    // Set dark/light class based on Telegram's theme\n    if (isDark) {\n      html.classList.add('dark');\n      html.classList.remove('light');\n    } else {\n      html.classList.add('light');\n      html.classList.remove('dark');\n    }\n    \n    console.log(`Theme set to ${isDark ? 'dark' : 'light'} mode`);\n  } catch (error) {\n    console.error(\"Error setting theme class:\", error);\n  }\n}\n\n/**\n * Force the Telegram mini app to use a dark gray theme\n */\nexport function setDarkGrayTheme(): void {\n  try {\n    console.log(\"Setting dark gray theme for Telegram mini app\");\n    \n    // Get the root element\n    const root = document.documentElement;\n    const darkGrayColor = \"#232730\";\n    const darkGraySecondaryColor = \"#2c313c\";\n    \n    // Force dark gray theme regardless of user's Telegram theme\n    // Apply directly to HTML element\n    root.style.backgroundColor = darkGrayColor;\n    \n    // Force dark class\n    root.classList.add('dark');\n    root.classList.remove('light');\n    root.classList.add('telegram-webview');\n    \n    // Set CSS variables for Telegram colors - use !important to override any other styles\n    const style = document.createElement('style');\n    style.textContent = `\n      :root {\n        --tg-theme-bg-color: ${darkGrayColor} !important;\n        --tg-theme-secondary-bg-color: ${darkGraySecondaryColor} !important;\n        --tg-theme-text-color: #ffffff !important;\n        --tg-theme-hint-color: #7d7d7d !important;\n        --tg-theme-link-color: #64baff !important;\n        --tg-theme-button-color: #3390ec !important;\n        --tg-theme-button-text-color: #ffffff !important;\n        --tg-color-scheme: dark !important;\n        \n        --telegram-bg: ${darkGrayColor} !important;\n        --telegram-secondary-bg: ${darkGraySecondaryColor} !important;\n        --telegram-text: #ffffff !important;\n      }\n      \n      body, html, #root {\n        background-color: ${darkGrayColor} !important;\n        color: #ffffff !important;\n      }\n      \n      .dark body, .dark html, .dark #root {\n        background-color: ${darkGrayColor} !important;\n      }\n    `;\n    \n    // Add the style element to the head\n    document.head.appendChild(style);\n    \n    // Also set individual CSS variables\n    root.style.setProperty('--tg-theme-bg-color', darkGrayColor, 'important');\n    root.style.setProperty('--tg-theme-secondary-bg-color', darkGraySecondaryColor, 'important');\n    root.style.setProperty('--tg-theme-text-color', '#ffffff', 'important');\n    root.style.setProperty('--tg-theme-hint-color', '#7d7d7d', 'important');\n    root.style.setProperty('--tg-theme-link-color', '#64baff', 'important');\n    root.style.setProperty('--tg-color-scheme', 'dark', 'important');\n    \n    // Apply the background color to all main elements\n    document.body.style.backgroundColor = darkGrayColor;\n    document.body.style.setProperty('background-color', darkGrayColor, 'important');\n    \n    if (document.getElementById('root')) {\n      const rootElement = document.getElementById('root')!;\n      rootElement.style.backgroundColor = darkGrayColor;\n      rootElement.style.setProperty('background-color', darkGrayColor, 'important');\n    }\n    \n    // Try to override Telegram's theme params if possible\n    if (window.Telegram?.WebApp) {\n      try {\n        // This is a hack to try to override Telegram's theme\n        const webApp = window.Telegram.WebApp as any;\n        if (webApp._themeParams) {\n          webApp._themeParams.bg_color = darkGrayColor;\n          webApp._themeParams.secondary_bg_color = darkGraySecondaryColor;\n        }\n      } catch (e) {\n        console.error(\"Error trying to override Telegram theme params:\", e);\n      }\n    }\n    \n    console.log(\"Dark gray theme applied to Telegram mini app\");\n  } catch (error) {\n    console.error(\"Error setting dark gray theme:\", error);\n  }\n}\n\n/**\n * Sync the app's theme with Telegram's theme\n */\nexport function syncTelegramTheme(): void {\n  try {\n    // Get CSS variables from Telegram theme\n    const root = document.documentElement;\n    \n    // Set CSS variables for Telegram colors\n    if (themeParams.backgroundColor) {\n      root.style.setProperty('--tg-theme-bg-color', String(themeParams.backgroundColor));\n    }\n    \n    if (themeParams.textColor) {\n      root.style.setProperty('--tg-theme-text-color', String(themeParams.textColor));\n    }\n    \n    if (themeParams.hintColor) {\n      root.style.setProperty('--tg-theme-hint-color', String(themeParams.hintColor));\n    }\n    \n    if (themeParams.linkColor) {\n      root.style.setProperty('--tg-theme-link-color', String(themeParams.linkColor));\n    }\n    \n    if (themeParams.buttonColor) {\n      root.style.setProperty('--tg-theme-button-color', String(themeParams.buttonColor));\n    }\n    \n    if (themeParams.buttonTextColor) {\n      root.style.setProperty('--tg-theme-button-text-color', String(themeParams.buttonTextColor));\n    }\n    \n    if (themeParams.secondaryBackgroundColor) {\n      root.style.setProperty('--tg-theme-secondary-bg-color', String(themeParams.secondaryBackgroundColor));\n    }\n    \n    // Set color scheme\n    root.style.setProperty('--tg-color-scheme', themeParams.isDark ? 'dark' : 'light');\n    \n    console.log(\"Theme synchronized with Telegram\");\n  } catch (error) {\n    console.error(\"Error syncing theme:\", error);\n  }\n}\n\n/**\n * Listen for theme changes from Telegram\n * @returns Cleanup function\n */\nexport function listenForThemeChanges(): () => void {\n  try {\n    const themeChangeHandler = () => {\n      console.log(\"Theme changed, updating...\");\n      setThemeClass();\n      syncTelegramTheme();\n    };\n    \n    // Add event listener for theme changes\n    window.addEventListener('themechange', themeChangeHandler);\n    \n    // Return cleanup function\n    return () => {\n      window.removeEventListener('themechange', themeChangeHandler);\n    };\n  } catch (error) {\n    console.error(\"Error setting up theme change listener:\", error);\n    return () => {}; // Return empty cleanup function\n  }\n}\n\n/**\n * Get the Telegram user data\n * @returns User data or null if not available\n */\nexport function getTelegramUser(): TelegramUser | null {\n  try {\n    console.log(\"Attempting to get Telegram user data...\");\n    \n    // APPROACH 1: Use the official SDK method to retrieve launch parameters\n    // try {\n    //   const { initData, user } = retrieveLaunchParams();\n      \n    //   if (user) {\n    //     console.log(\"User data found in launch parameters:\", user);\n        \n    //     // Store in localStorage for future use\n    //     try {\n    //       localStorage.setItem('telegramUser', JSON.stringify(user));\n    //     } catch (e) {\n    //       console.error(\"Error storing user data in localStorage:\", e);\n    //     }\n        \n    //     return user as TelegramUser;\n    //   } else {\n    //     console.log(\"No user data in launch parameters\");\n    //   }\n    // } catch (e) {\n    //   console.error(\"Error retrieving launch parameters:\", e);\n    // }\n    \n    // APPROACH 2: Directly access window.Telegram.WebApp.initDataUnsafe\n    if (window.Telegram?.WebApp?.initDataUnsafe?.user) {\n      const user = window.Telegram.WebApp.initDataUnsafe.user;\n      console.log(\"User data found in window.Telegram.WebApp.initDataUnsafe:\", user);\n      \n      // Store in localStorage for future use\n      try {\n        localStorage.setItem('telegramUser', JSON.stringify(user));\n      } catch (e) {\n        console.error(\"Error storing user data in localStorage:\", e);\n      }\n      \n      return user as TelegramUser;\n    }\n    \n    // APPROACH 3: Try to parse initData directly if it exists\n    // if (window.Telegram?.WebApp?.initData) {\n    //   try {\n    //     const params = new URLSearchParams(window.Telegram.WebApp.initData);\n    //     console.log('Parsed initData params:', Array.from(params.entries()));\n        \n    //     if (params.has('user')) {\n    //       try {\n    //         const userData = JSON.parse(decodeURIComponent(params.get('user') || '{}'));\n    //         console.log('User data parsed from initData:', userData);\n            \n    //         // Store in localStorage for future use\n    //         try {\n    //           localStorage.setItem('telegramUser', JSON.stringify(userData));\n    //         } catch (e) {\n    //           console.error(\"Error storing user data in localStorage:\", e);\n    //         }\n            \n    //         return userData as TelegramUser;\n    //       } catch (e) {\n    //         console.error('Error parsing user data from initData:', e);\n    //       }\n    //     } else {\n    //       console.log('No user param in initData');\n    //     }\n    //   } catch (e) {\n    //     console.error('Error parsing initData:', e);\n    //   }\n    // }\n    \n    // APPROACH 4: Fallback to localStorage as a last resort\n    // try {\n    //   const storedUser = localStorage.getItem('telegramUser');\n    //   if (storedUser) {\n    //     const userData = JSON.parse(storedUser);\n    //     console.log(\"Using stored user data from localStorage:\", userData);\n    //     return userData as TelegramUser;\n    //   }\n    // } catch (e) {\n    //   console.error(\"Error retrieving user data from localStorage:\", e);\n    // }\n    \n    console.log(\"No Telegram user data available from any source\");\n    return null;\n  } catch (error) {\n    console.error(\"Error getting Telegram user:\", error);\n  return null;\n  }\n}\n\n/**\n * Show the back button in the header\n * @param callback Function to call when back button is clicked\n */\nexport function showBackButton(callback: () => void): void {\n  try {\n    console.log(\"Showing back button\");\n    \n    // First, make sure any existing handlers are removed\n    try {\n      backButton.offClick(() => {});\n    } catch (e) {\n      console.log(\"No existing back button handlers to remove\");\n    }\n    \n    // Set the callback first\n    backButton.onClick(callback);\n    \n    // Then show the back button\n    backButton.show();\n    \n    // Also try the direct WebApp API as fallback\n    if (window.Telegram?.WebApp?.BackButton) {\n      try {\n        window.Telegram.WebApp.BackButton.onClick(callback);\n        window.Telegram.WebApp.BackButton.show();\n      } catch (e) {\n        console.error(\"Error using direct WebApp API for back button:\", e);\n      }\n    }\n    \n    console.log(\"Back button shown and callback registered\");\n  } catch (error) {\n    console.error(\"Error showing back button:\", error);\n    \n    // Try direct WebApp API as fallback\n    if (window.Telegram?.WebApp?.BackButton) {\n      try {\n        window.Telegram.WebApp.BackButton.onClick(callback);\n        window.Telegram.WebApp.BackButton.show();\n        console.log(\"Back button shown using direct WebApp API\");\n      } catch (e) {\n        console.error(\"Error using direct WebApp API for back button:\", e);\n      }\n    }\n  }\n}\n\n/**\n * Hide the back button in the header\n */\nexport function hideBackButton(): void {\n  try {\n    console.log(\"Hiding back button\");\n    \n    // Hide the back button\n    backButton.hide();\n    \n    // Also try the direct WebApp API as fallback\n    if (window.Telegram?.WebApp?.BackButton) {\n      try {\n        window.Telegram.WebApp.BackButton.hide();\n      } catch (e) {\n        console.error(\"Error using direct WebApp API to hide back button:\", e);\n      }\n    }\n    \n    console.log(\"Back button hidden\");\n  } catch (error) {\n    console.error(\"Error hiding back button:\", error);\n    \n    // Try direct WebApp API as fallback\n    if (window.Telegram?.WebApp?.BackButton) {\n      try {\n        window.Telegram.WebApp.BackButton.hide();\n        console.log(\"Back button hidden using direct WebApp API\");\n      } catch (e) {\n        console.error(\"Error using direct WebApp API to hide back button:\", e);\n      }\n    }\n  }\n}\n\n/**\n * Show the main button at the bottom of the screen\n * @param text Button text\n * @param onClick Callback function\n * @param color Optional background color\n * @param textColor Optional text color\n */\nexport function showMainButton(\n  text: string,\n  onClick: () => void,\n  color?: RGB,\n  textColor?: RGB\n): void {\n  try {\n    // Set button parameters\n    const params: Record<string, any> = {\n      text: text,\n      isVisible: true\n    };\n    \n    if (color) {\n      params.backgroundColor = color;\n    }\n    \n    if (textColor) {\n      params.textColor = textColor;\n    }\n    \n    // Update button with parameters\n    mainButton.setParams(params);\n    \n    // Set click handler\n    mainButton.onClick(onClick);\n    \n    console.log(\"Main button shown with text:\", text);\n  } catch (error) {\n    console.error(\"Error showing main button:\", error);\n  }\n}\n\n/**\n * Hide the main button\n */\nexport function hideMainButton(): void {\n  try {\n    // Hide the button\n    mainButton.setParams({ isVisible: false });\n    \n    console.log(\"Main button hidden\");\n  } catch (error) {\n    console.error(\"Error hiding main button:\", error);\n  }\n}\n\n/**\n * Enable the main button\n */\nexport function enableMainButton(): void {\n  try {\n    mainButton.setParams({ isEnabled: true });\n    console.log(\"Main button enabled\");\n  } catch (error) {\n    console.error(\"Error enabling main button:\", error);\n  }\n}\n\n/**\n * Disable the main button\n */\nexport function disableMainButton(): void {\n  try {\n    mainButton.setParams({ isEnabled: false });\n    console.log(\"Main button disabled\");\n  } catch (error) {\n    console.error(\"Error disabling main button:\", error);\n  }\n}\n\n/**\n * Show loading indicator on the main button\n */\nexport function showMainButtonLoader(): void {\n  try {\n    mainButton.setParams({ isLoaderVisible: true });\n    console.log(\"Main button loader shown\");\n  } catch (error) {\n    console.error(\"Error showing main button loader:\", error);\n  }\n}\n\n/**\n * Hide loading indicator on the main button\n */\nexport function hideMainButtonLoader(): void {\n  try {\n    mainButton.setParams({ isLoaderVisible: false });\n    console.log(\"Main button loader hidden\");\n  } catch (error) {\n    console.error(\"Error hiding main button loader:\", error);\n  }\n}\n\n/**\n * Helper function to send haptic feedback events to Telegram\n * @param eventData The event data to send\n */\nfunction sendHapticFeedbackEvent(eventData: Record<string, unknown>): void {\n  try {\n    const webApp = getTelegramWebApp();\n    \n    // Different ways to send events in different Telegram clients\n    if (webApp?.postEvent) {\n      webApp.postEvent('web_app_trigger_haptic_feedback', JSON.stringify(eventData));\n    } else if (window.Telegram?.WebviewProxy?.postEvent) {\n      window.Telegram.WebviewProxy.postEvent('web_app_trigger_haptic_feedback', JSON.stringify(eventData));\n    } else if (window.TelegramWebviewProxy?.postEvent) {\n      window.TelegramWebviewProxy.postEvent('web_app_trigger_haptic_feedback', JSON.stringify(eventData));\n    } else {\n      console.warn(\"No method available to send haptic feedback event\");\n    }\n  } catch (error) {\n    console.error(\"Error sending haptic feedback event:\", error);\n  }\n}\n\n/**\n * Trigger haptic feedback\n * @param style Feedback style\n */\nexport function triggerHapticFeedback(\n  style: 'impact' | 'notification' | 'selection' = 'impact'\n): void {\n  try {\n    // Try SDK method first\n    try {\n      switch (style) {\n        case 'impact':\n          hapticFeedback.impactOccurred('medium');\n          break;\n        case 'notification':\n          hapticFeedback.notificationOccurred('success');\n          break;\n        case 'selection':\n          hapticFeedback.selectionChanged();\n          break;\n        default:\n          hapticFeedback.impactOccurred('medium');\n      }\n      console.log(`Haptic feedback triggered via SDK: ${style}`);\n    } catch (sdkError) {\n      console.warn(\"SDK haptic feedback failed, falling back to direct WebApp API:\", sdkError);\n      \n      // Fallback to direct WebApp API\n      switch (style) {\n        case 'impact':\n          sendHapticFeedbackEvent({ type: 'impact', impact_style: 'medium' });\n          break;\n        case 'notification':\n          sendHapticFeedbackEvent({ type: 'notification', notification_type: 'success' });\n          break;\n        case 'selection':\n          sendHapticFeedbackEvent({ type: 'selection_change' });\n          break;\n        default:\n          sendHapticFeedbackEvent({ type: 'impact', impact_style: 'medium' });\n      }\n      console.log(`Haptic feedback triggered via WebApp API: ${style}`);\n    }\n  } catch (error) {\n    console.error(\"Error triggering haptic feedback:\", error);\n  }\n}\n\n/**\n * Trigger haptic impact feedback\n * @param style Impact style\n */\nexport const hapticImpact = (style: 'light' | 'medium' | 'heavy' | 'rigid' | 'soft' = 'medium'): void => {\n  try {\n    // Try SDK method first\n    try {\n      hapticFeedback.impactOccurred(style);\n      console.log(`Haptic impact triggered via SDK: ${style}`);\n    } catch (sdkError) {\n      console.warn(\"SDK haptic impact failed, falling back to direct WebApp API:\", sdkError);\n      \n      // Fallback to direct WebApp API\n      sendHapticFeedbackEvent({ type: 'impact', impact_style: style });\n      console.log(`Haptic impact triggered via WebApp API: ${style}`);\n    }\n  } catch (error) {\n    console.error(\"Error triggering haptic impact:\", error);\n  }\n};\n\n/**\n * Trigger haptic notification feedback\n * @param type Notification type\n */\nexport const hapticNotification = (type: 'error' | 'success' | 'warning' = 'success'): void => {\n  try {\n    // Try SDK method first\n    try {\n      hapticFeedback.notificationOccurred(type);\n      console.log(`Haptic notification triggered via SDK: ${type}`);\n    } catch (sdkError) {\n      console.warn(\"SDK haptic notification failed, falling back to direct WebApp API:\", sdkError);\n      \n      // Fallback to direct WebApp API\n      sendHapticFeedbackEvent({ type: 'notification', notification_type: type });\n      console.log(`Haptic notification triggered via WebApp API: ${type}`);\n    }\n  } catch (error) {\n    console.error(\"Error triggering haptic notification:\", error);\n  }\n};\n\n/**\n * Trigger haptic selection feedback\n */\nexport const hapticSelection = (): void => {\n  try {\n    // Try SDK method first\n    try {\n      hapticFeedback.selectionChanged();\n      console.log(\"Haptic selection triggered via SDK\");\n    } catch (sdkError) {\n      console.warn(\"SDK haptic selection failed, falling back to direct WebApp API:\", sdkError);\n      \n      // Fallback to direct WebApp API\n      sendHapticFeedbackEvent({ type: 'selection_change' });\n      console.log(\"Haptic selection triggered via WebApp API\");\n    }\n  } catch (error) {\n    console.error(\"Error triggering haptic selection:\", error);\n  }\n};\n\n/**\n * Send data to the Telegram bot\n * @param data Data to send\n */\nexport async function sendDataToBot(data: any): Promise<void> {\n  try {\n    // Convert data to string if it's an object\n    const dataToSend = typeof data === 'object' ? JSON.stringify(data) : String(data);\n    \n    // Use the WebApp API directly since the SDK doesn't expose sendData\n    if (window.Telegram?.WebApp) {\n      window.Telegram.WebApp.sendData(dataToSend);\n      console.log(\"Data sent to bot:\", dataToSend);\n    } else {\n      throw new Error(\"Telegram WebApp is not available\");\n    }\n  } catch (error) {\n    console.error(\"Error sending data to bot:\", error);\n    throw error;\n  }\n}\n\n/**\n * Close the WebApp\n */\nexport function closeWebApp(): void {\n  try {\n    miniApp.close();\n    console.log(\"WebApp closed\");\n  } catch (error) {\n    console.error(\"Error closing WebApp:\", error);\n  }\n}\n\n/**\n * Request the current theme from Telegram\n * This will trigger a theme_changed event with the current theme\n */\nexport function requestTelegramTheme(): void {\n  try {\n    console.log(\"Requesting current theme from Telegram\");\n    \n    // Try the SDK method first (avoiding update method that doesn't exist)\n    try {\n      // Read the current theme params - this will trigger a refresh in some SDK versions\n      const isDark = themeParams.isDark;\n      console.log(\"Using current theme params, isDark:\", isDark);\n      return;\n    } catch (sdkError) {\n      console.warn(\"SDK theme params access failed, trying fallback method:\", sdkError);\n    }\n    \n    // Fallback to direct WebApp API\n    const webApp = getTelegramWebApp();\n    if (!webApp) {\n      console.warn(\"Telegram WebApp is not available, can't request theme\");\n      return;\n    }\n    \n    // Check if postEvent is available and is a function\n    if (typeof webApp.postEvent !== 'function') {\n      console.warn(\"postEvent is not available in this Telegram client\");\n      // Just use the current theme params instead of trying to update\n      setTelegramColors();\n      return;\n    }\n    \n    // Try to request theme using postEvent\n    try {\n      webApp.postEvent(\"web_app_request_theme\");\n      console.log(\"Theme request sent successfully\");\n    } catch (postEventError) {\n      console.warn(\"Error requesting theme using postEvent:\", postEventError);\n      // Just use the current theme params instead\n      setTelegramColors();\n    }\n  } catch (error) {\n    console.error(\"Error requesting Telegram theme:\", error);\n    // Ensure we at least have some colors set\n    setTelegramColors();\n  }\n}\n\n/**\n * Setup theme change listener for instant theme updates\n * This should be called once when the app initializes\n * @returns Cleanup function to remove the listener\n */\nexport function setupThemeChangeListener(): () => void {\n  console.log(\"Setting up theme change listener for instant updates\");\n  \n  // Function to handle theme changes\n  const handleThemeChange = () => {\n    console.log(\"Theme change detected, updating colors and styles\");\n    setThemeClass();\n    setTelegramColors();\n  };\n  \n  // Get the WebApp instance\n  const webApp = getTelegramWebApp();\n  \n  if (webApp) {\n    try {\n      // Use Telegram's onEvent method for theme changes\n      webApp.onEvent('themeChanged', handleThemeChange);\n      \n      // Also listen for the standard themechange event as backup\n      window.addEventListener('themechange', handleThemeChange);\n      \n      // Return cleanup function\n      return () => {\n        try {\n          webApp.offEvent('themeChanged', handleThemeChange);\n        } catch (e) {\n          console.warn(\"Error removing Telegram theme listener:\", e);\n        }\n        window.removeEventListener('themechange', handleThemeChange);\n      };\n    } catch (error) {\n      console.error(\"Error setting up Telegram event listener:\", error);\n      \n      // Fallback to just window event listener\n      window.addEventListener('themechange', handleThemeChange);\n      return () => {\n        window.removeEventListener('themechange', handleThemeChange);\n      };\n    }\n  }\n  \n  // If no WebApp, just use window event\n  window.addEventListener('themechange', handleThemeChange);\n  return () => {\n    window.removeEventListener('themechange', handleThemeChange);\n  };\n}\n\n/**\n * Set the Telegram Mini App header and background colors based on the user's Telegram theme\n * Uses the official Telegram Mini Apps methods and applies Telegram's actual theme colors\n */\nexport function setTelegramColors(): void {\n  try {\n    console.log(\"Setting Telegram Mini App colors based on Telegram's native theme\");\n    \n    // Get the WebApp instance\n    const webApp = getTelegramWebApp();\n    \n    // Get theme colors from WebApp or SDK\n    let bgColor: RGB;\n    let secondaryBgColor: RGB;\n    let textColor: RGB;\n    let hintColor: RGB;\n    let linkColor: RGB;\n    let buttonColor: RGB;\n    let buttonTextColor: RGB;\n    let isDark: boolean;\n    \n    if (webApp) {\n      console.log(\"WebApp theme params:\", webApp.themeParams);\n      \n      // Use Telegram's native theme parameters directly\n      bgColor = (webApp.themeParams?.bg_color || (webApp.colorScheme === 'dark' ? '#271a28' : '#ffffff')) as RGB;\n      secondaryBgColor = (webApp.themeParams?.secondary_bg_color || (webApp.colorScheme === 'dark' ? '#382639' : '#f7f7f7')) as RGB;\n      textColor = (webApp.themeParams?.text_color || (webApp.colorScheme === 'dark' ? '#ffffff' : '#000000')) as RGB;\n      hintColor = (webApp.themeParams?.hint_color || (webApp.colorScheme === 'dark' ? '#7d7d7d' : '#999999')) as RGB;\n      linkColor = (webApp.themeParams?.link_color || (webApp.colorScheme === 'dark' ? '#64baff' : '#2481cc')) as RGB;\n      buttonColor = (webApp.themeParams?.button_color || (webApp.colorScheme === 'dark' ? '#3390ec' : '#2481cc')) as RGB;\n      buttonTextColor = (webApp.themeParams?.button_text_color || '#ffffff') as RGB;\n      isDark = webApp.colorScheme === 'dark';\n      \n      console.log(\"Using native Telegram theme colors:\", {\n        bgColor,\n        secondaryBgColor,\n        textColor,\n        hintColor,\n        linkColor,\n        buttonColor,\n        buttonTextColor,\n        isDark\n      });\n      \n      // IMPORTANT: Set the header color to match the frontend background color (secondaryBgColor)\n      // This ensures the Telegram miniapp border matches our app's background\n      try {\n        // Try multiple approaches to set the header color\n        \n        // Approach 1: Try using direct WebApp method if available\n        if (webApp.setHeaderColor) {\n          webApp.setHeaderColor(secondaryBgColor);\n          console.log(\"Header color set using WebApp.setHeaderColor:\", secondaryBgColor);\n        } \n        // Approach 2: Use postEvent method\n        else {\n          webApp.postEvent('web_app_set_header_color', JSON.stringify({\n            color: secondaryBgColor\n          }));\n          console.log(\"Header color set using postEvent:\", secondaryBgColor);\n        }\n        \n        // Approach 3: Try using global Telegram object directly\n        if (window.Telegram?.WebApp) {\n          const globalWebApp = window.Telegram.WebApp;\n          // @ts-ignore - Ignore TypeScript errors for direct access\n          if (typeof globalWebApp.setHeaderColor === 'function') {\n            // @ts-ignore\n            globalWebApp.setHeaderColor(secondaryBgColor);\n            console.log(\"Header color set using global Telegram.WebApp.setHeaderColor\");\n          }\n        }\n      } catch (error) {\n        console.error(\"Error setting header color:\", error);\n        \n        // Fallback: Try using color_key instead of direct color\n        try {\n          if (window.Telegram?.WebApp) {\n            // @ts-ignore\n            if (typeof window.Telegram.WebApp.setHeaderColor === 'function') {\n              // @ts-ignore\n              window.Telegram.WebApp.setHeaderColor('secondary_bg_color');\n              console.log(\"Header color set using color_key: secondary_bg_color\");\n            }\n          }\n        } catch (e) {\n          console.error(\"All attempts to set header color failed:\", e);\n        }\n      }\n      \n      // Set the background color to match the secondary background color\n      try {\n        if (webApp.setBackgroundColor) {\n          webApp.setBackgroundColor(secondaryBgColor);\n          console.log(\"Background color set using WebApp.setBackgroundColor:\", secondaryBgColor);\n        } else {\n          webApp.postEvent('web_app_set_background_color', JSON.stringify({\n            color: secondaryBgColor\n          }));\n          console.log(\"Background color set using postEvent:\", secondaryBgColor);\n        }\n      } catch (error) {\n        console.error(\"Error setting background color:\", error);\n      }\n    } else {\n      // Fallback to SDK\n      console.log(\"WebApp not available, using SDK theme params\");\n      \n      // Use SDK theme params with exact color for dark mode\n      bgColor = (themeParams.backgroundColor || (themeParams.isDark ? '#271a28' : '#ffffff')) as RGB;\n      secondaryBgColor = (themeParams.secondaryBackgroundColor || (themeParams.isDark ? '#382639' : '#f7f7f7')) as RGB;\n      textColor = (themeParams.textColor || (themeParams.isDark ? '#ffffff' : '#000000')) as RGB;\n      hintColor = (themeParams.hintColor || (themeParams.isDark ? '#7d7d7d' : '#999999')) as RGB;\n      linkColor = (themeParams.linkColor || (themeParams.isDark ? '#64baff' : '#2481cc')) as RGB;\n      buttonColor = (themeParams.buttonColor || (themeParams.isDark ? '#3390ec' : '#2481cc')) as RGB;\n      buttonTextColor = (themeParams.buttonTextColor || '#ffffff') as RGB;\n      isDark = !!themeParams.isDark;\n      \n      console.log(\"Using SDK theme colors:\", {\n        bgColor,\n        secondaryBgColor,\n        textColor,\n        hintColor,\n        linkColor,\n        buttonColor,\n        buttonTextColor,\n        isDark\n      });\n      \n      // Apply colors to Telegram Mini App header and background using SDK\n      try {\n        import('@telegram-apps/sdk').then(({ postEvent }) => {\n          // IMPORTANT: Set header color to match the frontend background color\n          // Use direct color value instead of color_key to ensure exact match\n          postEvent('web_app_set_header_color', { color: secondaryBgColor });\n          console.log(\"Header color set to match frontend background:\", secondaryBgColor, \"via SDK\");\n          \n          // Set background color to match the secondary background color\n          postEvent('web_app_set_background_color', { color: secondaryBgColor });\n          console.log(\"Background color set to:\", secondaryBgColor, \"via SDK\");\n        }).catch(e => {\n          console.error(\"Error importing SDK for postEvent:\", e);\n        });\n      } catch (error) {\n        console.error(\"Error setting colors via SDK:\", error);\n      }\n    }\n    \n    // Apply theme CSS based on Telegram's colors\n    applyTelegramThemeCSS(\n      secondaryBgColor, // Main app background uses secondaryBgColor\n      textColor,\n      hintColor,\n      linkColor,\n      buttonColor,\n      buttonTextColor,\n      secondaryBgColor, // IMPORTANT: Use secondaryBgColor for UI elements too\n      isDark\n    );\n    \n    // Request the theme again to ensure we have the latest\n    requestTelegramTheme();\n  } catch (error) {\n    console.error(\"Error setting Telegram colors:\", error);\n  }\n}\n\n/**\n * Apply theme CSS based on Telegram's colors\n */\nfunction applyTelegramThemeCSS(\n  mainBgColor: RGB,\n  textColor: RGB,\n  hintColor: RGB,\n  linkColor: RGB,\n  buttonColor: RGB,\n  buttonTextColor: RGB,\n  headerBgColor: RGB,\n  isDark: boolean | undefined\n): void {\n  try {\n    // Ensure isDark is a boolean\n    const isThemeDark = isDark === true;\n    \n    // Force theme background color for consistency\n    const forcedMainBgColor = mainBgColor;\n    const forcedHeaderBgColor = headerBgColor;\n    \n    console.log(`Applying ${isThemeDark ? 'dark' : 'light'} theme CSS with Telegram colors`);\n    console.log(`Using main background color: ${forcedMainBgColor}`);\n    console.log(`Using header background color: ${forcedHeaderBgColor}`);\n    \n    // Get the root element\n    const root = document.documentElement;\n    \n    // Set theme class\n    if (isThemeDark) {\n      root.classList.add('dark');\n      root.classList.remove('light');\n    } else {\n      root.classList.add('light');\n      root.classList.remove('dark');\n    }\n    root.classList.add('telegram-webview');\n    \n    // Set CSS variables for Telegram colors - use !important to override any other styles\n    const style = document.createElement('style');\n    style.textContent = `\n      :root {\n        --tg-theme-bg-color: ${forcedHeaderBgColor} !important;\n        --tg-theme-secondary-bg-color: ${forcedMainBgColor} !important;\n        --tg-theme-text-color: ${textColor} !important;\n        --tg-theme-hint-color: ${hintColor} !important;\n        --tg-theme-link-color: ${linkColor} !important;\n        --tg-theme-button-color: ${buttonColor} !important;\n        --tg-theme-button-text-color: ${buttonTextColor} !important;\n        --tg-color-scheme: ${isThemeDark ? 'dark' : 'light'} !important;\n        \n        --telegram-bg: ${forcedMainBgColor} !important;\n        --telegram-header-bg: ${forcedHeaderBgColor} !important;\n        --telegram-secondary-bg: ${forcedHeaderBgColor} !important;\n        --telegram-text: ${textColor} !important;\n        --telegram-hint: ${hintColor} !important;\n        --telegram-link: ${linkColor} !important;\n        --telegram-button: ${buttonColor} !important;\n        --telegram-button-text: ${buttonTextColor} !important;\n      }\n      \n      body, html, #root {\n        background-color: ${forcedMainBgColor} !important;\n        color: ${textColor} !important;\n      }\n      \n      .${isThemeDark ? 'dark' : 'light'} body, .${isThemeDark ? 'dark' : 'light'} html, .${isThemeDark ? 'dark' : 'light'} #root {\n        background-color: ${forcedMainBgColor} !important;\n      }\n      \n      /* Apply colors to common UI elements */\n      .card, .popover, .dropdown-menu, .card-container {\n        background-color: ${forcedHeaderBgColor} !important;\n        color: ${textColor} !important;\n        border: 1px solid ${isThemeDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'} !important;\n      }\n      \n      a {\n        color: ${linkColor} !important;\n      }\n      \n      .hint, .text-muted {\n        color: ${hintColor} !important;\n      }\n      \n      .btn-primary, .button-primary {\n        background-color: ${buttonColor} !important;\n        color: ${buttonTextColor} !important;\n      }\n      \n      /* Search inputs and form controls */\n      input, select, textarea {\n        background-color: ${forcedMainBgColor} !important;\n        color: ${textColor} !important;\n        border-color: ${hintColor}30 !important;\n      }\n      \n      input:focus, select:focus, textarea:focus {\n        border-color: ${buttonColor} !important;\n        box-shadow: 0 0 0 2px ${buttonColor}30 !important;\n      }\n      \n      /* Size selector buttons */\n      .size-button {\n        background-color: ${forcedMainBgColor} !important;\n        color: ${textColor} !important;\n        border-color: ${hintColor}30 !important;\n      }\n      \n      .size-button.selected {\n        background-color: ${buttonColor}10 !important;\n        color: ${buttonColor} !important;\n        border-color: ${buttonColor} !important;\n      }\n      \n      /* Bottom navigation bar - solid color matching the secondary background color */\n      .bottom-nav-bar {\n        background-color: ${forcedHeaderBgColor} !important;\n        /* Remove border and shadow */\n        border-top: none !important;\n        box-shadow: none !important;\n        /* Add a subtle top border for separation */\n        border-top: 1px solid ${isThemeDark ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)'} !important;\n      }\n      \n      /* Bottom navigation items */\n      .bottom-nav-bar a {\n        color: ${hintColor} !important;\n        padding: 8px 0 !important;\n        transition: all 0.2s ease !important;\n      }\n      \n      /* Active navigation items */\n      .bottom-nav-bar a.active, \n      .bottom-nav-bar a.active svg,\n      .bottom-nav-bar a[aria-current=\"page\"],\n      .bottom-nav-bar a[aria-current=\"page\"] svg {\n        color: ${buttonColor} !important;\n      }\n      \n      /* Navigation item hover effect */\n      .bottom-nav-bar a:hover {\n        color: ${buttonColor}CC !important;\n        transform: translateY(-2px) !important;\n      }\n      \n      /* Badge styling */\n      .bottom-nav-bar .badge {\n        background-color: ${buttonColor} !important;\n        color: ${buttonTextColor} !important;\n      }\n      \n      /* Force styles for desktop view */\n      @media (min-width: 768px) {\n        body, html, #root, .telegram-webview, .dark body, .dark html, .dark #root {\n          background-color: ${forcedMainBgColor} !important;\n        }\n        \n        .bottom-nav-bar, .dark .bottom-nav-bar {\n          background-color: ${forcedHeaderBgColor} !important;\n          border-top: none !important;\n          box-shadow: none !important;\n        }\n      }\n    `;\n    \n    // Remove any previous style element we added\n    const previousStyle = document.getElementById('telegram-theme-style');\n    if (previousStyle) {\n      previousStyle.remove();\n    }\n    \n    // Add ID to the style element for easy reference\n    style.id = 'telegram-theme-style';\n    \n    // Add the style element to the head\n    document.head.appendChild(style);\n    \n    // Also set individual CSS variables\n    root.style.setProperty('--tg-theme-bg-color', forcedHeaderBgColor, 'important');\n    root.style.setProperty('--tg-theme-secondary-bg-color', forcedMainBgColor, 'important');\n    root.style.setProperty('--tg-theme-text-color', textColor, 'important');\n    root.style.setProperty('--tg-theme-hint-color', hintColor, 'important');\n    root.style.setProperty('--tg-theme-link-color', linkColor, 'important');\n    root.style.setProperty('--tg-theme-button-color', buttonColor, 'important');\n    root.style.setProperty('--tg-theme-button-text-color', buttonTextColor, 'important');\n    root.style.setProperty('--tg-color-scheme', isThemeDark ? 'dark' : 'light', 'important');\n    \n    // Apply the background color to all main elements\n    document.body.style.backgroundColor = forcedMainBgColor;\n    document.body.style.setProperty('background-color', forcedMainBgColor, 'important');\n    document.body.style.color = textColor;\n    document.body.style.setProperty('color', textColor, 'important');\n    \n    if (document.getElementById('root')) {\n      const rootElement = document.getElementById('root')!;\n      rootElement.style.backgroundColor = forcedMainBgColor;\n      rootElement.style.setProperty('background-color', forcedMainBgColor, 'important');\n    }\n    \n    // Apply styles to bottom navigation bar directly if it exists\n    const bottomNavBar = document.querySelector('.bottom-nav-bar');\n    if (bottomNavBar) {\n      (bottomNavBar as HTMLElement).style.backgroundColor = forcedHeaderBgColor;\n      (bottomNavBar as HTMLElement).style.setProperty('background-color', forcedHeaderBgColor, 'important');\n      // Remove backdrop filter\n      (bottomNavBar as HTMLElement).style.backdropFilter = 'none';\n      (bottomNavBar as HTMLElement).style.setProperty('-webkit-backdrop-filter', 'none', 'important');\n      // Remove border and shadow\n      (bottomNavBar as HTMLElement).style.borderTop = 'none';\n      (bottomNavBar as HTMLElement).style.setProperty('border-top', 'none', 'important');\n      (bottomNavBar as HTMLElement).style.boxShadow = 'none';\n      (bottomNavBar as HTMLElement).style.setProperty('box-shadow', 'none', 'important');\n    }\n    \n    // Force background color on html element too\n    document.documentElement.style.backgroundColor = forcedMainBgColor;\n    document.documentElement.style.setProperty('background-color', forcedMainBgColor, 'important');\n    \n    console.log(`${isThemeDark ? 'Dark' : 'Light'} theme CSS applied with Telegram colors`);\n  } catch (error) {\n    console.error(\"Error applying theme CSS:\", error);\n  }\n}\n\n/**\n * Open URL directly in Telegram WebApp\n * This bypasses the confirmation dialog and opens the URL within Telegram\n * @param url URL to open\n */\nexport function openTelegramUrl(url: string): void {\n  try {\n    console.log(\"Opening URL in Telegram:\", url);\n    \n    // Get the WebApp instance\n    const webApp = getTelegramWebApp();\n    \n    if (webApp) {\n      // Use Telegram's openLink method if available (newer versions)\n      if (typeof webApp.openLink === 'function') {\n        webApp.openLink(url, { try_instant_view: true });\n        console.log(\"URL opened using WebApp.openLink\");\n        return;\n      }\n    }\n    \n    // Fallback to global Telegram.WebApp\n    if (window.Telegram?.WebApp) {\n      const globalWebApp = window.Telegram.WebApp;\n      // @ts-ignore - Some versions might have this method\n      if (typeof globalWebApp.openLink === 'function') {\n        // @ts-ignore\n        globalWebApp.openLink(url, { try_instant_view: true });\n        console.log(\"URL opened using global Telegram.WebApp.openLink\");\n        return;\n      }\n    }\n    \n    // If all else fails, just open in a new tab\n    console.warn(\"No Telegram-specific method available to open URL, falling back to window.open\");\n    window.open(url, '_blank');\n  } catch (error) {\n    console.error(\"Error opening URL in Telegram:\", error);\n    // Fallback to regular open\n    window.open(url, '_blank');\n  }\n}\n","import { toast } from 'sonner';\nimport { API_BASE_URL, TIMEOUTS, handleApiError, cache, CACHE_CONFIG, createFetchOptions } from './config';\nimport { TelegramUser, UserProfile, UserExistsRequest, UserExistsResponse, UserRankRequest, UserRankResponse, DeliveryRate } from './types';\nimport { getTelegramUser as getTelegramUserFromUtils } from '@/utils/telegramUtils';\n\n// Cache keys\nconst CACHE_KEYS = {\n  PROFILE: (userId: number) => `profile_${userId}`,\n  RANK: (userId: number) => `rank_${userId}`,\n  DD_COINS: (userId: number) => `dd_coins_${userId}`,\n  DELIVERY_RATES: 'delivery_rates'\n};\n\n// Helper function to get Telegram user data\nexport const getTelegramUser = (): TelegramUser | null => {\n  try {\n    // First try to get user data from telegramUtils (which has better parsing)\n    const userFromUtils = getTelegramUserFromUtils();\n    if (userFromUtils) {\n      console.log('Using Telegram user data from telegramUtils');\n      return userFromUtils;\n    }\n    \n    // Check if Telegram WebApp is available\n    if (window.Telegram && window.Telegram.WebApp) {\n      const user = window.Telegram.WebApp.initDataUnsafe.user;\n      \n      // Make sure we have a valid user object\n      if (user && user.id) {\n        return user;\n      } else {\n        console.warn('Telegram WebApp available but user data is invalid');\n      }\n    }\n    \n    // We couldn't get user data - this is a real issue\n    console.error('No Telegram user data available');\n    return null;\n  } catch (error) {\n    console.error('Error getting Telegram user:', error);\n    return null;\n  }\n};\n\n// Check if user exists in the system when the app initializes\nexport const checkUserExists = async (returnFullResponse: boolean = true): Promise<UserExistsResponse | boolean> => {\n  try {\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No Telegram user data available for existence check');\n      return false;\n    }\n    \n    console.log(`Checking if user exists: ID=${user.id}, username=${user.username || 'not set'}`);\n    \n    // Prepare the request body\n    const requestBody: UserExistsRequest = {\n      telegram_user_id: user.id\n    };\n    \n    // Add username if available\n    if (user.username) {\n      requestBody.telegram_username = user.username;\n    }\n    \n    // Make the API call with improved fetch options\n    const { options, clearTimeout } = createFetchOptions('POST', requestBody, TIMEOUTS.PROFILE);\n    \n    try {\n      const response = await fetch(`${API_BASE_URL}/users/check-exists`, options);\n      clearTimeout();\n      \n      if (!response.ok) {\n        // Gracefully handle 404 - consider user doesn't exist\n        if (response.status === 404) {\n          console.log('User not found (404), considered as non-existent');\n          return false;\n        }\n        \n        const errorText = await response.text();\n        let errorDetail;\n        try {\n          const errorJson = JSON.parse(errorText);\n          errorDetail = errorJson.detail || errorText;\n        } catch (e) {\n          errorDetail = errorText || `HTTP error ${response.status}`;\n        }\n        throw new Error(errorDetail);\n      }\n      \n      // Get the response text first\n      const responseText = await response.text();\n      \n      // Parse response\n      const existsResponse: UserExistsResponse = JSON.parse(responseText);\n      console.log('User existence check result:', existsResponse);\n      \n      // Cache the DD coins balance to make it immediately available to other components\n      if (existsResponse.dd_coins_balance !== undefined) {\n        const cacheKey = CACHE_KEYS.DD_COINS(user.id);\n        cache.set(cacheKey, existsResponse.dd_coins_balance);\n      }\n      \n      // Return full response if requested\n      if (returnFullResponse) {\n        return existsResponse;\n      }\n      \n      // Otherwise return false for is_new_client = false, true for is_new_client = true\n      return existsResponse.is_new_client;\n    } catch (error: any) {\n      // Log the error but don't show toast for this background check\n      console.error('Error checking if user exists:', error);\n      return false;\n    }\n  } catch (error: any) {\n    console.error('Error in checkUserExists:', error);\n    return false;\n  }\n};\n\n// Get user rank with caching\n/*\nexport const getUserRank = async (): Promise<number> => {\n  try {\n    const user = getTelegramUser();\n    if (!user || !user.id) {\n      console.error('No Telegram user data available for getting rank');\n      return 0; // Default rank\n    }\n    \n    console.log(`Getting rank for user ID: ${user.id}`);\n    \n    // Check cache first\n    const cacheKey = CACHE_KEYS.RANK(user.id);\n    const cachedRank = cache.get<number>(cacheKey, CACHE_CONFIG.PROFILE_TTL);\n    if (cachedRank !== null) {\n      console.log('Using cached rank data:', cachedRank);\n      return cachedRank;\n    }\n    \n    // Prepare the request\n    const requestBody: UserRankRequest = {\n      telegram_user_id: user.id\n    };\n    \n    // Make the API call with improved fetch options\n    const { options, clearTimeout } = createFetchOptions('POST', requestBody, TIMEOUTS.PROFILE);\n    \n    try {\n      const response = await fetch(`${API_BASE_URL}/users/rank`, options);\n      clearTimeout();\n      \n      // If user not found, just return 0 as the default rank\n      if (response.status === 404) {\n        console.log('User not found in rank API, using default rank 0');\n        // Cache the default rank to avoid repeated calls\n        cache.set(cacheKey, 0);\n        return 0;\n      }\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        let errorDetail;\n        try {\n          const errorJson = JSON.parse(errorText);\n          errorDetail = errorJson.detail || errorText;\n        } catch (e) {\n          errorDetail = errorText || `HTTP error ${response.status}`;\n        }\n        throw new Error(errorDetail);\n      }\n      \n      // Get the response text first\n      const responseText = await response.text();\n      console.log('Raw rank response:', responseText);\n      \n      // Parse response\n      const rankResponse: UserRankResponse = JSON.parse(responseText);\n      console.log('User rank result:', rankResponse);\n      \n      // Make sure we have loyalty_rank and convert to number\n      if (rankResponse.loyalty_rank === undefined) {\n        console.error('loyalty_rank not found in response:', rankResponse);\n        // Return 0 as default\n        cache.set(cacheKey, 0);\n        return 0;\n      }\n      \n      // Get the loyalty_rank value \n      // Convert string rank to number if needed\n      const rankValue = typeof rankResponse.loyalty_rank === 'string' \n        ? parseInt(rankResponse.loyalty_rank, 10) || 0\n        : Number(rankResponse.loyalty_rank) || 0;\n      \n      console.log('Extracted rank value:', rankValue);\n      \n      // Cache the rank\n      cache.set(cacheKey, rankValue);\n      \n      return rankValue;\n    } catch (error: any) {\n      console.error('Error getting user rank:', error);\n      \n      // Don't show error toast for user not found\n      if (!error.message.includes('User not found')) {\n        toast.error(`Error getting rank: ${error.message}`);\n      }\n      \n      return 0; // Default rank\n    }\n  } catch (error: any) {\n    console.error('Error in getUserRank:', error);\n    \n    // Don't show error toast for user not found\n    if (!error.message.includes('User not found')) {\n      toast.error(`Error: ${error.message}`);\n    }\n    \n    return 0; // Default rank\n  }\n};\n*/\n\n// Legacy function for backward compatibility\nexport const checkUserProfile = async (userId: number): Promise<UserProfile> => {\n  try {\n    // Get current user info if userId wasn't provided\n    const user = getTelegramUser();\n    const safeUserId = userId || (user ? user.id : 0);\n    const username = user ? (user.username || `user_${safeUserId}`) : `user_${safeUserId}`;\n    \n    if (!safeUserId) {\n      console.error('No user ID available for profile check');\n      throw new Error('User ID required');\n    }\n    \n    // Get user rank via the new API\n    // const loyaltyRank = await getUserRank();\n    // console.log(`Retrieved loyalty rank for user ${safeUserId}: ${loyaltyRank}`);\n    \n    // Return a compatible profile object\n    return {\n      telegram_username: username,\n      rank: 0, // Default to 0 since rank is not used\n      total_orders: 0 // We don't have this information in the new API\n    };\n  } catch (error) {\n    console.error('Error in legacy checkUserProfile:', error);\n    \n    // Return a minimal profile to prevent app crashes\n    return {\n      telegram_username: `user_${userId || 0}`,\n      rank: 0,\n      total_orders: 0\n    };\n  }\n};\n\n/**\n * Get user's DD coins balance\n * @returns A promise that resolves to the user's DD coins balance\n */\nexport const getDDCoinsBalance = async (): Promise<number> => {\n  try {\n    const user = getTelegramUser();\n    if (!user || !user.id) {\n      console.error('No Telegram user data available for getting DD coins balance');\n      return 0; // Default balance\n    }\n    \n    const userId = user.id;\n    console.log(`Getting DD coins balance for user ID: ${userId}`);\n    \n    // Check cache first\n    const cacheKey = CACHE_KEYS.DD_COINS(userId);\n    const cachedBalance = cache.get<number>(cacheKey, CACHE_CONFIG.PROFILE_TTL);\n    if (cachedBalance !== null) {\n      console.log('Using cached DD coins balance:', cachedBalance);\n      return cachedBalance;\n    }\n    \n    // If not cached, get from user check API\n    console.log('No cached DD coins balance, fetching from API...');\n    const userResponse = await checkUserExists(true);\n    \n    if (userResponse && typeof userResponse !== 'boolean') {\n      const balance = userResponse.dd_coins_balance;\n      console.log('DD coins balance from user check:', balance);\n        \n        // Cache the balance\n        cache.set(cacheKey, balance);\n        \n        return balance;\n      }\n      \n    return 0; // Default balance if we couldn't get it\n  } catch (error: any) {\n    console.error('Error getting DD coins balance:', error);\n    return 0; // Default balance on error\n  }\n};\n\n/**\n * Get available delivery rates\n * @returns A promise that resolves to an array of delivery rates\n */\nexport const getDeliveryRates = async (): Promise<DeliveryRate[]> => {\n  try {\n    // Check cache first\n    const cacheKey = CACHE_KEYS.DELIVERY_RATES;\n    const cachedRates = cache.get<DeliveryRate[]>(cacheKey, CACHE_CONFIG.PROFILE_TTL);\n    if (cachedRates !== null) {\n      console.log('Using cached delivery rates:', cachedRates);\n      return cachedRates;\n    }\n    \n    console.log('Fetching delivery rates from API...');\n    \n    // Make the API call with improved fetch options\n    const { options, clearTimeout } = createFetchOptions('GET', null, TIMEOUTS.PROFILE);\n    \n    try {\n      const response = await fetch(`${API_BASE_URL}/users/delivery-rates`, options);\n      clearTimeout();\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        let errorDetail;\n        try {\n          const errorJson = JSON.parse(errorText);\n          errorDetail = errorJson.detail || errorText;\n        } catch (e) {\n          errorDetail = errorText || `HTTP error ${response.status}`;\n        }\n        throw new Error(errorDetail);\n      }\n      \n      // Get the response text first\n      const responseText = await response.text();\n      console.log('Raw delivery rates response:', responseText);\n      \n      // Parse response - format is { \"delivery_rates\": [{ \"delivery_type\": \"...\", \"price_rub\": 0 }, ...] }\n      const ratesResponse = JSON.parse(responseText);\n      console.log('Delivery rates response:', ratesResponse);\n      \n      // Extract the rates\n      const rates = ratesResponse.delivery_rates || [];\n      \n      // Cache the rates\n      cache.set(cacheKey, rates);\n      \n      return rates;\n    } catch (error: any) {\n      console.error('Error getting delivery rates:', error);\n      toast.error(`Error getting delivery rates: ${error.message}`);\n      return []; // Empty array as default\n    }\n  } catch (error: any) {\n    console.error('Error in getDeliveryRates:', error);\n    return []; // Empty array as default\n  }\n};\n","import { StockItem, Order, OrderItem, SizeAvailability, ItemPhoto } from './types';\n\n// Mock data for fallback when API is unavailable - legacy format\nexport const MOCK_STOCK: StockItem[] = [\n  {\n    \"sku\": \"TS001-BLK\",\n    \"item_name\": \"Basic T-Shirt\",\n    \"color_code\": \"BLK\",\n    \"brand\": \"FashionBrand\",\n    \"description\": \"Original SKU: TS001-BLK\",\n    \"price_rub\": 500.0,\n    \"sizes\": [\n      { \"size\": \"M\", \"quantity\": 2 },\n      { \"size\": \"L\", \"quantity\": 2 }\n    ],\n    \"photos\": [\n      { \"photo_url\": \"https://example.com/photos/ts001_front.jpg\", \"photo_category\": \"front\" },\n      { \"photo_url\": \"https://example.com/photos/ts001_side.jpg\", \"photo_category\": \"side\" }\n    ]\n  },\n  {\n    \"sku\": \"JN002-BLU\",\n    \"item_name\": \"Slim Jeans\",\n    \"color_code\": \"BLU\",\n    \"brand\": \"DenimCo\",\n    \"description\": \"Original SKU: JN002-BLU\",\n    \"price_rub\": 1200.0,\n    \"sizes\": [\n      { \"size\": \"32\", \"quantity\": 2 }\n    ],\n    \"photos\": [\n      { \"photo_url\": \"https://example.com/photos/jn002_front.jpg\", \"photo_category\": \"front\" }\n    ]\n  },\n  {\n    \"sku\": \"SW003-RED\",\n    \"item_name\": \"Wool Sweater\",\n    \"color_code\": \"RED\",\n    \"brand\": \"WinterWear\",\n    \"description\": \"Original SKU: SW003-RED\",\n    \"price_rub\": 1500.0,\n    \"sizes\": [\n      { \"size\": \"S\", \"quantity\": 1 },\n      { \"size\": \"M\", \"quantity\": 3 }\n    ],\n    \"photos\": [\n      { \"photo_url\": \"https://example.com/photos/sw003_front.jpg\", \"photo_category\": \"front\" }\n    ]\n  }\n];\n\n// Mock products with proper structure for new API\nexport const MOCK_PRODUCTS: StockItem[] = [\n  {\n    \"sku\": \"TS001-BLK\",\n    \"item_name\": \"Basic T-Shirt\",\n    \"color_code\": \"BLK\",\n    \"brand\": \"FashionBrand\",\n    \"description\": \"Original SKU: TS001-BLK\",\n    \"price_rub\": 500.0,\n    \"sizes\": [\n      { \"size\": \"M\", \"quantity\": 2 },\n      { \"size\": \"L\", \"quantity\": 2 }\n    ],\n    \"photos\": [\n      { \"photo_url\": \"https://example.com/photos/ts001_front.jpg\", \"photo_category\": \"front\" },\n      { \"photo_url\": \"https://example.com/photos/ts001_side.jpg\", \"photo_category\": \"side\" }\n    ]\n  },\n  {\n    \"sku\": \"JN002-BLU\",\n    \"item_name\": \"Slim Jeans\",\n    \"color_code\": \"BLU\",\n    \"brand\": \"DenimCo\",\n    \"description\": \"Original SKU: JN002-BLU\",\n    \"price_rub\": 1200.0,\n    \"sizes\": [\n      { \"size\": \"32\", \"quantity\": 2 }\n    ],\n    \"photos\": [\n      { \"photo_url\": \"https://example.com/photos/jn002_front.jpg\", \"photo_category\": \"front\" }\n    ]\n  },\n  {\n    \"sku\": \"SW003-RED\",\n    \"item_name\": \"Wool Sweater\",\n    \"color_code\": \"RED\",\n    \"brand\": \"WinterWear\",\n    \"description\": \"Original SKU: SW003-RED\",\n    \"price_rub\": 1500.0,\n    \"sizes\": [\n      { \"size\": \"S\", \"quantity\": 1 },\n      { \"size\": \"M\", \"quantity\": 3 }\n    ],\n    \"photos\": [\n      { \"photo_url\": \"https://example.com/photos/sw003_front.jpg\", \"photo_category\": \"front\" }\n    ]\n  }\n];\n\nexport const MOCK_ORDERS: Order[] = [\n  {\n    order_id: 1,\n    created_at: '2023-02-20T00:00:00',\n    prepay_amount: '1500.0',\n    status: 'paid',\n    items: [\n      { \n        sku: 'SW003-RED', \n        item_name: 'Wool Sweater', \n        size: 'M', \n        price_cny: '150.0',\n        price_rub: '1500.0' \n      }\n    ]\n  },\n  {\n    order_id: 2,\n    created_at: '2023-05-15T00:00:00',\n    prepay_amount: '1700.0',\n    status: 'pending',\n    items: [\n      { \n        sku: 'TS001-BLK', \n        item_name: 'Basic T-Shirt', \n        size: 'L', \n        price_cny: '50.0',\n        price_rub: '500.0' \n      },\n      { \n        sku: 'JN002-BLU', \n        item_name: 'Slim Jeans', \n        size: '32', \n        price_cny: '120.0',\n        price_rub: '1200.0' \n      }\n    ]\n  }\n];\n","import { toast } from 'sonner';\nimport { API_BASE_URL, TIMEOUTS, handleApiError, cache, CACHE_CONFIG, createFetchOptions } from './config';\nimport { StockItem, StockResponse, SizeAvailability, ItemPhoto, CategoryResponse, Category } from './types';\nimport { MOCK_PRODUCTS } from './mockData';\nimport { getTelegramUser } from './userService';\n\n// Cache keys\nconst CACHE_KEYS = {\n  PRODUCTS: 'products',\n  CATEGORIES: 'categories'\n};\n\n// Fetch all available products with fallback to mock data and caching\nexport const fetchProducts = async (): Promise<StockItem[]> => {\n  console.log('Fetching products...');\n  \n  try {\n    // Get user's Telegram ID using the centralized helper function\n    const user = getTelegramUser();\n    const telegramUserId = user?.id;\n    \n    // Log whether we found a user ID or not\n    if (telegramUserId) {\n      console.log(`Found Telegram user ID: ${telegramUserId}`);\n    } else {\n      console.warn('No Telegram user ID available for products fetch');\n    }\n    \n    // Check cache first\n    const cachedProducts = cache.get<StockItem[]>(CACHE_KEYS.PRODUCTS, CACHE_CONFIG.PRODUCTS_TTL);\n    if (cachedProducts) {\n      console.log('Using cached products data');\n      return cachedProducts;\n    }\n    \n    console.log('No cached products, fetching from API...');\n    \n    // Make the API call with improved fetch options\n    const { options, clearTimeout } = createFetchOptions('GET', undefined, TIMEOUTS.PRODUCTS);\n    \n    try {\n      // Build URL with query parameter if telegram_user_id is available\n      let url = `${API_BASE_URL}/stock/in-stock`;\n      if (telegramUserId) {\n        url = `${url}?telegram_id=${telegramUserId}`;\n      }\n      \n      console.log(`Making request to: ${url}`);\n      const response = await fetch(url, options);\n      clearTimeout();\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        let errorDetail;\n        try {\n          const errorJson = JSON.parse(errorText);\n          errorDetail = errorJson.detail || errorText;\n        } catch (e) {\n          errorDetail = errorText || `HTTP error ${response.status}`;\n        }\n        throw new Error(errorDetail);\n      }\n      \n      // Get the response text first\n      const responseText = await response.text();\n      \n      // Parse response\n      const stockResponse: StockResponse = JSON.parse(responseText);\n      console.log('Products fetched successfully, count:', stockResponse.items?.length || 0);\n      \n      if (!stockResponse.items || !Array.isArray(stockResponse.items)) {\n        console.error('API returned invalid products data');\n        toast.error('Invalid products data received from API');\n        return MOCK_PRODUCTS;\n      }\n      \n      // Process the items to ensure consistent data format\n      const normalizedItems = stockResponse.items.map(item => {\n        // Ensure price_rub is a number\n        const price = typeof item.price_rub === 'string' \n          ? parseFloat(item.price_rub.replace(/[^\\d.-]/g, '')) \n          : Number(item.price_rub);\n          \n        // Ensure photos array exists\n        const photos = Array.isArray(item.photos) ? item.photos : [];\n        \n        // Ensure sizes array exists and has quantity as number\n        const sizes = Array.isArray(item.sizes) \n          ? item.sizes.map(size => ({\n              ...size,\n              quantity: typeof size.quantity === 'string' ? parseInt(size.quantity, 10) : size.quantity\n            }))\n          : [];\n        \n        return {\n          ...item,\n          price_rub: isNaN(price) ? 0 : price,\n          photos: photos,\n          sizes: sizes\n        };\n      });\n      \n      // Cache the products\n      cache.set(CACHE_KEYS.PRODUCTS, normalizedItems);\n      \n      return normalizedItems;\n    } catch (error: any) {\n      console.error('Error fetching products:', error);\n      toast.error(`Error loading products: ${error.message}`);\n      return MOCK_PRODUCTS;\n    }\n  } catch (error: any) {\n    console.error('Error in fetchProducts:', error);\n    toast.error(`Error: ${error.message}`);\n    return MOCK_PRODUCTS;\n  }\n};\n\n/**\n * Fetch all available categories\n * @returns A promise that resolves to an array of categories\n */\nexport const fetchCategories = async (): Promise<Category[]> => {\n  console.log('Fetching categories...');\n  \n  try {\n    // Check cache first\n    const cachedCategories = cache.get<Category[]>(CACHE_KEYS.CATEGORIES, CACHE_CONFIG.PRODUCTS_TTL);\n    if (cachedCategories) {\n      console.log('Using cached categories data');\n      return cachedCategories;\n    }\n    \n    console.log('No cached categories, fetching from API...');\n    \n    // Make the API call with improved fetch options\n    const { options, clearTimeout } = createFetchOptions('GET', undefined, TIMEOUTS.PRODUCTS);\n    \n    try {\n      const response = await fetch(`${API_BASE_URL}/stock/get-categories`, options);\n      clearTimeout();\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        let errorDetail;\n        try {\n          const errorJson = JSON.parse(errorText);\n          errorDetail = errorJson.detail || errorText;\n        } catch (e) {\n          errorDetail = errorText || `HTTP error ${response.status}`;\n        }\n        throw new Error(errorDetail);\n      }\n      \n      // Get the response text first\n      const responseText = await response.text();\n      \n      // Parse response\n      const categoryResponse: CategoryResponse = JSON.parse(responseText);\n      console.log('Categories fetched successfully, count:', categoryResponse.categories?.length || 0);\n      \n      if (!categoryResponse.categories || !Array.isArray(categoryResponse.categories)) {\n        console.error('API returned invalid categories data');\n        toast.error('Invalid categories data received from API');\n        return [];\n      }\n      \n      // Cache the categories\n      cache.set(CACHE_KEYS.CATEGORIES, categoryResponse.categories);\n      \n      return categoryResponse.categories;\n    } catch (error) {\n      console.error('Error fetching categories:', error);\n      throw error;\n    }\n  } catch (error: any) {\n    console.error('Failed to fetch categories:', error);\n    handleApiError('Failed to fetch categories');\n    return [];\n  }\n};\n","import { toast } from 'sonner';\nimport { API_BASE_URL, TIMEOUTS, handleApiError, cache, CACHE_CONFIG, createFetchOptions } from './config';\nimport { Order, CartItem, OrdersRequest, OrdersResponse, OrderStockRequest, OrderStockResponse, PreorderRequest, PreorderResponse, StockOrderItem } from './types';\nimport { MOCK_ORDERS } from './mockData';\nimport { getTelegramUser } from './userService';\n\n// Cache keys\nconst CACHE_KEYS = {\n  ORDERS: (userId: number) => `orders_${userId}`\n};\n\n// Fetch orders for the current user with fallback to mock data and caching\nexport const fetchOrders = async (): Promise<Order[]> => {\n  try {\n    // Get the current user\n    const user = getTelegramUser();\n    if (!user || !user.id) {\n      console.error('No user data available when fetching orders');\n      return []; // Return empty array instead of mock data\n    }\n    \n    console.log(`Fetching orders for user ID: ${user.id}...`);\n    \n    // Check cache first\n    const cacheKey = CACHE_KEYS.ORDERS(user.id);\n    const cachedOrders = cache.get<Order[]>(cacheKey, CACHE_CONFIG.ORDERS_TTL);\n    if (cachedOrders) {\n      console.log('Using cached orders data');\n      return cachedOrders;\n    }\n    \n    console.log('No cached orders, fetching from API...');\n    \n    // Prepare the request\n    const requestBody: OrdersRequest = {\n      telegram_user_id: user.id\n    };\n    \n    // Make the API call with improved fetch options\n    const { options, clearTimeout } = createFetchOptions('POST', requestBody, TIMEOUTS.ORDERS);\n    \n    try {\n      const response = await fetch(`${API_BASE_URL}/users/orders`, options);\n      clearTimeout();\n      \n      // If user not found or no orders yet, return empty array\n      if (response.status === 404) {\n        console.log('User has no orders or not found in orders API');\n        // Cache empty array to avoid repeated calls\n        cache.set(cacheKey, []);\n        return [];\n      }\n      \n      if (!response.ok) {\n        // Remove debug toasts\n        const errorText = await response.text();\n        let errorDetail;\n        try {\n          const errorJson = JSON.parse(errorText);\n          errorDetail = errorJson.detail || errorText;\n        } catch (e) {\n          errorDetail = errorText || `HTTP error ${response.status}`;\n        }\n        throw new Error(errorDetail);\n      }\n      \n      // Get the response text first\n      const responseText = await response.text();\n      \n      // Parse response\n      const ordersResponse: OrdersResponse = JSON.parse(responseText);\n      console.log('Orders fetched successfully:', ordersResponse);\n      \n      if (!ordersResponse.orders || !Array.isArray(ordersResponse.orders)) {\n        console.error('API returned invalid orders data');\n        return [];\n      }\n      \n      // Cache the orders\n      cache.set(cacheKey, ordersResponse.orders);\n      \n      return ordersResponse.orders;\n    } catch (error: any) {\n      console.error('Error fetching orders:', error);\n      \n      // Don't show error toast for user not found\n      if (!error.message.includes('User not found')) {\n        toast.error('Данные пользователя недоступны. Попробуйте еще раз.');\n      }\n      \n      return [];\n    }\n  } catch (error: any) {\n    console.error('Error in fetchOrders:', error);\n    \n    // Don't show error toast for user not found\n    if (!error.message.includes('User not found')) {\n      toast.error('Данные пользователя недоступны. Попробуйте еще раз.');\n    }\n    \n    return [];\n  }\n};\n\n/**\n * Create a new order and send a confirmation message to the Telegram chat\n * @param cartItems The items in the cart\n * @param shippingCost The cost of shipping\n * @returns A promise that resolves to the created order\n */\nexport const createOrder = async (cartItems: CartItem[], shippingCost: number = 800): Promise<boolean> => {\n  try {\n    // Get the user data\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No user data available when creating order');\n      toast.error('Данные пользователя недоступны. Попробуйте еще раз.');\n      return false;\n    }\n    \n    console.log('Creating order for user:', user);\n    \n    // Calculate total price\n    const subtotal = cartItems.reduce((total, item) => total + (item.price * item.quantity), 0);\n    const totalPrice = subtotal + shippingCost;\n    \n    // Generate a unique order ID\n    const orderNumber = `${user.id}-${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`;\n    console.log(`Generated order number: ${orderNumber}`);\n    \n    // Format the order items for the message\n    const orderItems = cartItems.map(item => {\n      return `${item.name} ${item.color} (цвет: ${getColorName(item.color)}, размер: ${item.size})  ${item.price.toFixed(2)}RUB x${item.quantity} шт`;\n    }).join('\\n');\n    \n    // Create the order message\n    const orderMessage = `\nЗаказ №${orderNumber} успешно оформлен\n\n\nСостав заказа:\n${orderItems}\nСтоимость доставки: ${shippingCost.toFixed(2)}RUB\n\nСумма: ${totalPrice.toLocaleString()} RUB\n\nСпасибо за ваш заказ! В ближайшее время с вами свяжется менеджер\n`;\n    \n    console.log('Prepared order message');\n    \n    // Create the order data\n    const orderData = {\n      user_id: user.id,\n      username: user.username || `user_${user.id}`,\n      order_number: orderNumber,\n      items: cartItems.map(item => ({\n        product_id: item.productId,\n        name: item.name,\n        color: item.color,\n        size: item.size,\n        price: item.price,\n        quantity: item.quantity\n      })),\n      shipping_cost: shippingCost,\n      total_price: totalPrice\n    };\n    \n    // Send the order to the API\n    const { options, clearTimeout } = createFetchOptions('POST', orderData, TIMEOUTS.ORDERS);\n    \n    // Store the order in localStorage as a backup\n    try {\n      localStorage.setItem(`order_${orderNumber}`, JSON.stringify(orderData));\n    } catch (e) {\n      console.warn('Could not store order in localStorage:', e);\n    }\n    \n    // Send the order confirmation message to the Telegram chat\n    console.log('Sending order confirmation to Telegram chat');\n    try {\n      await sendOrderConfirmation(user.id, orderMessage);\n      console.log('Order confirmation sent successfully');\n    } catch (error) {\n      console.error('Failed to send order confirmation, but continuing with order creation:', error);\n      // We'll continue with the order creation even if the confirmation fails\n    }\n    \n    // Invalidate the orders cache for this user\n    const username = user.username || `user_${user.id}`;\n    cache.invalidate(CACHE_KEYS.ORDERS(user.id));\n    \n    // Show success message\n    // toast.success('Заказ успешно создан! Проверьте чат в Telegram для получения деталей.');\n    \n    return true;\n  } catch (error: any) {\n    console.error('Error creating order:', error);\n    toast.error('Ошибка при создании заказа. Пожалуйста, попробуйте еще раз.');\n    return false;\n  }\n};\n\n/**\n * Send an order confirmation message to the Telegram chat\n * @param chatId The Telegram chat ID\n * @param message The message to send\n */\nconst sendOrderConfirmation = async (chatId: number, message: string): Promise<void> => {\n  try {\n    // Determine if we're in development or production\n    const isDevelopment = window.location.hostname === 'localhost' || \n                          window.location.hostname === '127.0.0.1';\n    \n    // Use local API in development, fallback to API_BASE_URL in production\n    const apiUrl = isDevelopment \n      ? 'http://localhost:3001/api/telegram/send_message'\n      : `${API_BASE_URL}/telegram/send_message`;\n    \n    console.log(`Sending order confirmation to chat ID ${chatId} via ${apiUrl}`);\n    console.log('Message length:', message.length);\n    console.log('Environment:', isDevelopment ? 'Development' : 'Production');\n    \n    // Add a timeout to the fetch request\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout\n    \n    try {\n      console.log('Sending fetch request...');\n      const response = await fetch(apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          chat_id: chatId,\n          text: message\n        }),\n        signal: controller.signal,\n        mode: 'cors', // Explicitly set CORS mode\n      });\n      \n      // Clear the timeout\n      clearTimeout(timeoutId);\n      \n      console.log(`Response status: ${response.status} ${response.statusText}`);\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => null);\n        console.error('API response not OK:', response.status, response.statusText);\n        console.error('Error data:', errorData);\n        throw new Error(`Failed to send message: ${errorData?.error || response.statusText}`);\n      }\n      \n      const responseData = await response.json();\n      console.log('Order confirmation sent successfully:', responseData);\n      \n      // Store the message in localStorage as a backup\n      try {\n        localStorage.setItem(`order_message_${chatId}_${Date.now()}`, message);\n      } catch (e) {\n        console.warn('Could not store order message in localStorage:', e);\n      }\n    } catch (fetchError: any) {\n      clearTimeout(timeoutId);\n      \n      if (fetchError.name === 'AbortError') {\n        console.error('Request timeout when sending order confirmation');\n        throw new Error('Request timeout when sending order confirmation');\n      }\n      \n      console.error('Fetch error details:', fetchError);\n      \n      // If we're in development and get a CORS error, try a different approach\n      if (isDevelopment && (fetchError.message.includes('CORS') || fetchError.message.includes('Failed to fetch'))) {\n        console.log('CORS issue detected, trying alternative approach...');\n        \n        // Create a fallback message with key order details\n        const fallbackMessage = `\n⚠️ Order created but notification failed to send via API.\n\nOrder Number: ${message.split('№')[1]?.split(' ')[0] || 'Unknown'}\nTotal: ${message.split('Сумма: ')[1]?.split('\\n')[0] || 'Unknown'}\n\nPlease check your orders in the app.\n`;\n        \n        // Show a warning to the user\n        toast.warning('Заказ создан, но уведомление не может быть отправлено в Telegram.');\n        console.error('Could not send notification to Telegram due to CORS or network issues. The bot server might not be running or accessible.');\n        \n        // Log the fallback message\n        console.log('Fallback message:', fallbackMessage);\n      }\n      \n      throw fetchError;\n    }\n  } catch (error: any) {\n    console.error('Error sending order confirmation:', error);\n    \n    // Store the failed message in localStorage for potential retry\n    try {\n      localStorage.setItem(`failed_order_message_${chatId}_${Date.now()}`, JSON.stringify({\n        chat_id: chatId,\n        text: message,\n        error: error.message\n      }));\n    } catch (e) {\n      console.warn('Could not store failed order message in localStorage:', e);\n    }\n    \n    // Don't show an error toast here, as we've already created the order successfully\n    // Just log the error for debugging\n  }\n};\n\n/**\n * Get the Russian name for a color code\n * @param colorCode The color code (e.g., \"black\", \"white\")\n * @returns The Russian name for the color\n */\nconst getColorName = (colorCode: string): string => {\n  const colorMap: Record<string, string> = {\n    'black': 'Черный',\n    'white': 'Белый',\n    'red': 'Красный',\n    'blue': 'Синий',\n    'green': 'Зеленый',\n    'yellow': 'Желтый',\n    'purple': 'Фиолетовый',\n    'orange': 'Оранжевый',\n    'pink': 'Розовый',\n    'gray': 'Серый',\n    'brown': 'Коричневый'\n  };\n  \n  return colorMap[colorCode.toLowerCase()] || colorCode;\n};\n\n// Add a product to the user's cart\nexport const addProductToCart = async (productId: string, size: string): Promise<boolean> => {\n  try {\n    // This is just a placeholder/mock since we don't have a real cart API\n    // In a real app, you'd call an API endpoint here\n    console.log(`[MOCK API] Added product to cart - Product ID: ${productId}, Size: ${size}`);\n    return true;\n  } catch (error) {\n    console.error('Error adding product to cart:', error);\n    return false;\n  }\n};\n\n// Update the application when an order is placed\nexport const handleOrderPlaced = (orderId: number, items: CartItem[]): void => {\n  try {\n    // Get the current user\n    const user = getTelegramUser();\n    if (!user || !user.id) {\n      console.error('No user data available for handleOrderPlaced');\n      return;\n    }\n    \n    // Invalidate the orders cache for this user\n    cache.invalidate(CACHE_KEYS.ORDERS(user.id));\n    \n    // Show success message\n    toast.success('Заказ успешно оформлен!');\n  } catch (error) {\n    console.error('Error in handleOrderPlaced:', error);\n  }\n};\n\ninterface CreateStockOrderData {\n  telegram_user_id: number;\n  delivery_type?: string;\n  delivery_method?: string;\n  delivery_address?: string;\n  promocode_text?: string;\n  dd_coins_amount?: number;\n  items: {\n    sku: string;\n    size: string;\n    quantity: number;\n    sale_price: number;\n  }[];\n}\n\ninterface CreateStockOrderResponse {\n  success: boolean;\n  message: string;\n  order_id?: number;\n}\n\nexport const createStockOrder = async (orderData: CreateStockOrderData): Promise<CreateStockOrderResponse> => {\n  try {\n    // Validate required fields\n    if (!orderData.items?.length) {\n      throw new Error('Order must contain at least one item');\n    }\n\n    for (const item of orderData.items) {\n      if (!item.sku) {\n        throw new Error('Each item must have a SKU');\n      }\n    }\n\n    // Use delivery_method if provided, otherwise use delivery_type\n    const deliveryType = orderData.delivery_method || orderData.delivery_type;\n\n    // Validate delivery_address if needed\n    if ((deliveryType === 'courier' || deliveryType === 'shipping') && !orderData.delivery_address) {\n      throw new Error('Delivery address is required for courier or shipping delivery method');\n    }\n\n    // Create a clean order data object with standardized field names\n    const cleanOrderData = {\n      ...orderData,\n      delivery_type: deliveryType\n    };\n\n    const { options, clearTimeout } = createFetchOptions('POST', cleanOrderData);\n\n    const response = await fetch(`${API_BASE_URL}/orders/stock`, options);\n    clearTimeout();\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      let errorDetail;\n      try {\n        const errorJson = JSON.parse(errorText);\n        errorDetail = errorJson.detail || errorText;\n      } catch (e) {\n        errorDetail = errorText;\n      }\n      throw new Error(errorDetail);\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error creating stock order:', error);\n    throw error;\n  }\n};\n\nexport const createPreorder = async (orderData: {\n  telegram_user_id: number;\n  delivery_method: string;\n  delivery_address?: string;\n  promocode_text?: string;\n  dd_coins_amount?: number;\n  final_price?: number;\n  preorder_item: {\n    dewu_url: string;\n    size: string;\n    price_cny: number;\n    category_type: string;  // Must be one of: \"обувь\", \"одежда\", \"аксессуары\"\n    delivery_type: string;  // Must be one of: \"cargo\" or \"aero\"\n    quantity: number;\n  };\n}): Promise<CreateStockOrderResponse> => {\n  try {\n    // Validate required fields\n    if (!orderData.telegram_user_id) {\n      throw new Error('Telegram user ID is required');\n    }\n    \n    if (!orderData.preorder_item) {\n      throw new Error('Preorder item details are required');\n    }\n    \n    if (!orderData.preorder_item.dewu_url) {\n      throw new Error('Preorder item URL is required');\n    }\n    \n    if (!orderData.preorder_item.category_type) {\n      throw new Error('Preorder item category type is required');\n    }\n    \n    if (!orderData.preorder_item.delivery_type) {\n      throw new Error('Preorder item delivery type is required');\n    }\n    \n    // Validate category_type\n    const validCategoryTypes = ['обувь', 'одежда', 'аксессуары'];\n    if (!validCategoryTypes.includes(orderData.preorder_item.category_type)) {\n      throw new Error(`Invalid category type. Must be one of: ${validCategoryTypes.join(', ')}`);\n    }\n    \n    // Validate delivery_type\n    const validDeliveryTypes = ['cargo', 'aero'];\n    if (!validDeliveryTypes.includes(orderData.preorder_item.delivery_type)) {\n      throw new Error(`Invalid delivery type. Must be one of: ${validDeliveryTypes.join(', ')}`);\n    }\n    \n    // Validate delivery_address if needed\n    if ((orderData.delivery_method === 'courier' || orderData.delivery_method === 'shipping') && !orderData.delivery_address) {\n      throw new Error('Delivery address is required for courier or shipping delivery method');\n    }\n    \n    // Create a clean request structure as expected by the API\n    const requestData = {\n      telegram_user_id: orderData.telegram_user_id,\n      preorder_item: orderData.preorder_item,\n      delivery_method: orderData.delivery_method,\n      delivery_address: orderData.delivery_address || '',\n      promocode_text: orderData.promocode_text,\n      dd_coins_amount: orderData.dd_coins_amount,\n      final_price: orderData.final_price,\n      quantity: orderData.preorder_item.quantity\n    };\n    \n    const { options, clearTimeout } = createFetchOptions('POST', requestData);\n\n    const response = await fetch(`${API_BASE_URL}/orders/preorder`, options);\n    clearTimeout();\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(errorText || 'Failed to create preorder');\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error creating preorder:', error);\n    throw error;\n  }\n};\n\n/**\n * Calculate shipping cost using the API\n * @param priceCny The price in CNY\n * @param shippingType The shipping type ('cargo' for car, 'aero' for plane)\n * @param category The item category (e.g., 'sneakers', 'hoodie')\n * @returns A promise that resolves to the shipping cost\n */\nexport const calculateShipping = async (\n  priceCny: number,\n  shippingType: string,\n  category: string\n): Promise<number> => {\n  try {\n    // Get user's Telegram ID from local storage or context\n    let telegramUserId = null;\n    try {\n      const userData = localStorage.getItem('telegramUser');\n      if (userData) {\n        const parsedUser = JSON.parse(userData);\n        telegramUserId = parsedUser.id;\n      }\n    } catch (e) {\n      console.error(\"Error retrieving user data from localStorage:\", e);\n    }\n    \n    // Convert shipping type to API format if needed\n    const apiShippingType = shippingType === 'car' ? 'cargo' : shippingType === 'plane' ? 'aero' : shippingType;\n    \n    // Prepare the request body\n    const requestBody = {\n      price_cny: priceCny,\n      shipping_type: apiShippingType,\n      category,\n      telegram_id: telegramUserId // Add the Telegram user ID\n    };\n    \n    console.log('Shipping calculation request:', requestBody);\n    \n    // Make the API call\n    const { options, clearTimeout } = createFetchOptions('POST', requestBody, TIMEOUTS.PRODUCTS);\n    \n    const response = await fetch(`${API_BASE_URL}/orders/calculate-shipping`, options);\n    clearTimeout();\n    \n    console.log(`Response status: ${response.status} ${response.statusText}`);\n    \n    if (!response.ok) {\n      const errorData = await response.json().catch(() => null);\n      console.error('API response not OK:', response.status, response.statusText);\n      console.error('Error data:', errorData);\n      throw new Error(`Failed to calculate shipping: ${errorData?.message || response.statusText}`);\n    }\n    \n    // Get the response\n    const responseData = await response.json();\n    console.log('Shipping calculation response:', responseData);\n    \n    // Return the shipping cost\n    return responseData.shipping_cost;\n  } catch (error: any) {\n    console.error('Error calculating shipping:', error);\n    throw new Error(`Error calculating shipping: ${error.message}`);\n  }\n};\n\n// Add a new function for creating unified orders (both stock and preorder items)\nexport const createUnifiedOrder = async (orderData: {\n  telegram_user_id: number;\n  delivery_method: string;\n  delivery_address?: string;\n  promocode_text?: string;\n  dd_coins_amount?: number;\n  items: {\n    item_type: 'stock' | 'preorder';\n    // For stock items\n    stock_id?: number;\n    sku?: string;\n    size?: string;\n    quantity?: number;\n    // For preorder items\n    dewu_url?: string;\n    category_type?: string;\n    shipping_type?: string;\n    price_cny?: number;\n  }[];\n  final_price?: number;\n}): Promise<CreateStockOrderResponse> => {\n  try {\n    // Validate required fields\n    if (!orderData.items?.length) {\n      throw new Error('Order must contain at least one item');\n    }\n\n    // Prepare the items array in the format expected by the API\n    const items = orderData.items.map(item => {\n      if (item.item_type === 'preorder') {\n        // Validate preorder item fields\n        if (!item.dewu_url) {\n          throw new Error('Preorder item must have a URL');\n        }\n        if (!item.category_type) {\n          throw new Error('Preorder item must have a category type');\n        }\n        if (!item.shipping_type) {\n          throw new Error('Preorder item must have a shipping type');\n        }\n        if (!item.price_cny) {\n          throw new Error('Preorder item must have a price in CNY');\n        }\n        \n        // Validate category_type\n        const validCategoryTypes = ['обувь', 'одежда', 'аксессуары'];\n        if (!validCategoryTypes.includes(item.category_type)) {\n          throw new Error(`Invalid category type for preorder. Must be one of: ${validCategoryTypes.join(', ')}`);\n        }\n        \n        // Validate shipping_type\n        const validShippingTypes = ['cargo', 'aero'];\n        if (!validShippingTypes.includes(item.shipping_type)) {\n          throw new Error(`Invalid shipping type for preorder. Must be one of: ${validShippingTypes.join(', ')}`);\n        }\n\n        // Return preorder item in the format expected by the API\n        return {\n          item_type: 'preorder',\n          dewu_url: item.dewu_url,\n          size: item.size || '',\n          price_cny: item.price_cny,\n          category_type: item.category_type,\n          shipping_type: item.shipping_type,\n          quantity: item.quantity || 1\n        };\n      } else {\n        // Stock item\n        // If stock_id is provided, use that\n        if (item.stock_id) {\n          return {\n            item_type: 'stock',\n            stock_id: item.stock_id\n          };\n        }\n        \n        // Otherwise require sku and size\n        if (!item.sku) {\n          throw new Error('Stock item must have a SKU');\n        }\n        \n        return {\n          item_type: 'stock',\n          sku: item.sku,\n          size: item.size || '',\n          quantity: item.quantity || 1\n        };\n      }\n    });\n\n    // Validate delivery_address if needed\n    if ((orderData.delivery_method === 'courier' || orderData.delivery_method === 'shipping') && !orderData.delivery_address) {\n      throw new Error('Delivery address is required for courier or shipping delivery method');\n    }\n\n    // Prepare the request data\n    const requestData = {\n      telegram_user_id: orderData.telegram_user_id,\n      items: items,\n      delivery_method: orderData.delivery_method,\n      delivery_address: orderData.delivery_address || '',\n      promocode_text: orderData.promocode_text,\n      dd_coins_amount: orderData.dd_coins_amount,\n      final_price: orderData.final_price\n    };\n\n    console.log(\"Sending unified order request:\", JSON.stringify(requestData, null, 2));\n\n    const { options, clearTimeout } = createFetchOptions('POST', requestData);\n\n    const response = await fetch(`${API_BASE_URL}/orders/create-order`, options);\n    clearTimeout();\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      let errorDetail;\n      try {\n        const errorJson = JSON.parse(errorText);\n        errorDetail = errorJson.detail || errorText;\n      } catch (e) {\n        errorDetail = errorText;\n      }\n      throw new Error(errorDetail);\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error creating unified order:', error);\n    throw error;\n  }\n};\n\n/**\n * Fetch available delivery types\n * @returns A promise that resolves to an array of delivery types\n */\nexport const fetchDeliveryTypes = async () => {\n  try {\n    const { options, clearTimeout } = createFetchOptions('GET', undefined, TIMEOUTS.PRODUCTS);\n    \n    const response = await fetch(`${API_BASE_URL}/orders/delivery-types`, options);\n    clearTimeout();\n    \n    if (!response.ok) {\n      const errorData = await response.json().catch(() => null);\n      console.error('API response not OK:', response.status, response.statusText);\n      console.error('Error data:', errorData);\n      throw new Error(`Failed to fetch delivery types: ${errorData?.message || response.statusText}`);\n    }\n    \n    const data = await response.json();\n    return data.delivery_types || [];\n  } catch (error) {\n    console.error('Error fetching delivery types:', error);\n    throw error;\n  }\n};\n","import { toast } from 'sonner';\nimport { API_BASE_URL, createFetchOptions } from './config';\nimport { UpdateClientInfoRequest, UpdateClientInfoResponse, ClientInfoResponse, ClientInfo } from './types';\nimport { getTelegramUser } from './userService';\n\n/**\n * Get client information by Telegram ID\n * @param telegramId The Telegram user ID\n * @returns A promise that resolves to the client information\n */\nexport const getClientInfo = async (telegramId?: number): Promise<ClientInfo | null> => {\n  try {\n    // Get user data if not provided\n    const user = getTelegramUser();\n    const safeId = telegramId || (user ? user.id : null);\n    \n    if (!safeId) {\n      console.error('No Telegram user ID available for client info');\n      toast.error('User data not available');\n      return null;\n    }\n    \n    console.log(`Fetching client info for Telegram ID: ${safeId}`);\n    \n    // Make the API call\n    const { options, clearTimeout } = createFetchOptions('GET');\n    \n    const response = await fetch(`${API_BASE_URL}/clients/by-telegram/${safeId}`, options);\n    clearTimeout();\n    \n    if (!response.ok) {\n      // If user is not found (404), we return null but don't show an error\n      if (response.status === 404) {\n        console.log('Client info not found (404)');\n        return null;\n      }\n      \n      const errorText = await response.text();\n      console.error(`API Error (${response.status}): ${errorText}`);\n      toast.error('Failed to fetch client information');\n      return null;\n    }\n    \n    // Parse response\n    const responseText = await response.text();\n    const clientInfo: ClientInfoResponse = JSON.parse(responseText);\n    \n    console.log('Client info fetched:', clientInfo);\n    return clientInfo;\n  } catch (error) {\n    console.error('Error fetching client info:', error);\n    toast.error('Failed to fetch client information');\n    return null;\n  }\n};\n\n/**\n * Update client information\n * @param phoneNumber Optional phone number to update\n * @param email Optional email to update\n * @param address Optional address to update\n * @param mailingFlg Optional mailing flag to update\n * @returns A promise that resolves to true if successful\n */\nexport const updateClientInfo = async (\n  phoneNumber?: string,\n  email?: string,\n  address?: string,\n  mailingFlg?: boolean\n): Promise<boolean> => {\n  try {\n    // Get user data\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No Telegram user data available');\n      toast.error('User data not available');\n      return false;\n    }\n    \n    console.log(`Updating client info for Telegram ID: ${user.id}`);\n    \n    // Prepare the request body\n    const requestBody: UpdateClientInfoRequest = {\n      telegram_id: user.id\n    };\n    \n    // Add optional fields if provided\n    if (phoneNumber) requestBody.phone_number = phoneNumber;\n    if (email) requestBody.email = email;\n    if (address) requestBody.address = address;\n    if (mailingFlg !== undefined) requestBody.mailing_flg = mailingFlg;\n    \n    console.log('Update client info request:', requestBody);\n    \n    // Make the API call\n    const { options, clearTimeout } = createFetchOptions('POST', requestBody);\n    \n    const response = await fetch(`${API_BASE_URL}/clients/update-info`, options);\n    clearTimeout();\n    \n    // Just check the status code for success (200-299 range)\n    if (response.ok) {\n      console.log(`Client info update successful with status: ${response.status}`);\n      // toast.success('Client information updated successfully');\n      return true;\n    } else {\n      const errorText = await response.text();\n      console.error(`API Error (${response.status}): ${errorText}`);\n      // toast.error('Failed to update client information');\n      return false;\n    }\n  } catch (error) {\n    console.error('Error updating client info:', error);\n    // toast.error('Failed to update client information');\n    return false;\n  }\n};\n\n/**\n * Check if client has all required information\n * @returns A promise that resolves to true if all required information is present\n */\nexport const checkClientInformation = async (): Promise<boolean> => {\n  try {\n    // Get user data\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No Telegram user data available');\n      toast.error('User data not available');\n      return false;\n    }\n    \n    // Get client info\n    const clientInfo = await getClientInfo(user.id);\n    if (!clientInfo) {\n      toast.error('Please provide your contact information before creating an order');\n      return false;\n    }\n    \n    // Check required fields\n    if (!clientInfo.phone_number || !clientInfo.email || !clientInfo.address) {\n      toast.error('Please provide your contact information before creating an order');\n      return false;\n    }\n    \n    return true;\n  } catch (error) {\n    console.error('Error checking client information:', error);\n    // toast.error('Failed to check client information');\n    return false;\n  }\n}; ","import { toast } from 'sonner';\nimport { API_BASE_URL, createFetchOptions } from './config';\nimport { ReferralInfo, CreateReferralResponse, ReferralStats } from './types';\nimport { getTelegramUser } from './userService';\n\n// Define referral service API base\nconst REFERRAL_API_PATH = `${API_BASE_URL}/referrals`;\n\n/**\n * Get or create referral code for current user\n * @returns A promise that resolves to the referral information\n */\nexport const getUserReferralInfo = async (retryAttempt = 0): Promise<ReferralInfo | null> => {\n  try {\n    // Get user data\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No Telegram user data available');\n      toast.error('User data not available');\n      return null;\n    }\n    \n    console.log(`Getting referral info for Telegram ID: ${user.id}`);\n    \n    // Make the API call\n    const { options, clearTimeout } = createFetchOptions('GET');\n    \n    const response = await fetch((`${REFERRAL_API_PATH}/info/${user.id}`), options);\n    clearTimeout();\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(`API Error (${response.status}): ${errorText}`);\n      \n      // If 404, it means the user doesn't have a referral code yet, so we create one\n      if (response.status === 404) {\n        console.log('No referral code found, creating one...');\n        const newReferral = await createReferralCode();\n        if (newReferral) {\n          return newReferral;\n        } else if (retryAttempt === 0) {\n          // Retry once more to get the newly created referral\n          console.log('Retrying to get referral info after creation...');\n          return getUserReferralInfo(1);\n        }\n      }\n      \n      // Only show error toast if we've already retried or it's not a 404\n      if (retryAttempt > 0 || response.status !== 404) {\n        toast.error('Failed to fetch referral information');\n      }\n      return null;\n    }\n    \n    // Parse response\n    const responseText = await response.text();\n    const referralInfo: ReferralInfo = JSON.parse(responseText);\n    \n    console.log('Referral info fetched:', referralInfo);\n    \n    // Validate that the telegram_deep_link is present\n    if (!referralInfo.telegram_deep_link) {\n      console.error('API returned referral info without telegram_deep_link:', referralInfo);\n      \n      // Try to create a new referral code if we haven't retried yet\n      if (retryAttempt === 0) {\n        console.log('Attempting to create a new referral code due to missing link...');\n        const newReferral = await createReferralCode();\n        if (newReferral && newReferral.telegram_deep_link) {\n          return newReferral;\n        }\n      }\n      \n      toast.error('Ошибка: реферальная ссылка отсутствует');\n      return null;\n    }\n    \n    return referralInfo;\n  } catch (error) {\n    console.error('Error fetching referral info:', error);\n    if (retryAttempt === 0) {\n      console.log('Retrying to get referral info after error...');\n      return getUserReferralInfo(1);\n    }\n    toast.error('Failed to fetch referral information');\n    return null;\n  }\n};\n\n/**\n * Create a new referral code for current user\n * @returns A promise that resolves to the referral information\n */\nexport const createReferralCode = async (): Promise<ReferralInfo | null> => {\n  try {\n    // Get user data\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No Telegram user data available');\n      toast.error('User data not available');\n      return null;\n    }\n    \n    console.log(`Creating referral code for Telegram ID: ${user.id}`);\n    \n    // Make the API call\n    const { options, clearTimeout } = createFetchOptions('POST', { telegram_id: user.id });\n    \n    const response = await fetch(`${REFERRAL_API_PATH}/create`, options);\n    clearTimeout();\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(`API Error (${response.status}): ${errorText}`);\n      toast.error('Failed to create referral code');\n      return null;\n    }\n    \n    // Parse response - per the API docs, response is the referral info directly, not wrapped\n    const responseText = await response.text();\n    const referralInfo: ReferralInfo = JSON.parse(responseText);\n    \n    console.log('Referral code created:', referralInfo);\n    \n    // Validate that the telegram_deep_link is present\n    if (!referralInfo.telegram_deep_link) {\n      console.error('API returned created referral without telegram_deep_link:', referralInfo);\n      toast.error('Ошибка: не удалось создать реферальную ссылку');\n      return null;\n    }\n    \n    return referralInfo;\n  } catch (error) {\n    console.error('Error creating referral code:', error);\n    toast.error('Failed to create referral code');\n    return null;\n  }\n};\n\n/**\n * Get referral statistics for current user\n * @returns A promise that resolves to the referral statistics\n */\nexport const getReferralStats = async (): Promise<ReferralStats | null> => {\n  try {\n    // Get user data\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No Telegram user data available');\n      toast.error('User data not available');\n      return null;\n    }\n    \n    console.log(`Getting referral stats for Telegram ID: ${user.id}`);\n    \n    // Make the API call\n    const { options, clearTimeout } = createFetchOptions('GET');\n    \n    const response = await fetch(`${REFERRAL_API_PATH}/stats/${user.id}`, options);\n    clearTimeout();\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(`API Error (${response.status}): ${errorText}`);\n      toast.error('Failed to fetch referral statistics');\n      return null;\n    }\n    \n    // Parse response\n    const responseText = await response.text();\n    const stats: ReferralStats = JSON.parse(responseText);\n    \n    console.log('Referral stats fetched:', stats);\n    return stats;\n  } catch (error) {\n    console.error('Error fetching referral stats:', error);\n    toast.error('Failed to fetch referral statistics');\n    return null;\n  }\n};\n\n/**\n * Share referral link via Telegram\n * @param referralInfo The referral information\n * @returns A promise that resolves to true if successful\n */\nexport const shareReferralLink = async (referralInfo: ReferralInfo): Promise<boolean> => {\n  try {\n    // Validate that referralInfo and telegram_deep_link exist and are not empty\n    if (!referralInfo || !referralInfo.telegram_deep_link) {\n      console.error('Missing referral link:', referralInfo);\n      toast.error('Ошибка: реферальная ссылка отсутствует');\n      return false;\n    }\n    \n    console.log('Sharing referral link:', referralInfo.telegram_deep_link);\n    \n    // Check if the browser supports the Web Share API\n    if (navigator.share) {\n      await navigator.share({\n        title: 'Присоединяйся к DD:CONCEPT',\n        text: `Держи ссылку на приложение DD:CONCEPT!\\n${referralInfo.telegram_deep_link}`,\n        url: referralInfo.telegram_deep_link,\n      });\n      toast.success('Ссылка на DD Store успешно отправлена');\n      return true;\n    } else {\n      // Fallback: copy to clipboard\n      await navigator.clipboard.writeText(referralInfo.telegram_deep_link);\n      toast.success('Реферальная ссылка скопирована в буфер обмена');\n      return true;\n    }\n  } catch (error) {\n    console.error('Error sharing referral link:', error);\n    \n    // Try clipboard fallback if sharing fails\n    try {\n      if (referralInfo && referralInfo.telegram_deep_link) {\n      await navigator.clipboard.writeText(referralInfo.telegram_deep_link);\n      toast.success('Реферальная ссылка скопирована в буфер обмена');\n      return true;\n      } else {\n        throw new Error('Missing referral link');\n      }\n    } catch (clipboardError) {\n      console.error('Clipboard error:', clipboardError);\n      toast.error('Не удалось поделиться реферальной ссылкой');\n      return false;\n    }\n  }\n};\n\n/**\n * Register a referral when a user joins through a referral link\n * @param referralCode The referral code from the URL\n * @returns A promise that resolves to true if successful\n */\nexport const registerReferral = async (referralCode: string): Promise<boolean> => {\n  try {\n    // Get user data\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No Telegram user data available');\n      // Don't show toast here as this might be called on initial page load\n      return false;\n    }\n    \n    console.log(`Registering referral for user ${user.id} with code ${referralCode}`);\n    \n    // Make the API call\n    const { options, clearTimeout } = createFetchOptions('POST', {\n      telegram_id: user.id,\n      referral_code: referralCode\n    });\n    \n    const response = await fetch(`${REFERRAL_API_PATH}/register`, options);\n    clearTimeout();\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(`API Error (${response.status}): ${errorText}`);\n      return false;\n    }\n    \n    // Parse response\n    const responseText = await response.text();\n    const result = JSON.parse(responseText);\n    \n    console.log('Referral registration result:', result);\n    return result.success;\n  } catch (error) {\n    console.error('Error registering referral:', error);\n    return false;\n  }\n};\n\n/**\n * Check if the current user has been referred by someone\n * @returns A promise that resolves to true if the user has been referred\n */\nexport const checkIfUserWasReferred = async (): Promise<boolean> => {\n  try {\n    // Get user data\n    const user = getTelegramUser();\n    if (!user) {\n      console.error('No Telegram user data available');\n      return false;\n    }\n    \n    console.log(`Checking if user ${user.id} was referred`);\n    \n    // Make the API call\n    const { options, clearTimeout } = createFetchOptions('GET');\n    \n    const response = await fetch(`${REFERRAL_API_PATH}/was-referred/${user.id}`, options);\n    clearTimeout();\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(`API Error (${response.status}): ${errorText}`);\n      return false;\n    }\n    \n    // Parse response\n    const responseText = await response.text();\n    const result = JSON.parse(responseText);\n    \n    console.log('User referral check result:', result);\n    return result.was_referred || false;\n  } catch (error) {\n    console.error('Error checking if user was referred:', error);\n    return false;\n  }\n}; ","import { API_BASE_URL, TIMEOUTS, cache, CACHE_CONFIG, createFetchOptions } from './config';\nimport { checkUserProfile /*, getUserRank*/ } from './userService';\nimport { fetchOrders } from './orderService';\nimport { fetchProducts } from './productService';\nimport { TelegramUser, UserProfile, StockItem, Order } from './types';\nimport { toast } from 'sonner';\nimport { getDDCoinsBalance } from './userService';\n\n// Interface for the result of fetchInitialData\nexport interface InitialData {\n  profile: UserProfile | null;\n  orders: Order[];\n  products: StockItem[];\n  ddCoinsBalance: number;\n}\n\n// Cache keys with extended TTL\nconst EXTENDED_CACHE = {\n  DD_COINS: (userId: number) => `dd_coins_${userId}`,\n  DD_COINS_TTL: 5 * 60 * 1000, // 5 minutes\n};\n\n/**\n * Get DD coins balance from cache or API\n * @param userId User ID to get coins for\n * @returns Cached balance or newly fetched balance\n */\nexport const getCachedDDCoinsBalance = async (userId: number): Promise<number> => {\n  // Check cache first\n  const cacheKey = EXTENDED_CACHE.DD_COINS(userId);\n  const cachedBalance = cache.get<number>(cacheKey, EXTENDED_CACHE.DD_COINS_TTL);\n  \n  if (cachedBalance !== null) {\n    console.log('Using cached DD coins balance from optimized service:', cachedBalance);\n    return cachedBalance;\n  }\n  \n  // Fetch and cache if not found\n  try {\n    const balance = await getDDCoinsBalance();\n    cache.set(cacheKey, balance);\n    return balance;\n  } catch (error) {\n    console.error('Error fetching DD coins in optimized service:', error);\n    return 0;\n  }\n};\n\n/**\n * Fetch multiple API resources in parallel\n * This significantly improves loading performance\n */\nexport const fetchInitialData = async (userId: number): Promise<InitialData> => {\n  console.log('Fetching initial data in parallel...');\n  \n  try {\n    // Start all requests simultaneously\n    const results = await Promise.allSettled([\n      checkUserProfile(userId),\n      fetchOrders(),\n      fetchProducts(),\n      getCachedDDCoinsBalance(userId)\n    ]);\n    \n    // Process results\n    const profile = results[0].status === 'fulfilled' ? results[0].value : null;\n    const orders = results[1].status === 'fulfilled' ? results[1].value : [];\n    const products = results[2].status === 'fulfilled' ? results[2].value : [];\n    const ddCoinsBalance = results[3].status === 'fulfilled' ? results[3].value : 0;\n    \n    // Log success or failures\n    if (results[0].status === 'rejected') {\n      console.error('Failed to fetch profile:', results[0].reason);\n    }\n    if (results[1].status === 'rejected') {\n      console.error('Failed to fetch orders:', results[1].reason);\n    }\n    if (results[2].status === 'rejected') {\n      console.error('Failed to fetch products:', results[2].reason);\n    }\n    if (results[3].status === 'rejected') {\n      console.error('Failed to fetch DD coins balance:', results[3].reason);\n    }\n    \n    return { profile, orders, products, ddCoinsBalance };\n  } catch (error) {\n    console.error('Error in parallel fetch:', error);\n    toast.error('Error loading data. Some features may be limited.');\n    \n    // Return empty data to prevent app crashes\n    return {\n      profile: null,\n      orders: [],\n      products: [],\n      ddCoinsBalance: 0\n    };\n  }\n};\n\n/**\n * Prefetch data in the background\n * Call this early in the app lifecycle to warm up the cache\n */\nexport const prefetchData = async (userId: number): Promise<void> => {\n  try {\n    // Start prefetching in the background\n    fetchInitialData(userId)\n      .then(() => console.log('Background prefetch completed'))\n      .catch(error => console.error('Background prefetch failed:', error));\n      \n    // This function returns immediately, not waiting for the prefetch to complete\n    return;\n  } catch (error) {\n    console.error('Error starting prefetch:', error);\n  }\n};\n\n/**\n * Clear all cached data\n * Use this when you want to force fresh data from the API\n */\nexport const clearAllCaches = (): void => {\n  cache.clear();\n  console.log('All API caches cleared');\n};\n\n/**\n * Refresh specific data for a user\n */\nexport const refreshUserData = async (userId: number): Promise<void> => {\n  try {\n    // Clear relevant caches\n    const profileCacheKey = `profile_${userId}`;\n    const ordersCacheKey = `orders_${userId}`;\n    const ddCoinsCacheKey = EXTENDED_CACHE.DD_COINS(userId);\n    \n    cache.invalidate(profileCacheKey);\n    cache.invalidate(ordersCacheKey);\n    cache.invalidate(ddCoinsCacheKey);\n    cache.invalidate('products');\n    \n    // Fetch fresh data\n    await fetchInitialData(userId);\n    \n    toast.success('Data refreshed successfully');\n  } catch (error) {\n    console.error('Error refreshing data:', error);\n    toast.error('Failed to refresh data');\n  }\n}; ","import React, { createContext, useContext, useState, useEffect, ReactNode, useCallback } from 'react';\nimport { getRandomAvatarEmoji } from '../utils/emojiUtils';\nimport { checkUserProfile, UserProfile, TelegramUser } from '../services/api';\nimport { getTelegramUser as getTelegramUserFromAPI } from '../services/api';\nimport { getTelegramUser as getTelegramUserFromUtils } from '../utils/telegramUtils';\nimport { toast } from 'sonner';\nimport { cache } from '../services/api/config';\nimport { prefetchData, refreshUserData as refreshAllUserData } from '../services/api/optimizedService';\n\ninterface UserContextType {\n  username: string;\n  displayName: string;\n  telegramUser: TelegramUser | null;\n  profile: UserProfile | null;\n  avatarEmoji: string;\n  loading: boolean;\n  setUsername: (username: string) => void;\n  setAvatarEmoji: (emoji: string) => void;\n  updateTelegramUser: (user: TelegramUser) => void;\n  refreshUserData: () => Promise<void>;\n}\n\nconst UserContext = createContext<UserContextType | undefined>(undefined);\n\nexport const UserProvider: React.FC<{children: ReactNode}> = ({ children }) => {\n  const [telegramUser, setTelegramUser] = useState<TelegramUser | null>(null);\n  const [username, setUsername] = useState<string>('');\n  const [displayName, setDisplayName] = useState<string>('');\n  const [profile, setProfile] = useState<UserProfile | null>(null);\n  const [avatarEmoji, setAvatarEmoji] = useState(getRandomAvatarEmoji());\n  const [loading, setLoading] = useState(true);\n  const [initAttempted, setInitAttempted] = useState(false);\n\n  // Function to update Telegram user data\n  const updateTelegramUser = useCallback((user: TelegramUser) => {\n    if (!user) return;\n    \n    console.log('Updating Telegram user data:', user);\n    setTelegramUser(user);\n    \n    // Update username if it's available\n    if (user.username) {\n      setUsername(user.username);\n    } else {\n      // If no username, use ID as fallback\n      setUsername(`user_${user.id}`);\n    }\n    \n    // Update display name\n    let fullName = user.first_name;\n    if (user.last_name) {\n      fullName += ` ${user.last_name}`;\n    }\n    setDisplayName(fullName);\n    \n    // Store user data in localStorage for recovery\n    try {\n      localStorage.setItem('telegramUser', JSON.stringify(user));\n      // Remove the old key for consistency\n      if (localStorage.getItem('telegramUserData')) {\n        localStorage.removeItem('telegramUserData');\n      }\n    } catch (e) {\n      console.warn('Failed to store user data in localStorage');\n    }\n    \n    // Start prefetching data in the background\n    const usernameToUse = user.username || `user_${user.id}`;\n    prefetchData(usernameToUse, user.id)\n      .then(() => {\n        // Update profile after prefetch\n        updateUserProfile(usernameToUse, user.id);\n      })\n      .catch(error => {\n        console.error('Error during prefetch:', error);\n        // Still try to update profile even if prefetch fails\n        updateUserProfile(usernameToUse, user.id);\n      });\n  }, []);\n  \n  // Function to update user profile\n  const updateUserProfile = useCallback(async (usernameToUse: string, userId: number) => {\n    try {\n      console.log('Checking user profile...');\n      const userProfile = await checkUserProfile(usernameToUse, userId);\n      console.log('User profile loaded');\n      setProfile(userProfile);\n    } catch (error: any) {\n      console.error('Error fetching user profile:', error);\n      \n      // Set a default profile\n      const defaultProfile = {\n        telegram_username: usernameToUse,\n        rank: 1,\n        total_orders: 0\n      };\n      console.log('Using default profile');\n      setProfile(defaultProfile);\n    }\n  }, []);\n\n  // Function to refresh user data\n  const refreshUserData = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      if (telegramUser) {\n        const usernameToUse = telegramUser.username || `user_${telegramUser.id}`;\n        await refreshAllUserData(usernameToUse, telegramUser.id);\n        \n        // Update profile after refresh\n        await updateUserProfile(usernameToUse, telegramUser.id);\n      } else {\n        toast.error('No user data available for refresh');\n      }\n    } catch (error: any) {\n      console.error('Error refreshing user data:', error);\n      toast.error(`Error refreshing data: ${error.message}`);\n    } finally {\n      setLoading(false);\n    }\n  }, [telegramUser, updateUserProfile]);\n\n  // Function to log raw Telegram data for debugging\n  const logRawTelegramData = useCallback(() => {\n    console.log('DEBUG - RAW TELEGRAM DATA:');\n    \n    // Log window.Telegram if available\n    if (window.Telegram) {\n      console.log('window.Telegram exists');\n      \n      if (window.Telegram.WebApp) {\n        console.log('window.Telegram.WebApp exists');\n        console.log('initData:', window.Telegram.WebApp.initData);\n        \n        if (window.Telegram.WebApp.initDataUnsafe) {\n          console.log('initDataUnsafe contents:', JSON.stringify(window.Telegram.WebApp.initDataUnsafe || {}, null, 2));\n          \n          // Display raw user object if available\n          if (window.Telegram.WebApp.initDataUnsafe.user) {\n            const rawUser = window.Telegram.WebApp.initDataUnsafe.user;\n            console.log('RAW USER OBJECT:', rawUser);\n            return rawUser;\n          } else {\n            console.log('No user data in initDataUnsafe');\n          }\n        } else {\n          console.log('No initDataUnsafe available');\n        }\n        \n        // Try to parse initData if it exists\n        if (window.Telegram.WebApp.initData) {\n          try {\n            const params = new URLSearchParams(window.Telegram.WebApp.initData);\n            console.log('Parsed initData params:', Array.from(params.entries()));\n            \n            if (params.has('user')) {\n              try {\n                const userData = JSON.parse(decodeURIComponent(params.get('user') || '{}'));\n                console.log('User data parsed from initData:', userData);\n                return userData;\n              } catch (e) {\n                console.error('Error parsing user data from initData:', e);\n              }\n            } else {\n              console.log('No user param in initData');\n            }\n          } catch (e) {\n            console.error('Error parsing initData:', e);\n          }\n        } else {\n          console.log('initData is empty');\n        }\n      } else {\n        console.log('No WebApp in Telegram object');\n      }\n    } else {\n      console.log('No Telegram object in window');\n    }\n    \n    return null;\n  }, []);\n\n  // Initialize user data\n  useEffect(() => {\n    if (initAttempted) return;\n    \n    const initializeUserData = async () => {\n      try {\n        setLoading(true);\n        setInitAttempted(true);\n        \n        console.log('Initializing user data...');\n        \n        // APPROACH 1: Try to get user data from Telegram WebApp\n        // This is the recommended approach for Mini Apps\n        const telegramUserData = getTelegramUserFromUtils();\n        \n        if (telegramUserData) {\n          console.log('User data retrieved from Telegram WebApp:', telegramUserData);\n          updateTelegramUser(telegramUserData);\n          setLoading(false);\n          return;\n        }\n        \n        // APPROACH 2: Try to get user data from localStorage\n        try {\n          const storedUser = localStorage.getItem('telegramUser') || localStorage.getItem('telegramUserData');\n          if (storedUser) {\n            const userData = JSON.parse(storedUser) as TelegramUser;\n            console.log('Using stored user data:', userData);\n            updateTelegramUser(userData);\n            setLoading(false);\n            return;\n          }\n        } catch (e) {\n          console.warn('Failed to retrieve user data from localStorage');\n        }\n        \n        // APPROACH 3: Try to get user data from API\n        try {\n          const apiUserData = await getTelegramUserFromAPI();\n          if (apiUserData) {\n            console.log('User data retrieved from API:', apiUserData);\n            updateTelegramUser(apiUserData);\n            setLoading(false);\n            return;\n          }\n        } catch (apiError) {\n          console.error('Error getting user data from API:', apiError);\n        }\n        \n        // If we reach here, we couldn't get user data\n        console.log('No user data available, using default values');\n        setUsername('guest');\n        setDisplayName('Guest User');\n        setLoading(false);\n      } catch (error) {\n        console.error('Error initializing user data:', error);\n        setUsername('guest');\n        setDisplayName('Guest User');\n        setLoading(false);\n      }\n    };\n    \n    initializeUserData();\n  }, [updateTelegramUser, initAttempted]);\n\n  return (\n    <UserContext.Provider value={{\n      username,\n      displayName,\n      telegramUser,\n      profile,\n      avatarEmoji,\n      loading,\n      setUsername,\n      setAvatarEmoji,\n      updateTelegramUser,\n      refreshUserData\n    }}>\n      {children}\n    </UserContext.Provider>\n  );\n};\n\nexport const useUser = (): UserContextType => {\n  const context = useContext(UserContext);\n  if (context === undefined) {\n    throw new Error('useUser must be used within a UserProvider');\n  }\n  return context;\n};\n","import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { toast } from 'sonner';\n\n// This matches more closely what our API structure needs\nexport interface CartItem {\n  productId: string; // SKU from the API\n  name: string;\n  color: string;\n  size: string;\n  price: number;\n  sale_price?: number;\n  quantity: number;\n  item_type?: 'stock' | 'preorder';\n  // For preorder items\n  dewu_url?: string;\n  category_type?: string;\n  delivery_type?: string; // For backward compatibility\n  shipping_type?: string; // New API expects shipping_type\n  price_cny?: number; // Price in Chinese Yuan for preorder items\n  // Image URL for the item\n  photo_url?: string;\n}\n\n// For compatibility with existing code\ninterface Product {\n  id: string; // SKU\n  name: string;\n  color: string;\n  sizes: string[];\n  price: number;\n  quantity: number;\n  photo_url?: string;\n}\n\n// Preorder item interface\ninterface PreorderItem {\n  dewu_url: string;\n  size: string;\n  category_type: string;\n  delivery_type?: string; // For backward compatibility\n  shipping_type?: string; // New API expects shipping_type\n  price: number;\n  price_cny?: number;\n  name: string;\n  photo_url?: string;\n}\n\ninterface CartContextType {\n  items: CartItem[];\n  addToCart: (product: Product, size: string) => void;\n  addPreorderToCart: (preorderItem: PreorderItem) => void;\n  removeFromCart: (productId: string, size: string) => void;\n  clearCart: () => void;\n  itemCount: number;\n  totalPrice: number;\n  updateQuantity: (productId: string, size: string, quantity: number) => void;\n  getItemQuantity: (productId: string, size: string) => number;\n}\n\nconst CartContext = createContext<CartContextType | undefined>(undefined);\n\nexport const CartProvider: React.FC<{children: ReactNode}> = ({ children }) => {\n  const [items, setItems] = useState<CartItem[]>([]);\n  \n  // Calculate total item count and price\n  const itemCount = items.reduce((total, item) => total + item.quantity, 0);\n  const totalPrice = items.reduce((total, item) => total + (item.price * item.quantity), 0);\n\n  // Load cart from localStorage on component mount\n  useEffect(() => {\n    const savedCart = localStorage.getItem('cart');\n    if (savedCart) {\n      try {\n        setItems(JSON.parse(savedCart));\n      } catch (e) {\n        console.error('Failed to parse cart from localStorage:', e);\n      }\n    }\n  }, []);\n\n  // Save cart to localStorage when it changes\n  useEffect(() => {\n    localStorage.setItem('cart', JSON.stringify(items));\n  }, [items]);\n\n  const addToCart = (product: Product, size: string) => {\n    setItems(currentItems => {\n      // Check if this product and size is already in the cart\n      const existingItemIndex = currentItems.findIndex(\n        item => item.productId === product.id && item.size === size\n      );\n\n      if (existingItemIndex >= 0) {\n        // If already in cart, increase quantity\n        const updatedItems = [...currentItems];\n        updatedItems[existingItemIndex].quantity += 1;\n        // Removed toast notification as requested\n        return updatedItems;\n      } else {\n        // Otherwise add new item\n        // Removed toast notification as requested\n        return [...currentItems, {\n          productId: product.id,\n          name: product.name,\n          color: product.color,\n          size,\n          price: product.price,\n          quantity: 1,\n          item_type: 'stock',\n          photo_url: product.photo_url\n        }];\n      }\n    });\n  };\n\n  const addPreorderToCart = (preorderItem: PreorderItem) => {\n    // Generate a unique ID for preorder items using the URL and size\n    const preorderId = `preorder-${btoa(preorderItem.dewu_url)}-${preorderItem.size}`;\n    \n    setItems(currentItems => {\n      // Check if this preorder item is already in the cart\n      const existingItemIndex = currentItems.findIndex(\n        item => item.productId === preorderId\n      );\n\n      if (existingItemIndex >= 0) {\n        // If already in cart, increase quantity\n        const updatedItems = [...currentItems];\n        updatedItems[existingItemIndex].quantity += 1;\n        return updatedItems;\n      } else {\n        // Otherwise add new preorder item\n        return [...currentItems, {\n          productId: preorderId,\n          name: preorderItem.name,\n          color: '',\n          size: preorderItem.size,\n          price: preorderItem.price,\n          quantity: 1,\n          item_type: 'preorder',\n          dewu_url: preorderItem.dewu_url,\n          category_type: preorderItem.category_type,\n          delivery_type: preorderItem.delivery_type, // Keep for backward compatibility\n          shipping_type: preorderItem.shipping_type, // New API field\n          price_cny: preorderItem.price_cny,\n          photo_url: preorderItem.photo_url\n        }];\n      }\n    });\n  };\n\n  const removeFromCart = (productId: string, size: string) => {\n    setItems(currentItems => {\n      const existingItemIndex = currentItems.findIndex(\n        item => item.productId === productId && item.size === size\n      );\n\n      if (existingItemIndex >= 0) {\n        const updatedItems = [...currentItems];\n        if (updatedItems[existingItemIndex].quantity > 1) {\n          // If quantity > 1, just decrease quantity\n          updatedItems[existingItemIndex].quantity -= 1;\n        } else {\n          // Otherwise remove the item\n          updatedItems.splice(existingItemIndex, 1);\n        }\n        return updatedItems;\n      }\n      return currentItems;\n    });\n  };\n\n  const updateQuantity = (productId: string, size: string, quantity: number) => {\n    setItems(currentItems => {\n      const existingItemIndex = currentItems.findIndex(\n        item => item.productId === productId && item.size === size\n      );\n\n      if (existingItemIndex >= 0) {\n        const updatedItems = [...currentItems];\n        if (quantity <= 0) {\n          // Remove item if quantity is 0 or less\n          updatedItems.splice(existingItemIndex, 1);\n        } else {\n          // Update quantity\n          updatedItems[existingItemIndex].quantity = quantity;\n        }\n        return updatedItems;\n      } else if (quantity > 0) {\n        // If item doesn't exist but quantity > 0, we can't add it without product details\n        console.warn('Attempted to update quantity for non-existent item');\n      }\n      return currentItems;\n    });\n  };\n\n  const getItemQuantity = (productId: string, size: string): number => {\n    const item = items.find(item => item.productId === productId && item.size === size);\n    return item ? item.quantity : 0;\n  };\n\n  const clearCart = () => {\n    setItems([]);\n    // toast.info('Cart cleared');\n  };\n\n  return (\n    <CartContext.Provider value={{\n      items,\n      addToCart,\n      addPreorderToCart,\n      removeFromCart,\n      clearCart,\n      itemCount,\n      totalPrice,\n      updateQuantity,\n      getItemQuantity\n    }}>\n      {children}\n    </CartContext.Provider>\n  );\n};\n\nexport const useCart = (): CartContextType => {\n  const context = useContext(CartContext);\n  if (context === undefined) {\n    throw new Error('useCart must be used within a CartProvider');\n  }\n  return context;\n};\n","import { useEffect, useState } from 'react';\nimport { registerReferral } from '@/services/api';\n\n/**\n * Hook to handle referral detection and registration\n */\nexport const useReferral = () => {\n  const [referralCode, setReferralCode] = useState<string | null>(null);\n  const [isProcessing, setIsProcessing] = useState<boolean>(false);\n  const [isProcessed, setIsProcessed] = useState<boolean>(false);\n  \n  // On mount, check URL for referral code\n  useEffect(() => {\n    const detectReferralCode = () => {\n      try {\n        // Get current URL\n        const url = new URL(window.location.href);\n        \n        // Check for referral code in search params\n        const code = url.searchParams.get('ref');\n        \n        // Also check for \"start\" parameter with ref_ prefix (Telegram deep link format)\n        const startParam = url.searchParams.get('start');\n        if (startParam && startParam.startsWith('ref_')) {\n          const telegramCode = startParam.substring(4); // Remove 'ref_' prefix\n          if (telegramCode) {\n            console.log('Referral code detected from Telegram deep link:', telegramCode);\n            setReferralCode(telegramCode);\n            // Remove the start parameter from the URL without refreshing the page\n            url.searchParams.delete('start');\n            window.history.replaceState({}, document.title, url.toString());\n            return;\n          }\n        }\n        \n        // Check path for /ref/CODE format\n        const pathParts = window.location.pathname.split('/');\n        if (pathParts.length >= 3 && pathParts[1] === 'ref') {\n          const pathCode = pathParts[2];\n          if (pathCode) {\n            console.log('Referral code detected from path:', pathCode);\n            setReferralCode(pathCode);\n            // Remove the referral code from the path without refreshing the page\n            const newPath = window.location.pathname.replace(/\\/ref\\/[^\\/]+/, '');\n            window.history.replaceState({}, document.title, newPath + window.location.search);\n            return;\n          }\n        }\n        \n        if (code) {\n          console.log('Referral code detected from query parameter:', code);\n          setReferralCode(code);\n          \n          // Remove the referral code from the URL without refreshing the page\n          url.searchParams.delete('ref');\n          window.history.replaceState({}, document.title, url.toString());\n        }\n      } catch (error) {\n        console.error('Error detecting referral code:', error);\n      }\n    };\n    \n    detectReferralCode();\n  }, []);\n  \n  // When referral code is detected, register it\n  useEffect(() => {\n    const processReferral = async () => {\n      if (!referralCode || isProcessed || isProcessing) return;\n      \n      setIsProcessing(true);\n      try {\n        // Store in local storage first to prevent duplicate processing\n        const processedReferrals = JSON.parse(localStorage.getItem('processedReferrals') || '[]');\n        \n        // If this referral was already processed, skip\n        if (processedReferrals.includes(referralCode)) {\n          console.log('Referral already processed:', referralCode);\n          setIsProcessed(true);\n          setIsProcessing(false);\n          return;\n        }\n        \n        // Call the API to register the referral\n        const success = await registerReferral(referralCode);\n        \n        if (success) {\n          console.log('Referral registered successfully');\n          \n          // Add to processed referrals\n          processedReferrals.push(referralCode);\n          localStorage.setItem('processedReferrals', JSON.stringify(processedReferrals));\n        }\n        \n        setIsProcessed(true);\n      } catch (error) {\n        console.error('Error processing referral:', error);\n      } finally {\n        setIsProcessing(false);\n      }\n    };\n    \n    processReferral();\n  }, [referralCode, isProcessed, isProcessing]);\n  \n  return {\n    referralCode,\n    isProcessing,\n    isProcessed\n  };\n};\n\nexport default useReferral; ","import { useState, useEffect } from 'react';\nimport { checkUserExists } from '@/services/api';\nimport { getTelegramUser } from '@/services/api/userService';\nimport { UserExistsResponse } from '@/services/api/types';\n\ninterface UseRegistrationOptions {\n  onNewUser?: (isNew: boolean) => void;\n}\n\n/**\n * Hook to handle user registration status and processing\n */\nexport const useRegistration = (options?: UseRegistrationOptions) => {\n  const [isNewUser, setIsNewUser] = useState<boolean>(false);\n  const [isChecking, setIsChecking] = useState<boolean>(false);\n  const [hasChecked, setHasChecked] = useState<boolean>(false);\n  \n  useEffect(() => {\n    const checkUserRegistration = async () => {\n      if (hasChecked || isChecking) return;\n      \n      setIsChecking(true);\n      \n      try {\n        // Get the Telegram user\n        const user = getTelegramUser();\n        if (!user) {\n          console.log('No Telegram user available, cannot check registration status');\n          setIsChecking(false);\n          return;\n        }\n        \n        // Check if user exists in the API\n        const checkResponse = await checkUserExists(true);\n        console.log('User check response:', checkResponse);\n        \n        // Handle response object\n        if (checkResponse && typeof checkResponse !== 'boolean') {\n          const response = checkResponse as UserExistsResponse;\n          \n          // The is_new_client field tells us if this is a new user\n          setIsNewUser(response.is_new_client);\n          \n          // Call the onNewUser callback if provided and this is a new user\n          if (response.is_new_client && options?.onNewUser) {\n            options.onNewUser(true);\n          }\n        } else {\n          setIsNewUser(false);\n        }\n        \n        setHasChecked(true);\n      } catch (error) {\n        console.error('Error checking user registration:', error);\n      } finally {\n        setIsChecking(false);\n      }\n    };\n    \n    checkUserRegistration();\n  }, [hasChecked, isChecking, options]);\n  \n  return {\n    isNewUser,\n    isChecking,\n    hasChecked\n  };\n};\n\nexport default useRegistration; ","/**\n * Utility function to aggressively scroll to the top of the page\n * Uses multiple methods and attempts to ensure maximum compatibility\n */\nexport const scrollToTop = () => {\n  // Method 1: Basic window.scrollTo\n  window.scrollTo(0, 0);\n  \n  // Method 2: With options object\n  window.scrollTo({\n    top: 0,\n    behavior: 'auto' // Using 'auto' for immediate effect\n  });\n  \n  // Method 3: Document element scroll (for some browsers)\n  if (document.documentElement) {\n    document.documentElement.scrollTop = 0;\n  }\n  \n  // Method 4: Body scroll (for older browsers)\n  if (document.body) {\n    document.body.scrollTop = 0;\n  }\n  \n  console.log('scrollToTop utility function executed');\n};\n\n/**\n * Scroll to top with multiple attempts over time\n * This helps with complex layouts that might take time to render\n */\nexport const scrollToTopWithRetries = () => {\n  // Execute immediately\n  scrollToTop();\n  \n  // Then try multiple times with delays\n  const delays = [10, 50, 100, 200, 500];\n  const timeouts = delays.map(delay => setTimeout(scrollToTop, delay));\n  \n  // Return a cleanup function to clear all timeouts\n  return () => timeouts.forEach(timeout => clearTimeout(timeout));\n}; ","export default \"data:image/webp;base64,UklGRiwDAABXRUJQVlA4ICADAACQQwCdASpiAoUBPpFIoE0lpCMiIAgAsBIJaW7hcQEqxNZ99z/6/h/84fwCt/3P+5A8/5G0AJ7APfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D322aG7z1FT956ip+89RU/eeoqfvPUVM7PUVP3nqKn7z1FT956ip+89RU/eealYCrJtsBVk22AqybbAVZNtgKsm2vA+mHBi2Lckw/l5qYfL2kOjk+SgRyaIEdZNtgKsm2wFWTbYCrJtsBVk22ASNH6I6ybbAVZNtgKsm2wFWTbYCrJgaCrJtsBVk22AqybbAVZNtgKsm2wFM1Sqn8nbgw+TtwYfJ24MPk7cGHydtjJ9NtgKsm2wFWTbYCrJtsBVk22AqvAaI6ybamLOfNgKsm2wEcvDkCrJtqMrJtsBVk22AqybbAVZNtgKsm2wFWSJ6n8nbj5bFtwYfJ24MPl7SGHyduC/YqhJP5e2wFWTbYCrJtsBVk22Aqya7sPk7cHRy8ODD5O3Bh/Lckw+TtwYddUJJ/J24MPk7cGHyduDD5O3Bh8nbYzWTDkCOXtqYf021MWxblARyfNgI2wAA/v5r0AAAAAAAAAAAAAAPK6tAEMNI4DopnQ5qGV4JSELz2aXNZvl6qQPP1x3gAAAAZY8NwDoYIQBsBZDNHfON9N/b3wxoY0MaGNDGhjQxoY0MaGNDGhjQxoY0MdDBJNk1VAAAAAAY/N4vkUe78sBNR43M7wAAjnR/74MsGWDLBldgiWYOmlsWQqDb9N9+1vpv7e+GNDHQwSYU7wR+6vOjYAAAAtpp+s1vrfW+VqpT4qVjGhjQxoY0MY8VKfFSsY0MaGNDHQw0dec8TtSJvo+zd7p1Ou5snvdOp1/UmL4ZJKh1GFX7F0FVEOVal7TH0E+NjYTLdo7WQgAAAA==\"","import { useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { scrollToTopWithRetries } from '@/utils/scrollUtils';\n\n/**\n * A hook that scrolls the window to the top when the pathname changes.\n * Uses the scrollUtils utility for maximum reliability.\n */\nexport const useScrollToTop = () => {\n  const { pathname } = useLocation();\n  \n  useEffect(() => {\n    // Use our utility function that handles multiple scroll attempts\n    const cleanup = scrollToTopWithRetries();\n    console.log(`useScrollToTop hook executed for path: ${pathname}`);\n    \n    // Return the cleanup function to clear all timeouts\n    return cleanup;\n  }, [pathname]);\n}; ","export default \"__VITE_ASSET__BT9VmGaE__\"","export default \"__VITE_ASSET__ohROuENH__\"","export default \"__VITE_ASSET__CGTg03qG__\"","export default \"__VITE_ASSET__oIAFCLbW__\"","export default \"__VITE_ASSET__BI3pfTEQ__\"","export default \"__VITE_ASSET__D$B$jYVY__\"","export default \"__VITE_ASSET__B62wRg6Z__\"","export default \"__VITE_ASSET__C83Z$dNv__\"","export default \"__VITE_ASSET__CZglLt8a__\"","export default \"__VITE_ASSET__BeZ$_I9F__\"","export default \"__VITE_ASSET__CNwoawTR__\"","export default \"__VITE_ASSET__CW8WOjCh__\"","export default \"__VITE_ASSET__DJYUCyEQ__\"","import React, { useEffect, useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport PageLayout from '@/components/PageLayout';\nimport UserAvatar from '@/components/UserAvatar';\nimport { ArrowRight } from 'lucide-react';\nimport { useUser } from '@/contexts/UserContext';\nimport { getRandomBannerEmoji } from '@/utils/emojiUtils';\nimport { hapticSelection } from '@/utils/telegramUtils';\nimport { checkUserExists } from '@/services/api';\nimport { toast } from 'sonner';\nimport LoadingSpinner from '@/components/LoadingSpinner';\nimport BannerSwiper from '@/components/BannerSwiper';\nimport DDManagerCard from '@/components/DDManagerCard';\nimport ProductCard from '@/components/ProductCard';\nimport { useScrollToTop } from '@/hooks/useScrollToTop';\nimport Stories, { StoryContent } from '@/components/Stories';\nimport StoryViewer from '@/components/StoryViewer';\n\n// Import CSS\nimport '@/components/NoScrollbar.css';\n\n// Import banner images\nimport mainBanner from '@/assets/jointgbanner.webp';\nimport csBanner from '@/assets/catsofa_banner.webp';\nimport ddCoinsBanner from '@/assets/ddcoins_banner.webp';\nimport calculatorBanner from '@/assets/calcbanner.webp';\nimport shopBanner from '@/assets/gotoshopbanner.webp';\nimport sneakersBanner from '@/assets/sneakers_category_banner.webp';\nimport clothesBanner from '@/assets/clothes_category_banner.webp';\nimport jeansBanner from '@/assets/jeans_category_banner.webp';\nimport beltBanner from '@/assets/belt_category_banner.webp';\n\n// Import story images\nimport stPreviewImage from '@/assets/stories/guide_story_preview.png';\nimport stBeginnerGuide1 from '@/assets/stories/story_rebuilt_1.png';\nimport stBeginnerGuide2 from '@/assets/stories/Instagram story - 7.png';\nimport stBeginnerGuide3 from '@/assets/stories/Instagram story - 8.png';\n\nconst Home: React.FC = () => {\n  useScrollToTop();\n  const { username, displayName, telegramUser, avatarEmoji, updateTelegramUser } = useUser();\n  const navigate = useNavigate();\n  const [ddCoinsBalance, setDDCoinsBalance] = useState<number>(0);\n  const [isLoadingDDCoins, setIsLoadingDDCoins] = useState<boolean>(false);\n  \n  // Story state\n  const [selectedStory, setSelectedStory] = useState<StoryContent | null>(null);\n  const [viewedStoryIds, setViewedStoryIds] = useState<string[]>([]);\n\n  // Stories data\n  const stories: StoryContent[] = [\n    {\n      id: 'beginner-guide',\n      title: 'Краткий гайд',\n      previewImage: stPreviewImage,\n      images: [stBeginnerGuide1, stBeginnerGuide2, stBeginnerGuide3],\n      viewed: viewedStoryIds.includes('beginner-guide')\n    }\n  ];\n\n  // Handle story click\n  const handleStoryClick = (storyId: string) => {\n    hapticSelection();\n    const story = stories.find(s => s.id === storyId);\n    if (story) {\n      setSelectedStory(story);\n    }\n  };\n\n  // Mark story as viewed\n  const handleStoryViewed = (storyId: string) => {\n    if (!viewedStoryIds.includes(storyId)) {\n      setViewedStoryIds(prev => [...prev, storyId]);\n    }\n  };\n\n  // Fetch DD coins when the component mounts\n  useEffect(() => {\n    // Only fetch DD coins if we have a user already\n    if (telegramUser?.id) {\n      fetchDDCoins(telegramUser.id);\n    }\n  }, [telegramUser]);\n\n  // Fetch DD coins balance from user check endpoint\n  const fetchDDCoins = async (userId: number) => {\n    if (!userId) return;\n    \n    setIsLoadingDDCoins(true);\n    try {\n      console.log(`Fetching DD coins for user ID: ${userId}`);\n      const response = await checkUserExists(true);\n      \n      if (response && typeof response !== 'boolean') {\n        console.log('Home page: DD coins balance received:', response.dd_coins_balance);\n        setDDCoinsBalance(response.dd_coins_balance);\n        \n        // Show welcome toast for new users\n        if (response.is_new_client && response.dd_coins_balance === 500) {\n          // Add a delay to ensure the toast appears after the app has loaded\n          setTimeout(() => {\n            toast.success(\n              \"Добро пожаловать! Только что начислили вам 500 $DD коинов в честь нашего знакомства!\",\n              { duration: 6000 }\n            );\n          }, 1500); // 1.5 second delay\n        }\n      } else {\n        console.error('Failed to get DD coins balance from user check');\n        setDDCoinsBalance(0);\n      }\n    } catch (error) {\n      console.error('Error fetching DD coins balance:', error);\n      toast.error('Failed to load DD coins balance');\n    } finally {\n      setIsLoadingDDCoins(false);\n    }\n  };\n\n  // Banner data\n  const banners = [\n    {\n      image: ddCoinsBanner,\n      link: '/profile'\n    },\n    {\n      image: mainBanner,\n      link: 'https://t.me/dd_concept',\n      external: true\n    },\n    {\n      image: csBanner, \n      link: '/shop?brand=Cat%26Sofa'\n    }\n  ];\n\n  // Get the display username - prioritize Telegram username if available\n  const displayUsername = telegramUser?.username || username;\n  \n  // Handle profile click with haptic feedback\n  const handleProfileClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    \n    // Trigger selection haptic feedback\n    hapticSelection();\n    \n    // Navigate to profile page\n    navigate('/profile');\n  };\n\n  return (\n    <PageLayout fullHeight className=\"p-4 pb-20\">\n      <header className=\"mb-6\">\n        {/* Create a container for better control over spacing and alignment */}\n        <div className=\"pt-2\">\n          {/* Images row - perfectly aligned */}\n          <div className=\"flex items-center\">\n            {/* User profile section */}\n            <div className=\"flex flex-col items-center shrink-0 mr-6\">\n              {/* Avatar with glow effect */}\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 bg-telegram-blue/50 rounded-full blur-lg animate-pulse-slow\"></div>\n                <div \n                  className=\"cursor-pointer\" \n                  onClick={handleProfileClick}\n                >\n                  <UserAvatar \n                    user={telegramUser}\n                    emoji={avatarEmoji} \n                    size=\"lg\" \n                    className=\"relative z-10 hover-lift\"\n                  />\n                </div>\n              </div>\n              \n              {/* Text labels for profile */}\n              <div className=\"flex flex-col items-center text-center mt-1\">\n                <span className=\"text-xs text-gray-600 dark:text-gray-400 truncate w-16\">\n                  @{displayUsername}\n                </span>\n                <span className=\"text-xs font-medium text-telegram-blue\">\n                  DD:Профиль\n                </span>\n              </div>\n            </div>\n            \n            {/* Stories section */}\n            <div className=\"flex-1 overflow-x-auto no-scrollbar\">\n              <Stories stories={stories} onStoryClick={handleStoryClick} />\n            </div>\n          </div>\n        </div>\n      </header>\n      \n      {/* Story viewer */}\n      {selectedStory && (\n        <StoryViewer \n          story={selectedStory} \n          onClose={() => setSelectedStory(null)}\n          onStoryViewed={handleStoryViewed}\n        />\n      )}\n\n      <section className=\"mb-8 animate-slide-up\">\n        <BannerSwiper banners={banners} />\n      </section>\n\n      {/* Three blocks with updated layout */}\n      <section className=\"mb-8\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          {/* Order Block - takes 1 column and full height */}\n          <Link \n            to=\"/shop\" \n            className=\"bg-cover bg-center rounded-lg p-4 h-full col-span-1 shadow-sm hover-lift flex flex-col justify-end\"\n            style={{ backgroundImage: `url(${shopBanner})` }}\n          >\n            <div className=\"flex justify-between items-center\">\n              <h3 className=\"text-xl font-medium text-white\">Заказать</h3>\n              <ArrowRight size={20} className=\"text-white\" />\n            </div>\n          </Link>\n\n          {/* Right column blocks stacked vertically */}\n          <div className=\"col-span-1 space-y-4\">\n            {/* DD Coins Block */}\n            <Link \n              to=\"/profile\" \n              className=\"bg-telegram-blue text-white dark:bg-telegram-blue rounded-lg p-4 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1 flex flex-col justify-between\"\n            >\n              <h3 className=\"font-medium text-white\">$DD COINS:</h3>\n              <div className=\"text-4xl font-bold mb-1 text-white\">\n                {isLoadingDDCoins ? (\n                  <div className=\"flex items-center justify-center h-10\">\n                    <LoadingSpinner size=\"md\" className=\"text-white\" />\n                  </div>\n                ) : (\n                  ddCoinsBalance || 0\n                )}\n              </div>\n              <p className=\"text-xs text-white/80\">Баланс и реферальная программа</p>\n              <div className=\"flex justify-end mt-1\">\n                <ArrowRight size={20} className=\"text-white\" />\n              </div>\n            </Link>\n\n            {/* DD Manager Block */}\n            <DDManagerCard />\n          </div>\n        </div>\n        \n        {/* Delivery Calculator Button - Full Width */}\n        <Link \n          to=\"/calculator\"\n          onClick={() => window.scrollTo(0, 0)} \n          className=\"w-full rounded-lg overflow-hidden relative hover-lift h-16 block mt-4\"\n          style={{ \n            backgroundImage: `url(${calculatorBanner})`,\n            backgroundSize: 'cover',\n            backgroundPosition: 'center'\n          }}\n        >\n          <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent\"></div>\n          <div className=\"absolute inset-0 flex items-center p-4\">\n            <h3 className=\"font-medium text-white text-lg flex-1 text-center\">Рассчитать доставку</h3>\n            <ArrowRight className=\"text-white\" size={20} />\n          </div>\n        </Link>\n      </section>\n\n      <section className=\"mb-8\">\n        <h2 className=\"text-xl font-medium mb-4\">Что купить?</h2>\n        <div className=\"grid grid-cols-2 gap-4 mb-4\">\n          <Link \n            to=\"/shop?category=обувь\" \n            className=\"rounded-lg overflow-hidden relative hover-lift aspect-[5/3]\"\n            style={{ \n              backgroundImage: `url(${sneakersBanner})`,\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }}\n          >\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent\"></div>\n            <div className=\"absolute bottom-0 w-full p-4 flex justify-between items-center\">\n              <h3 className=\"font-medium text-white\">Кроссовки</h3>\n              <ArrowRight className=\"text-white\" size={20} />\n            </div>\n          </Link>\n          <Link \n            to=\"/shop?category=верх\" \n            className=\"rounded-lg overflow-hidden relative hover-lift aspect-[5/3]\"\n            style={{ \n              backgroundImage: `url(${clothesBanner})`,\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }}\n          >\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent\"></div>\n            <div className=\"absolute bottom-0 w-full p-4 flex justify-between items-center\">\n              <h3 className=\"font-medium text-white\">Верх</h3>\n              <ArrowRight className=\"text-white\" size={20} />\n            </div>\n          </Link>\n          <Link \n            to=\"/shop?category=низ\" \n            className=\"rounded-lg overflow-hidden relative hover-lift aspect-[5/3]\"\n            style={{ \n              backgroundImage: `url(${jeansBanner})`,\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }}\n          >\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent\"></div>\n            <div className=\"absolute bottom-0 w-full p-4 flex justify-between items-center\">\n              <h3 className=\"font-medium text-white\">Низ</h3>\n              <ArrowRight className=\"text-white\" size={20} />\n            </div>\n          </Link>\n          <Link \n            to=\"/shop?category=аксессуары\" \n            className=\"rounded-lg overflow-hidden relative hover-lift aspect-[5/3]\"\n            style={{ \n              backgroundImage: `url(${beltBanner})`,\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }}\n          >\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent\"></div>\n            <div className=\"absolute bottom-0 w-full p-4 flex justify-between items-center\">\n              <h3 className=\"font-medium text-white\">Аксессуары</h3>\n              <ArrowRight className=\"text-white\" size={20} />\n            </div>\n          </Link>\n        </div>\n      </section>\n    </PageLayout>\n  );\n};\n\nexport default Home;\n","/**\n * Sorts sizes from smaller to larger (numeric sizes in ascending order, string sizes from XS to XXL)\n * @param sizes Array of size strings to sort\n * @returns Sorted array of sizes\n */\nexport const sortSizes = (sizes: string[]): string[] => {\n  // Helper function to determine if a size is numeric\n  const isNumeric = (size: string): boolean => /^[\\d.,]+$/.test(size);\n  \n  // Helper function to convert letter sizes to a numeric value for sorting\n  const getLetterSizeValue = (size: string): number => {\n    const sizeMap: Record<string, number> = {\n      'XXXS': 1, 'XXS': 2, 'XS': 3, 'S': 4, 'M': 5, 'L': 6, 'XL': 7, 'XXL': 8, 'XXXL': 9,\n      '3XS': 1, '2XS': 2, '3XL': 9\n    };\n    \n    // Normalize size by removing spaces and converting to uppercase\n    const normalizedSize = size.toUpperCase().trim();\n    \n    // Return the mapped value or a high number (to put unknown sizes at the end)\n    return sizeMap[normalizedSize] || 999;\n  };\n  \n  // Separate numeric and non-numeric sizes\n  const numericSizes = sizes.filter(isNumeric);\n  const letterSizes = sizes.filter(size => !isNumeric(size));\n  \n  // Sort numeric sizes numerically (ascending)\n  const sortedNumericSizes = numericSizes.sort((a, b) => parseFloat(a) - parseFloat(b));\n  \n  // Sort letter sizes by their mapped value\n  const sortedLetterSizes = letterSizes.sort((a, b) => getLetterSizeValue(a) - getLetterSizeValue(b));\n  \n  // Return numeric sizes first, then letter sizes\n  return [...sortedNumericSizes, ...sortedLetterSizes];\n}; ","import React, { useState, useEffect, useMemo } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { Filter, Search, ShoppingCart, X, Tag, ArrowUpDown } from 'lucide-react';\nimport { Link, useSearchParams, useNavigate } from 'react-router-dom';\nimport PageLayout from '@/components/PageLayout';\nimport ProductCard from '@/components/ProductCard';\nimport LoadingSpinner from '@/components/LoadingSpinner';\nimport { fetchProducts, fetchCategories, StockItem, Category } from '@/services/api';\nimport { toast } from 'sonner';\nimport { useCart } from '@/contexts/CartContext';\nimport { useScrollToTop } from '@/hooks/useScrollToTop';\n\n// Sort types\ntype SortType = 'category-asc' | 'category-desc' | 'price-asc' | 'price-desc';\n\n// Category order for sorting\nconst CATEGORY_ORDER = ['обувь', 'низ', 'верх', 'аксессуары'];\n\nconst Shop: React.FC = () => {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedSizes, setSelectedSizes] = useState<string[]>([]);\n  const [selectedBrands, setSelectedBrands] = useState<string[]>([]);\n  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);\n  const [showFilters, setShowFilters] = useState(false);\n  const [showSortOptions, setShowSortOptions] = useState(false);\n  const [sortBy, setSortBy] = useState<SortType>('category-asc');\n  const { itemCount } = useCart();\n\n  useScrollToTop();\n\n  // Fetch products using React Query with retry and longer staleTime\n  const { data: products, isLoading, error, isError, refetch } = useQuery({\n    queryKey: ['products'],\n    queryFn: fetchProducts,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n    retry: 1,\n    retryDelay: 1000,\n  });\n\n  // Fetch categories using React Query\n  const { data: categories } = useQuery({\n    queryKey: ['categories'],\n    queryFn: fetchCategories,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n    retry: 1,\n    retryDelay: 1000,\n  });\n  \n  // Parse URL parameters on initial load\n  useEffect(() => {\n    const brandParam = searchParams.get('brand');\n    const categoryParam = searchParams.get('category');\n    const sizeParam = searchParams.get('size');\n    const searchParam = searchParams.get('search');\n    const sortParam = searchParams.get('sort');\n    \n    if (brandParam) {\n      setSelectedBrands(brandParam.split(','));\n    }\n    \n    if (categoryParam) {\n      setSelectedCategories(categoryParam.split(','));\n    }\n    \n    if (sizeParam) {\n      setSelectedSizes(sizeParam.split(','));\n    }\n    \n    if (searchParam) {\n      setSearchTerm(searchParam);\n    }\n\n    if (sortParam && ['category-asc', 'category-desc', 'price-asc', 'price-desc'].includes(sortParam)) {\n      setSortBy(sortParam as SortType);\n    }\n  }, [searchParams]);\n\n  // Update URL parameters when filters change\n  useEffect(() => {\n    const newParams = new URLSearchParams();\n    \n    if (selectedBrands.length > 0) {\n      newParams.set('brand', selectedBrands.join(','));\n    }\n    \n    if (selectedCategories.length > 0) {\n      newParams.set('category', selectedCategories.join(','));\n    }\n    \n    if (selectedSizes.length > 0) {\n      newParams.set('size', selectedSizes.join(','));\n    }\n    \n    if (searchTerm) {\n      newParams.set('search', searchTerm);\n    }\n    \n    if (sortBy !== 'category-asc') {\n      newParams.set('sort', sortBy);\n    }\n    \n    // Only update if params actually changed to avoid needless history entries\n    if (newParams.toString() !== searchParams.toString()) {\n      setSearchParams(newParams);\n    }\n  }, [selectedBrands, selectedCategories, selectedSizes, searchTerm, sortBy, setSearchParams, searchParams]);\n\n  useEffect(() => {\n    if (isError && error instanceof Error) {\n      toast.error(`Shop error: ${error.message}`);\n    }\n  }, [isError, error]);\n\n  // Extract all available sizes from products\n  const availableSizes = useMemo(() => {\n    if (!products) return [];\n    \n    const sizes = new Set<string>();\n    \n    products.forEach(product => {\n      if (Array.isArray(product.sizes)) {\n        product.sizes.forEach(sizeObj => {\n          if (sizeObj.quantity > 0) {\n            sizes.add(sizeObj.size);\n          }\n        });\n      }\n    });\n    \n    return Array.from(sizes).sort();\n  }, [products]);\n  \n  // Extract all available brands from products\n  const availableBrands = useMemo(() => {\n    if (!products) return [];\n    \n    const brands = new Set<string>();\n    \n    products.forEach(product => {\n      if (product.brand) {\n        brands.add(product.brand);\n      }\n    });\n    \n    return Array.from(brands).sort();\n  }, [products]);\n  \n  // Extract all available categories from products\n  const availableCategories = useMemo(() => {\n    if (!products) return [];\n    \n    const categorySet = new Set<string>();\n    \n    products.forEach(product => {\n      if (product.category) {\n        categorySet.add(product.category);\n      }\n    });\n    \n    return Array.from(categorySet).sort();\n  }, [products]);\n\n  // Toggle size selection\n  const toggleSizeSelection = (size: string) => {\n    setSelectedSizes(prev => {\n      if (prev.includes(size)) {\n        return prev.filter(s => s !== size);\n      } else {\n        return [...prev, size];\n      }\n    });\n  };\n  \n  // Toggle brand selection\n  const toggleBrandSelection = (brand: string) => {\n    setSelectedBrands(prev => {\n      if (prev.includes(brand)) {\n        return prev.filter(b => b !== brand);\n      } else {\n        return [...prev, brand];\n      }\n    });\n  };\n  \n  // Toggle category selection\n  const toggleCategorySelection = (category: string) => {\n    setSelectedCategories(prev => {\n      if (prev.includes(category)) {\n        return prev.filter(c => c !== category);\n      } else {\n        return [...prev, category];\n      }\n    });\n  };\n\n  // Filter products based on search term, selected sizes, brands, and categories\n  const filteredProducts = useMemo(() => {\n    if (!products) return [];\n    \n    return products.filter(product => {\n      // Filter by search term\n      const matchesSearch = searchTerm === '' || \n                           product.item_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                           product.color_code.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                           (product.brand && product.brand.toLowerCase().includes(searchTerm.toLowerCase()));\n      \n      // Filter by sizes - if no sizes selected, show all\n      const matchesSize = selectedSizes.length === 0 || \n                          (Array.isArray(product.sizes) && \n                           product.sizes.some(s => selectedSizes.includes(s.size) && s.quantity > 0));\n      \n      // Filter by brands - if no brands selected, show all\n      const matchesBrand = selectedBrands.length === 0 || \n                          (product.brand && selectedBrands.includes(product.brand));\n      \n      // Filter by categories - if no categories selected, show all\n      const matchesCategory = selectedCategories.length === 0 ||\n                             (product.category && selectedCategories.includes(product.category));\n      \n      return matchesSearch && matchesSize && matchesBrand && matchesCategory;\n    });\n  }, [products, searchTerm, selectedSizes, selectedBrands, selectedCategories]);\n  \n  // Clear all filters\n  const clearFilters = () => {\n    setSelectedSizes([]);\n    setSelectedBrands([]);\n    setSelectedCategories([]);\n    setSearchTerm('');\n  };\n  \n  // Remove a specific size filter\n  const removeSizeFilter = (size: string) => {\n    setSelectedSizes(prev => prev.filter(s => s !== size));\n  };\n  \n  // Remove a specific brand filter\n  const removeBrandFilter = (brand: string) => {\n    setSelectedBrands(prev => prev.filter(b => b !== brand));\n  };\n  \n  // Remove a specific category filter\n  const removeCategoryFilter = (category: string) => {\n    setSelectedCategories(prev => prev.filter(c => c !== category));\n  };\n  \n  // Check if any filters are active\n  const hasActiveFilters = selectedSizes.length > 0 || selectedBrands.length > 0 || selectedCategories.length > 0 || searchTerm.length > 0;\n\n  // Get category position in predefined order\n  const getCategoryOrder = (category: string): number => {\n    const index = CATEGORY_ORDER.indexOf(category);\n    return index !== -1 ? index : CATEGORY_ORDER.length;\n  };\n\n  // Sort and filter products\n  const sortedAndFilteredProducts = useMemo(() => {\n    if (!filteredProducts) return [];\n    \n    return [...filteredProducts].sort((a, b) => {\n      if (sortBy === 'price-asc') {\n        const priceA = typeof a.price_rub === 'string' ? parseFloat(a.price_rub) : a.price_rub;\n        const priceB = typeof b.price_rub === 'string' ? parseFloat(b.price_rub) : b.price_rub;\n        return priceA - priceB;\n      } \n      else if (sortBy === 'price-desc') {\n        const priceA = typeof a.price_rub === 'string' ? parseFloat(a.price_rub) : a.price_rub;\n        const priceB = typeof b.price_rub === 'string' ? parseFloat(b.price_rub) : b.price_rub;\n        return priceB - priceA;\n      }\n      else if (sortBy === 'category-desc') {\n        const categoryOrderA = getCategoryOrder(a.category || '');\n        const categoryOrderB = getCategoryOrder(b.category || '');\n        return categoryOrderB - categoryOrderA;\n      }\n      else { // default: category-asc\n        const categoryOrderA = getCategoryOrder(a.category || '');\n        const categoryOrderB = getCategoryOrder(b.category || '');\n        return categoryOrderA - categoryOrderB;\n      }\n    });\n  }, [filteredProducts, sortBy]);\n\n  const toggleSortOptions = () => {\n    setShowSortOptions(!showSortOptions);\n  };\n\n  const handleSortChange = (newSort: SortType) => {\n    setSortBy(newSort);\n    setShowSortOptions(false);\n  };\n\n  const getSortLabel = (sortType: SortType): string => {\n    switch (sortType) {\n      case 'price-asc': return 'По цене (от мин. к макс.)';\n      case 'price-desc': return 'По цене (от макс. к мин.)';\n      case 'category-asc': return 'По категории (обувь→низ→верх→аксессуары)';\n      case 'category-desc': return 'По категории (аксессуары→верх→низ→обувь)';\n      default: return 'По категории';\n    }\n  };\n\n  return (\n    <PageLayout className=\"pb-20\">\n      <div className=\"p-4\">\n        <header className=\"mb-6\">\n          <div className=\"flex justify-between items-center mb-4\">\n            <h1 className=\"text-2xl font-semibold\">Магазин</h1>\n            <Link \n              to=\"/cart\" \n              className=\"relative flex items-center justify-center w-10 h-10 bg-telegram-button text-white rounded-full hover:bg-telegram-button/90 transition-colors\"\n              aria-label=\"View Cart\"\n            >\n              <ShoppingCart size={20} className=\"text-white\" />\n              {itemCount > 0 && (\n                <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full\">\n                  {itemCount}\n                </span>\n              )}\n            </Link>\n          </div>\n          \n          {/* Stock information bar */}\n          <div className=\"mb-3 text-xs text-telegram-hint\">\n            <p className=\"text-justify\">\n              В этом разделе пока есть только то, что прямо сейчас в наличии в Москве. \n              Для заказа напрямую из Poizon используйте <Link to=\"/calculator\" className=\"text-telegram-button hover:underline\">рассчет доставки</Link>\n            </p>\n          </div>\n          \n          {/* Search bar */}\n          <div className=\"relative mb-4\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <Search size={20} className=\"text-telegram-hint\" />\n            </div>\n            <input\n              type=\"text\"\n              placeholder=\"Искать товары...\"\n              className=\"w-full p-3 pl-10 pr-4 border border-telegram-hint/30 rounded-lg bg-telegram-bg text-telegram-text focus:outline-none focus:ring-2 focus:ring-telegram-button focus:border-transparent\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n            />\n          </div>\n          \n          {/* Sort and Filter buttons */}\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex gap-4\">\n              <button\n                className=\"flex items-center gap-2 text-sm text-telegram-text\"\n                onClick={() => setShowFilters(!showFilters)}\n              >\n                <Filter size={18} className=\"text-telegram-hint\" />\n                <span>{showFilters ? 'Скрыть фильтры' : 'Показать фильтры'}</span>\n              </button>\n              \n              <button\n                className=\"flex items-center gap-2 text-sm text-telegram-text\"\n                onClick={toggleSortOptions}\n              >\n                <ArrowUpDown size={18} className=\"text-telegram-hint\" />\n                <span>Сортировка</span>\n              </button>\n            </div>\n            \n            {hasActiveFilters && (\n              <button\n                className=\"flex items-center gap-1 text-xs text-red-500\"\n                onClick={clearFilters}\n              >\n                <X size={14} />\n                <span>Очистить фильтры</span>\n              </button>\n            )}\n          </div>\n          \n          {/* Sort options */}\n          {showSortOptions && (\n            <div className=\"mb-4 p-4 bg-telegram-secondary-bg rounded-lg animate-slide-down space-y-2\">\n              <h3 className=\"text-sm font-medium mb-2 text-telegram-text\">Сортировать по:</h3>\n              <div className=\"flex flex-col gap-2\">\n                {(['category-asc', 'category-desc', 'price-asc', 'price-desc'] as SortType[]).map((option) => (\n                  <button\n                    key={option}\n                    className={`px-3 py-2 text-sm rounded-lg text-left transition-colors ${\n                      sortBy === option\n                        ? 'bg-telegram-button text-telegram-button-text'\n                        : 'bg-telegram-bg text-telegram-text hover:bg-telegram-bg/80'\n                    }`}\n                    onClick={() => handleSortChange(option)}\n                  >\n                    {getSortLabel(option)}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n          \n          {/* Active filters display */}\n          {hasActiveFilters && (\n            <div className=\"flex flex-wrap gap-2 mb-4\">\n              {selectedSizes.map(size => (\n                <span key={`filter-size-${size}`} className=\"inline-flex items-center gap-1 px-2 py-1 bg-telegram-light text-telegram-blue text-xs rounded-full\">\n                  <Tag size={12} />\n                  Размер: {size}\n                  <button \n                    className=\"ml-1\" \n                    onClick={() => removeSizeFilter(size)}\n                  >\n                    <X size={12} />\n                  </button>\n                </span>\n              ))}\n              \n              {selectedBrands.map(brand => (\n                <span key={`filter-brand-${brand}`} className=\"inline-flex items-center gap-1 px-2 py-1 bg-telegram-light text-telegram-blue text-xs rounded-full\">\n                  <Tag size={12} />\n                  Бренд: {brand}\n                  <button \n                    className=\"ml-1\" \n                    onClick={() => removeBrandFilter(brand)}\n                  >\n                    <X size={12} />\n                  </button>\n                </span>\n              ))}\n              \n              {selectedCategories.map(category => (\n                <span key={`filter-category-${category}`} className=\"inline-flex items-center gap-1 px-2 py-1 bg-telegram-light text-telegram-blue text-xs rounded-full\">\n                  <Tag size={12} />\n                  Категория: {category}\n                  <button \n                    className=\"ml-1\" \n                    onClick={() => removeCategoryFilter(category)}\n                  >\n                    <X size={12} />\n                  </button>\n                </span>\n              ))}\n              \n              {searchTerm && (\n                <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-telegram-light text-telegram-blue text-xs rounded-full\">\n                  <Search size={12} />\n                  \"{searchTerm}\"\n                  <button \n                    className=\"ml-1\" \n                    onClick={() => setSearchTerm('')}\n                  >\n                    <X size={12} />\n                  </button>\n                </span>\n              )}\n            </div>\n          )}\n          \n          {showFilters && (\n            <div className=\"mb-4 p-4 bg-telegram-secondary-bg rounded-lg animate-slide-down space-y-4\">\n              {/* Category filter */}\n              {availableCategories.length > 0 && (\n                <div>\n                  <h3 className=\"text-sm font-medium mb-2 text-telegram-text\">Фильтр по категории</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {availableCategories.map(category => (\n                      <button\n                        key={category}\n                        className={`px-3 py-1 text-sm rounded-full border transition-colors ${\n                          selectedCategories.includes(category) \n                            ? 'bg-telegram-button text-telegram-button-text border-telegram-button' \n                            : 'bg-telegram-bg text-telegram-text border-telegram-hint/30 hover:border-telegram-hint/50'\n                        }`}\n                        onClick={() => toggleCategorySelection(category)}\n                      >\n                        {category}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Size filter */}\n              <div>\n                <h3 className=\"text-sm font-medium mb-2 text-telegram-text\">Фильтр по размеру</h3>\n                <div className=\"flex flex-wrap gap-2\">\n                  {availableSizes.map(size => (\n                    <button\n                      key={size}\n                      className={`px-3 py-1 text-sm rounded-full border transition-colors ${\n                        selectedSizes.includes(size) \n                          ? 'bg-telegram-button text-telegram-button-text border-telegram-button' \n                          : 'bg-telegram-bg text-telegram-text border-telegram-hint/30 hover:border-telegram-hint/50'\n                      }`}\n                      onClick={() => toggleSizeSelection(size)}\n                    >\n                      {size}\n                    </button>\n                  ))}\n                </div>\n              </div>\n              \n              {/* Brand filter */}\n              {availableBrands.length > 0 && (\n                <div>\n                  <h3 className=\"text-sm font-medium mb-2 text-telegram-text\">Фильтр по бренду</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {availableBrands.map(brand => (\n                      <button\n                        key={brand}\n                        className={`px-3 py-1 text-sm rounded-full border transition-colors ${\n                          selectedBrands.includes(brand) \n                            ? 'bg-telegram-button text-telegram-button-text border-telegram-button' \n                            : 'bg-telegram-bg text-telegram-text border-telegram-hint/30 hover:border-telegram-hint/50'\n                        }`}\n                        onClick={() => toggleBrandSelection(brand)}\n                      >\n                        {brand}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </header>\n\n        {/* Error display */}\n        {isError && (\n          <div className=\"p-3 bg-red-50 border border-red-300 rounded-lg mb-4\">\n            <h3 className=\"text-sm font-medium text-red-700\">Error Loading Products:</h3>\n            <p className=\"text-xs text-red-600\">\n              {error instanceof Error ? error.message : 'Unknown error'}\n            </p>\n          </div>\n        )}\n\n        {/* Products grid */}\n        {isLoading ? (\n          <div className=\"flex justify-center items-center h-64\">\n            <LoadingSpinner size=\"lg\" />\n          </div>\n        ) : isError ? (\n          <div className=\"text-center py-10\">\n            <h2 className=\"text-lg font-medium text-red-600 mb-2\">Ошибка загрузки товаров</h2>\n            <p className=\"text-gray-600 mb-4\">Пожалуйста, попробуйте позже</p>\n            <button \n              className=\"px-4 py-2 bg-telegram-blue text-white rounded-lg\"\n              onClick={() => refetch()}\n            >\n              Попробовать снова\n            </button>\n          </div>\n        ) : filteredProducts.length === 0 ? (\n          <div className=\"text-center py-10\">\n            <h2 className=\"text-lg font-medium text-gray-700\">Товары не найдены</h2>\n            <p className=\"text-gray-500 mt-2\">Попробуйте изменить ваши фильтры или поисковый запрос</p>\n            {hasActiveFilters && (\n              <button \n                className=\"mt-4 px-4 py-2 bg-telegram-blue text-white rounded-lg\"\n                onClick={clearFilters}\n              >\n                Очистить все фильтры\n              </button>\n            )}\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-2 gap-4\">\n            {sortedAndFilteredProducts.map((product) => (\n              <ProductCard \n                key={product.sku} \n                product={product}\n                className=\"animate-fade-in\"\n              />\n            ))}\n          </div>\n        )}\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default Shop;\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport { useQuery } from '@tanstack/react-query';\nimport { ShoppingBag, Plus, Minus, ShoppingCart } from 'lucide-react';\nimport PageLayout from '@/components/PageLayout';\nimport LoadingSpinner from '@/components/LoadingSpinner';\nimport SizeSelector from '@/components/SizeSelector';\nimport { fetchProducts, addProductToCart, StockItem } from '@/services/api';\nimport { useCart } from '@/contexts/CartContext';\nimport { getConsistentEmoji } from '@/utils/emojiUtils';\nimport { hapticSelection, hapticImpact } from '@/utils/telegramUtils';\nimport { sortSizes } from '@/utils/sizeUtils';\nimport { toast } from 'sonner';\nimport PhotoSwiper from '@/components/PhotoSwiper';\nimport { useScrollToTop } from '@/hooks/useScrollToTop';\n\nconst ProductDetails: React.FC = () => {\n  const { productId } = useParams<{ productId: string }>();\n  const navigate = useNavigate();\n  const { addToCart: addItemToCart, updateQuantity, getItemQuantity } = useCart();\n  const [selectedSize, setSelectedSize] = useState<string>('');\n  \n  // Fetch all products with retry and longer staleTime\n  const { data: products, isLoading, error, isError, refetch } = useQuery({\n    queryKey: ['products'],\n    queryFn: fetchProducts,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n    retry: 1,\n    retryDelay: 1000,\n  });\n  \n  // Find the current product\n  const product = products?.find(p => p.sku === productId);\n  \n  // Get available sizes (only those with count > 0)\n  const availableSizes = useMemo(() => {\n    if (!product) return [];\n    \n    // Handle array of SizeAvailability\n    if (Array.isArray(product.sizes)) {\n      const sizes = product.sizes\n        .filter(size => size.quantity > 0)\n        .map(size => size.size);\n      \n      // Return sorted sizes\n      return sortSizes(sizes);\n    }\n    \n    // Fallback for backward compatibility\n    return [];\n  }, [product]);\n\n  // Set default selected size when product loads\n  useEffect(() => {\n    if (availableSizes.length > 0 && !selectedSize) {\n      setSelectedSize(availableSizes[0]);\n    }\n  }, [availableSizes, selectedSize]);\n  \n  // Get emoji for product\n  const productEmoji = product \n    ? getConsistentEmoji(`${product.item_name}-${product.color_code}`, 'product')\n    : '📦';\n  \n  // Get current quantity in cart\n  const currentQuantity = useMemo(() => {\n    if (!product || !selectedSize) return 0;\n    return getItemQuantity(product.sku, selectedSize);\n  }, [product, selectedSize, getItemQuantity]);\n  \n  // Get processed photo URLs\n  const photoUrls = useMemo(() => {\n    if (!product || !product.photos) return [];\n    \n    return Array.isArray(product.photos) \n      ? product.photos.map(photo => {\n          if (typeof photo === 'string') return photo;\n          return photo.photo_url || '';\n        }).filter(url => url)\n      : [];\n  }, [product]);\n  \n  // Get maximum available quantity for the selected size\n  const getMaxAvailableQuantity = useMemo(() => {\n    if (!product || !selectedSize) return 0;\n    \n    const sizeInfo = product.sizes.find(s => s.size === selectedSize);\n    return sizeInfo ? sizeInfo.quantity : 0;\n  }, [product, selectedSize]);\n  \n  const handleAddToCart = () => {\n    if (!product || !selectedSize) return;\n    \n    // Check if adding one more would exceed available stock\n    if (currentQuantity >= getMaxAvailableQuantity) {\n      toast.error(`Извините, доступно только ${getMaxAvailableQuantity} шт. размера ${selectedSize}`);\n      return;\n    }\n    \n    // Provide haptic feedback\n    hapticSelection();\n    \n    // Calculate price - convert from string if needed\n    const price = typeof product.price_rub === 'string' \n      ? parseFloat(product.price_rub.replace(/[^\\d.-]/g, ''))\n      : product.price_rub;\n    \n    // Call the cart context method to add the product\n    // Create a temporary product object that matches what the cart context expects\n    const tempProduct = {\n      id: product.sku,\n      name: product.item_name,\n      color: product.color_code,\n      sizes: availableSizes,\n      // Use the actual price from the API\n      price: price,\n      quantity: 1,\n      photo_url: photoUrls.length > 0 ? photoUrls[0] : undefined\n    };\n    \n    addItemToCart(tempProduct, selectedSize);\n    \n    // Also call the API method (which is just a placeholder for now)\n    addProductToCart(product.sku, selectedSize);\n  };\n  \n  const handleIncreaseQuantity = () => {\n    if (!product || !selectedSize) return;\n    \n    // Check if adding one more would exceed available stock\n    if (currentQuantity >= getMaxAvailableQuantity) {\n      toast.error(`Извините, доступно только ${getMaxAvailableQuantity} шт. размера ${selectedSize}`);\n      return;\n    }\n    \n    hapticSelection();\n    updateQuantity(product.sku, selectedSize, currentQuantity + 1);\n  };\n  \n  const handleDecreaseQuantity = () => {\n    if (!product || !selectedSize || currentQuantity <= 0) return;\n    hapticSelection();\n    updateQuantity(product.sku, selectedSize, currentQuantity - 1);\n  };\n  \n  const handleViewCart = () => {\n    hapticSelection();\n    navigate('/cart');\n  };\n  \n  useScrollToTop();\n  \n  if (isLoading) {\n    return (\n      <PageLayout>\n        <div className=\"flex justify-center items-center h-screen\">\n          <LoadingSpinner size=\"lg\" />\n        </div>\n      </PageLayout>\n    );\n  }\n  \n  if (isError || !product) {\n    return (\n      <PageLayout>\n        <div className=\"p-4 text-center\">\n          <h2 className=\"text-lg font-medium text-red-600 mb-2\">\n            {isError ? \"Ошибка загрузки товара\" : \"Товар не найден\"}\n          </h2>\n          <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n            {isError ? \"Пожалуйста, попробуйте позже\" : \"Этот товар может быть больше не доступен\"}\n          </p>\n          <div className=\"flex justify-center gap-4\">\n            {isError && (\n              <button \n                className=\"px-4 py-2 bg-telegram-blue text-white rounded-lg\"\n                onClick={() => refetch()}\n              >\n                Повторить\n              </button>\n            )}\n            <button \n              className=\"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg\"\n              onClick={() => navigate('/shop')}\n            >\n              В магазин\n            </button>\n          </div>\n        </div>\n      </PageLayout>\n    );\n  }\n  \n  return (\n    <PageLayout>\n      <div className=\"flex flex-col min-h-screen\">\n        {/* Product image slider using PhotoSwiper component */}\n        <PhotoSwiper\n          photos={photoUrls}\n          productName={product.item_name}\n          fallbackEmoji={productEmoji}\n        />\n        \n        <div className=\"p-4 flex-1\">\n          <div className=\"flex justify-between items-start mb-4\">\n            <div>\n              <h1 className=\"text-2xl font-bold mb-2\">{product.brand} {product.item_name}</h1>\n              <div className=\"flex items-center gap-2\">\n                {product.brand && (\n                  <Link \n                    to={`/shop?brand=${encodeURIComponent(product.brand)}`}\n                    className=\"px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-xs rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors\"\n                  >\n                    {product.brand}\n                  </Link>\n                )}\n                <span className=\"px-2 py-1 bg-telegram-light dark:bg-telegram-dark/20 text-telegram-blue dark:text-telegram-blue text-xs rounded-full\">\n                  {product.color_code}\n                </span>\n              </div>\n            </div>\n            <p className=\"text-2xl font-bold text-telegram-blue\">\n              ₽{typeof product.price_rub === 'string' \n                ? parseFloat(product.price_rub.replace(/[^\\d.-]/g, '')).toLocaleString() \n                : product.price_rub.toLocaleString()}\n            </p>\n          </div>\n          \n          <div className=\"mb-6\">\n            <h2 className=\"font-medium mb-2\">Выберите размер</h2>\n            <SizeSelector\n              availableSizes={availableSizes}\n              selectedSize={selectedSize}\n              onChange={setSelectedSize}\n            />\n          </div>\n          \n          <div className=\"mb-6\">\n            {product.description && (\n              <>\n                <h2 className=\"font-medium mb-2\">Описание</h2>\n                <p className=\"text-gray-700 dark:text-gray-300 text-sm\">\n                  {product.description}\n                </p>\n              </>\n            )}\n          </div>\n          \n          {/* Add padding at the bottom to account for the sticky panel */}\n          <div className=\"h-2\" />\n          \n          <div className=\"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-sidebar-primary border-t border-gray-200 dark:border-gray-800 pb-16\">\n            <div className=\"max-w-md mx-auto px-4 py-4\">\n              {selectedSize && (\n                <div>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <span className=\"font-medium\">Размер: {selectedSize}</span>\n                    {getItemQuantity(product.sku, selectedSize) > 0 && (\n                      <span className=\"text-sm text-gray-500\">\n                        В корзине: {getItemQuantity(product.sku, selectedSize)} шт.\n                      </span>\n                    )}\n                  </div>\n                  \n                  {getItemQuantity(product.sku, selectedSize) === 0 ? (\n                    <button\n                      onClick={handleAddToCart}\n                      disabled={!selectedSize || availableSizes.length === 0}\n                      className=\"w-full py-3 px-4 bg-telegram-blue text-white rounded-lg flex items-center justify-center gap-2 hover:bg-telegram-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                      <ShoppingBag size={20} />\n                      <span>Добавить в корзину</span>\n                    </button>\n                  ) : (\n                    <div className=\"flex items-center gap-2\">\n                      <button\n                        onClick={handleViewCart}\n                        className=\"flex-1 py-3 px-4 bg-telegram-blue text-white rounded-lg flex items-center justify-center gap-2 hover:bg-telegram-dark transition-colors\"\n                      >\n                        <ShoppingCart size={20} />\n                        <span>Перейти в корзину</span>\n                      </button>\n                      <div className=\"flex items-center justify-between border border-gray-200 dark:border-gray-700 rounded-lg p-1\">\n                        <button \n                          onClick={handleDecreaseQuantity}\n                          className=\"w-10 h-10 flex items-center justify-center text-telegram-text bg-gray-100 dark:bg-gray-800 rounded-md\"\n                        >\n                          <Minus size={18} />\n                        </button>\n                        <span className=\"font-medium px-4\">{getItemQuantity(product.sku, selectedSize)}</span>\n                        <button \n                          onClick={handleIncreaseQuantity}\n                          className=\"w-10 h-10 flex items-center justify-center text-telegram-text bg-gray-100 dark:bg-gray-800 rounded-md\"\n                        >\n                          <Plus size={18} />\n                        </button>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default ProductDetails;\n","import React, { createContext, useContext, ReactNode } from 'react';\n\n// User type for consistency\ninterface TelegramUser {\n  id: number;\n  first_name: string;\n  last_name?: string;\n  username?: string;\n  language_code?: string;\n  is_premium?: boolean;\n  photo_url?: string;\n  allows_write_to_pm?: boolean;\n}\n\n// Define WebApp interface for local use\ninterface TelegramWebApp {\n  initData: string;\n  initDataUnsafe: {\n    user?: TelegramUser;\n    auth_date?: string;\n    hash?: string;\n    query_id?: string;\n    start_param?: string;\n  };\n  ready: () => void;\n  close: () => void;\n  expand: () => void;\n  MainButton: {\n    isVisible: boolean;\n    onClick: (callback: () => void) => void;\n    offClick: (callback?: () => void) => void;\n    show: () => void;\n    hide: () => void;\n    setParams: (params: Record<string, unknown>) => void;\n  };\n  BackButton: {\n    isVisible: boolean;\n    onClick: (callback: () => void) => void;\n    offClick: (callback?: () => void) => void;\n    show: () => void;\n    hide: () => void;\n  };\n  themeParams: {\n    backgroundColor?: string;\n    textColor?: string;\n    hintColor?: string;\n    linkColor?: string;\n    buttonColor?: string;\n    buttonTextColor?: string;\n    secondaryBackgroundColor?: string;\n    isDark?: boolean;\n  };\n}\n\n// Define the context interface with proper types\ninterface TelegramContextType {\n  tg: TelegramWebApp | undefined;\n  onClose: () => void;\n  onToggleButton: () => void;\n  initWebApp: () => void;\n  getUserData: () => TelegramUser | null;\n  user: TelegramUser | undefined;\n  queryId: string | undefined;\n}\n\n// Create the context\nconst TelegramContext = createContext<TelegramContextType | null>(null);\n\n// Provider component\nexport const TelegramProvider: React.FC<{children: ReactNode}> = ({ children }) => {\n  // Get the Telegram WebApp instance\n  const tg = typeof window !== 'undefined' ? window.Telegram?.WebApp as TelegramWebApp | undefined : undefined;\n\n  // Function to close the WebApp\n  const onClose = () => {\n    if (tg) {\n      tg.close();\n    }\n  };\n\n  // Function to toggle the main button\n  const onToggleButton = () => {\n    if (tg?.MainButton?.isVisible) {\n      tg.MainButton.hide();\n    } else if (tg?.MainButton) {\n      tg.MainButton.show();\n    }\n  };\n\n  // Initialize the WebApp\n  const initWebApp = () => {\n    console.log(\"Initializing Telegram WebApp with direct access...\");\n    if (tg) {\n      tg.ready();\n      console.log(\"Telegram WebApp initialized successfully\");\n    } else {\n      console.error(\"Telegram WebApp is not available\");\n    }\n  };\n\n  // Get user data from initDataUnsafe\n  const getUserData = (): TelegramUser | null => {\n    if (tg?.initDataUnsafe?.user) {\n      console.log(\"User data found in initDataUnsafe:\", tg.initDataUnsafe.user);\n      \n      // Store in localStorage for future use\n      try {\n        localStorage.setItem('telegramUser', JSON.stringify(tg.initDataUnsafe.user));\n      } catch (e) {\n        console.error(\"Error storing user data in localStorage:\", e);\n      }\n      \n      return tg.initDataUnsafe.user;\n    }\n    \n    console.log(\"No user data found in initDataUnsafe\");\n    \n    // Try to get from localStorage as fallback\n    try {\n      const storedUser = localStorage.getItem('telegramUser');\n      if (storedUser) {\n        const userData = JSON.parse(storedUser) as TelegramUser;\n        console.log(\"Using stored user data from localStorage:\", userData);\n        return userData;\n      }\n    } catch (e) {\n      console.error(\"Error retrieving user data from localStorage:\", e);\n    }\n    \n    return null;\n  };\n\n  // Create the context value\n  const contextValue: TelegramContextType = {\n    tg,\n    onClose,\n    onToggleButton,\n    initWebApp,\n    getUserData,\n    user: tg?.initDataUnsafe?.user,\n    queryId: tg?.initDataUnsafe?.query_id,\n  };\n\n  return (\n    <TelegramContext.Provider value={contextValue}>\n      {children}\n    </TelegramContext.Provider>\n  );\n};\n\n// Hook to use the Telegram context\nexport const useTelegram = () => {\n  const context = useContext(TelegramContext);\n  if (!context) {\n    throw new Error('useTelegram must be used within a TelegramProvider');\n  }\n  return context;\n}; ","import React, { useEffect, useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport PageLayout from '@/components/PageLayout';\nimport LoadingSpinner from '@/components/LoadingSpinner';\nimport OrderCard from '@/components/OrderCard';\nimport UserAvatar from '@/components/UserAvatar';\nimport ReferralCard from '@/components/ReferralCard';\nimport { useUser } from '@/contexts/UserContext';\nimport { fetchOrders, /* getUserRank, */ checkUserExists, getTelegramUser } from '@/services/api';\nimport { toast } from 'sonner';\nimport { useTelegram } from '@/contexts/TelegramContext';\nimport { Settings as SettingsIcon, Coins, Info } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { API_BASE_URL, createFetchOptions } from '@/services/api/config';\nimport DDCoinsInfoModal from '@/components/DDCoinsInfoModal';\nimport { useScrollToTop } from '@/hooks/useScrollToTop';\n\nconst Profile: React.FC = () => {\n  const { username, displayName, telegramUser, profile, avatarEmoji, updateTelegramUser } = useUser();\n  const [isRegistered, setIsRegistered] = useState<boolean>(true);\n  // const [userRank, setUserRank] = useState<number>(0);\n  // const [isLoadingRank, setIsLoadingRank] = useState<boolean>(false);\n  const [ddCoinsBalance, setDDCoinsBalance] = useState<number>(0);\n  const [isLoadingDDCoins, setIsLoadingDDCoins] = useState<boolean>(false);\n  const [isInfoModalOpen, setIsInfoModalOpen] = useState<boolean>(false);\n  const navigate = useNavigate();\n  \n  // Use the Telegram context\n  const { tg, initWebApp, getUserData } = useTelegram();\n\n  useScrollToTop();\n\n  // Initialize Telegram WebApp and get user data\n  useEffect(() => {\n    const initTelegram = async () => {\n      try {\n        console.log('Initializing Telegram WebApp on Profile page...');\n        \n        // Initialize Telegram WebApp using the hook\n        initWebApp();\n        \n        // Get Telegram user data using the hook\n        const user = getUserData();\n        \n        if (user) {\n          console.log('Telegram user found on Profile page:', user);\n          // Update the user context with Telegram user data\n          updateTelegramUser(user);\n          \n          // Check if user exists in the API and get DD coins balance\n          const userResponse = await checkUserExists(true);\n          if (userResponse && typeof userResponse !== 'boolean') {\n            setIsRegistered(true);\n            setDDCoinsBalance(userResponse.dd_coins_balance);\n            setIsLoadingDDCoins(false);\n          } else {\n            setIsRegistered(false);\n          }\n          \n          // Get user rank directly from the API\n          // await fetchUserRank(user.id);\n          \n          // Get DD coins balance\n          // await fetchDDCoinsBalance();\n        } else {\n          console.log('No Telegram user data found on Profile page');\n          \n          // Try one more time after a delay\n          setTimeout(async () => {\n            const retryUser = getUserData();\n            if (retryUser) {\n              console.log('Telegram user found after delay:', retryUser);\n              updateTelegramUser(retryUser);\n              \n              // Check if user exists in the API and get DD coins balance\n              const userResponse = await checkUserExists(true);\n              if (userResponse && typeof userResponse !== 'boolean') {\n                setIsRegistered(true);\n                setDDCoinsBalance(userResponse.dd_coins_balance);\n                setIsLoadingDDCoins(false);\n              } else {\n                setIsRegistered(false);\n              }\n              \n              // Get user rank directly from the API\n              // await fetchUserRank(retryUser.id);\n              \n              // Get DD coins balance\n              // await fetchDDCoinsBalance();\n            } else {\n              console.log('Still no Telegram user data after retry');\n            }\n          }, 500);\n        }\n      } catch (error) {\n        console.error('Error initializing Telegram on Profile page:', error);\n      }\n    };\n    \n    initTelegram();\n  }, [updateTelegramUser, initWebApp, getUserData, tg]);\n\n  // Fetch orders\n  const { data: orders, isLoading, error, isError, refetch } = useQuery({\n    queryKey: ['orders'],\n    queryFn: fetchOrders,\n    staleTime: 60 * 1000, // 1 minute\n    retry: 1,\n    retryDelay: 1000,\n    enabled: isRegistered, // Only run the query if user is registered\n  });\n\n  if (isLoading) {\n    return (\n      <PageLayout>\n        <div className=\"flex justify-center items-center h-64\">\n          <LoadingSpinner size=\"lg\" />\n        </div>\n      </PageLayout>\n    );\n  }\n\n  if (isError && error instanceof Error && !error.message.includes('not found')) {\n    return (\n      <PageLayout className=\"pb-20\">\n        <div className=\"p-4 text-center\">\n          <h2 className=\"text-lg font-medium text-red-600 dark:text-red-400 mb-2\">Error loading profile</h2>\n          <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n            {error instanceof Error ? error.message : 'Please try again later'}\n          </p>\n          <button \n            className=\"px-4 py-2 bg-telegram-blue text-white rounded-lg\"\n            onClick={() => refetch()}\n          >\n            Retry\n          </button>\n        </div>\n      </PageLayout>\n    );\n  }\n\n  const displayOrders = orders || [];\n\n  return (\n    <PageLayout className=\"pb-32\">\n      <div className=\"p-4 relative\">\n        <div className=\"flex items-center justify-between mb-8 animate-fade-in\">\n          <div className=\"flex items-center gap-4\">\n            <UserAvatar \n              user={telegramUser} \n              emoji={avatarEmoji} \n              size=\"lg\" \n              className=\"hover-lift\"\n            />\n            <div>\n              <h1 className=\"text-2xl font-semibold\">\n                {telegramUser?.username ? `@${telegramUser.username}` : displayName}\n              </h1>\n              {telegramUser && (\n                <p className=\"text-gray-600 dark:text-gray-400\">\n                  {telegramUser.first_name} {telegramUser.last_name || ''}\n                </p>\n              )}\n              {/* <div className=\"mt-2 flex items-center\">\n                <span className=\"text-sm bg-telegram-light dark:bg-telegram-dark/20 text-telegram-blue dark:text-telegram-blue px-2 py-1 rounded-full\">\n                  {isLoadingRank ? 'Loading...' : `Rank ${userRank}`}\n                </span>\n              </div> */}\n            </div>\n          </div>\n          <button \n            onClick={() => navigate('/settings')}\n            className=\"w-10 h-10 flex items-center justify-center rounded-full bg-telegram-light dark:bg-sidebar-accent hover:bg-telegram-secondary-bg dark:hover:bg-sidebar-primary transition-colors\"\n            aria-label=\"Settings\"\n          >\n            <SettingsIcon size={20} className=\"text-telegram-blue\" />\n          </button>\n        </div>\n\n        {/* DD Coins Balance */}\n        <div className=\"mb-8 bg-telegram-blue dark:bg-telegram-blue rounded-lg p-5 shadow-sm animate-slide-up text-white\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Coins size={28} className=\"text-yellow-400\" />\n              <div className=\"flex items-baseline gap-3\">\n                <h2 className=\"text-xl font-semibold text-white\">$DD Баланс:</h2>\n                {isLoadingDDCoins ? (\n                  <LoadingSpinner size=\"sm\" className=\"text-white ml-2\" />\n                ) : (\n                  <span className=\"text-3xl font-bold text-white\">{ddCoinsBalance || 0}</span>\n                )}\n              </div>\n            </div>\n            <button \n              onClick={() => setIsInfoModalOpen(true)}\n              className=\"text-white hover:bg-white/20 rounded-full p-2 transition-colors\"\n              aria-label=\"DD Coins Information\"\n            >\n              <Info size={22} />\n            </button>\n          </div>\n        </div>\n\n        <div className=\"mb-8\">\n          <h2 className=\"text-xl font-medium mb-4\">Пригласи друзей</h2>\n          <div className=\"bg-white dark:bg-sidebar-accent rounded-lg shadow-sm overflow-hidden\">\n          <ReferralCard className=\"animate-fade-in\" />\n            <div className=\"p-4 border-b border-gray-100 dark:border-gray-800/50\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                *Поделись своей реферальной ссылкой с друзьями и получай награду в $DD, когда они присоединятся и сделают покупки!\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-3 gap-4 mb-8 animate-slide-up\">\n          <div className=\"bg-white dark:bg-sidebar-accent rounded-lg p-4 text-center shadow-sm\">\n            <h2 className=\"text-xl font-semibold text-telegram-blue\">{displayOrders.length}</h2>\n            <p className=\"text-gray-600 dark:text-gray-400 text-sm\">Всего заказов</p>\n          </div>\n          <div className=\"bg-white dark:bg-sidebar-accent rounded-lg p-4 text-center shadow-sm\">\n            <h2 className=\"text-xl font-semibold text-telegram-blue\">\n              {displayOrders.filter(o => o.status === 'delivered').length}\n            </h2>\n            <p className=\"text-gray-600 dark:text-gray-400 text-sm\">Завершенных</p>\n          </div>\n          <div className=\"bg-white dark:bg-sidebar-accent rounded-lg p-4 text-center shadow-sm\">\n            <h2 className=\"text-xl font-semibold text-telegram-blue\">\n              {displayOrders.filter(o => o.status !== 'delivered').length}\n            </h2>\n            <p className=\"text-gray-600 dark:text-gray-400 text-sm\">Активных</p>\n          </div>\n        </div>\n\n        <div className=\"mb-8\">\n          <h2 className=\"text-xl font-medium mb-4\">История заказов</h2>\n          \n          {orders && orders.length > 0 ? (\n            <div className=\"space-y-4\">\n              {orders.map((order) => (\n                <OrderCard\n                  key={order.order_id}\n                  order={order}\n                />\n              ))}\n            </div>\n          ) : (\n            <div className=\"p-6 text-center bg-telegram-secondary-bg rounded-lg\">\n              <h3 className=\"font-medium text-lg mb-2\">Еще нет заказов</h3>\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                Вы еще не сделали ни одного заказа. Начните покупки, чтобы увидеть их здесь.\n              </p>\n              <button\n                onClick={() => navigate('/shop')}\n                className=\"px-4 py-2 bg-telegram-blue text-white rounded-lg\"\n              >\n                В магазин!\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Extra space at the bottom to ensure all content is visible */}\n        <div className=\"h-16\"></div>\n\n        {/* DD Coins Info Modal */}\n        <DDCoinsInfoModal \n          isOpen={isInfoModalOpen} \n          onClose={() => setIsInfoModalOpen(false)} \n        />\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default Profile;\n","import { API_BASE_URL, createFetchOptions } from './config';\nimport { getTelegramUser } from './userService';\nimport { toast } from 'sonner';\n\nexport interface Promocode {\n  id: number;\n  promocode_text: string;\n  discount_fixed: number | null;\n  discount_percent: string | null;\n  usages_global: number;\n  usages_per_user: number;\n  valid_to_dttm: string;\n}\n\nexport interface ValidatePromocodeResponse {\n  success: boolean;\n  message: string;\n  promocode: Promocode | null;\n}\n\nexport interface CreatePromocodeResponse {\n  success: boolean;\n  message: string;\n  promocode: Promocode;\n}\n\n/**\n * Validate a promocode for the current user\n * @param promocodeText The promocode to validate\n * @returns A promise that resolves to the validation response\n */\nexport const validatePromocode = async (promocodeText: string): Promise<ValidatePromocodeResponse> => {\n  try {\n    const user = getTelegramUser();\n    if (!user) {\n      throw new Error('No Telegram user data available');\n    }\n\n    const { options, clearTimeout } = createFetchOptions('POST', {\n      telegram_id: user.id,\n      promocode_text: promocodeText\n    });\n\n    const response = await fetch(`${API_BASE_URL}/promocodes/validate`, options);\n    clearTimeout();\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(errorText || 'Failed to validate promocode');\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error validating promocode:', error);\n    throw error;\n  }\n};\n\n/**\n * Calculate the final price after applying a promocode discount\n * @param originalPrice The original price before discount\n * @param promocode The promocode to apply\n * @returns The final price after discount\n */\nexport const calculateDiscountedPrice = (originalPrice: number, promocode: Promocode): number => {\n  let finalPrice = originalPrice;\n  \n  // Apply fixed discount first\n  if (promocode.discount_fixed > 0) {\n    finalPrice = Math.max(0, finalPrice - promocode.discount_fixed);\n  }\n  \n  // Then apply percentage discount if any\n  if (promocode.discount_percent && promocode.discount_percent !== 'null') {\n    const percentageDiscount = (finalPrice * parseFloat(promocode.discount_percent)) / 100;\n    finalPrice = Math.max(0, finalPrice - percentageDiscount);\n  }\n  \n  return Math.round(finalPrice); // Round to nearest integer\n};\n\n/**\n * Create a new promocode (admin only)\n * @param promocodeData The promocode data\n * @returns A promise that resolves to the created promocode\n */\nexport const createPromocode = async (promocodeData: {\n  promocode_text: string;\n  discount_fixed: number;\n  usages_global: number;\n  usages_per_user: number;\n  valid_to_dttm: string;\n  client_id?: number | null;\n}): Promise<CreatePromocodeResponse> => {\n  try {\n    const { options, clearTimeout } = createFetchOptions('POST', promocodeData);\n\n    const response = await fetch(`${API_BASE_URL}/promocodes/create`, options);\n    clearTimeout();\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(errorText || 'Failed to create promocode');\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error creating promocode:', error);\n    throw error;\n  }\n}; ","import React, { useState, useEffect } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { ShoppingCart, ArrowLeft, Loader2, Coins, Trash2, ShoppingBag } from 'lucide-react';\nimport { useCart } from '@/contexts/CartContext';\nimport PageLayout from '@/components/PageLayout';\nimport { Button } from '@/components/ui/button';\nimport ClientInfoForm from '@/components/ClientInfoForm';\nimport CartItem from '@/components/CartItem/CartItem';\nimport { toast } from 'sonner';\nimport { createUnifiedOrder } from '@/services/api/orderService';\nimport { checkClientInformation, getClientInfo } from '@/services/api/clientService';\nimport { getTelegramUser } from '@/services/api/userService';\nimport PromocodeInput from '@/components/PromocodeInput';\nimport { Promocode } from '@/services/api/promocodeService';\nimport { DeliveryRate } from '@/services/api/types';\nimport { getDDCoinsBalance } from '@/services/api/userService';\nimport LoadingSpinner from '@/components/LoadingSpinner';\nimport { useScrollToTop } from '@/hooks/useScrollToTop';\n\nconst Cart: React.FC = () => {\n  const { items, removeFromCart, clearCart } = useCart();\n  const [isCreatingOrder, setIsCreatingOrder] = useState(false);\n  const [isCheckingClientInfo, setIsCheckingClientInfo] = useState(false);\n  const [showClientInfoForm, setShowClientInfoForm] = useState(false);\n  const [currentPromocode, setCurrentPromocode] = useState<Promocode | undefined>();\n  const [finalPrice, setFinalPrice] = useState<number>(0);\n  const [ddCoinsBalance, setDDCoinsBalance] = useState<number>(0);\n  const [ddCoinsToUse, setDDCoinsToUse] = useState<number>(0);\n  const [isLoadingDDCoins, setIsLoadingDDCoins] = useState<boolean>(false);\n  const [selectedDeliveryRate, setSelectedDeliveryRate] = useState<DeliveryRate | null>(null);\n  const [clientInfo, setClientInfo] = useState<{ email: string; phone_number: string; address: string } | null>(null);\n  \n  useScrollToTop();\n  \n  // Fetch DD coins balance when component mounts\n  useEffect(() => {\n    const fetchDDCoins = async () => {\n      const user = getTelegramUser();\n      if (!user) return;\n      \n      setIsLoadingDDCoins(true);\n      try {\n        const balance = await getDDCoinsBalance();\n        setDDCoinsBalance(balance);\n      } catch (error) {\n        console.error('Error fetching DD coins balance:', error);\n      } finally {\n        setIsLoadingDDCoins(false);\n      }\n    };\n    \n    fetchDDCoins();\n  }, []);\n  \n  // Calculate total price whenever cart items or promocode changes\n  useEffect(() => {\n    const subtotal = items.reduce((sum, item) => sum + (item.sale_price || item.price) * item.quantity, 0);\n    if (currentPromocode) {\n      // Apply fixed discount first (only once for the whole order)\n      let discountedPrice = subtotal;\n      if (currentPromocode.discount_fixed) {\n        discountedPrice = Math.max(0, discountedPrice - currentPromocode.discount_fixed);\n      }\n      // Then apply percentage discount\n      if (currentPromocode.discount_percent && currentPromocode.discount_percent !== 'null') {\n        const percentageDiscount = (discountedPrice * parseFloat(currentPromocode.discount_percent)) / 100;\n        discountedPrice = Math.max(0, discountedPrice - percentageDiscount);\n      }\n      \n      // Add delivery price if a delivery rate is selected\n      if (selectedDeliveryRate) {\n        discountedPrice += selectedDeliveryRate.price_rub;\n      }\n      \n      setFinalPrice(Math.round(discountedPrice));\n    } else {\n      let calculatedPrice = subtotal;\n      \n      // Add delivery price if a delivery rate is selected\n      if (selectedDeliveryRate) {\n        calculatedPrice += selectedDeliveryRate.price_rub;\n      }\n      \n      setFinalPrice(calculatedPrice);\n    }\n    \n    // Reset DD coins to use if price has changed\n    setDDCoinsToUse(0);\n  }, [items, currentPromocode, selectedDeliveryRate]);\n\n  // Calculate the maximum amount of DD coins that can be used (50% of final price)\n  const maxDDCoinsToUse = Math.min(\n    ddCoinsBalance,\n    Math.floor(finalPrice * 0.5)\n  );\n  \n  // Calculate the final price after DD coins\n  const finalPriceAfterDDCoins = finalPrice - ddCoinsToUse;\n  \n  // Handle DD coins slider change\n  const handleDDCoinsChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = parseInt(e.target.value);\n    setDDCoinsToUse(value);\n  };\n\n  const handlePromocodeApplied = (promocode: Promocode, discountedPrice: number) => {\n    setCurrentPromocode(promocode);\n    setFinalPrice(Math.round(discountedPrice));\n  };\n\n  const handlePromocodeRemoved = () => {\n    setCurrentPromocode(undefined);\n    setFinalPrice(items.reduce((sum, item) => sum + (item.sale_price || item.price) * item.quantity, 0));\n  };\n\n  const handleCreateOrder = async () => {\n    try {\n      setIsCreatingOrder(true);\n      \n      if (items.length === 0) {\n        toast.error('Ваша корзина пуста!');\n        setIsCreatingOrder(false);\n        return;\n      }\n      \n      const telegramUser = getTelegramUser();\n      if (!telegramUser) {\n        toast.error('Пожалуйста, войдите, чтобы создать заказ');\n        setIsCreatingOrder(false);\n        return;\n      }\n\n      // Get client information and show form to review/update\n      try {\n        const info = await getClientInfo();\n        // Store client info for the form\n        setClientInfo(info ? {\n          email: info.email || '',\n          phone_number: info.phone_number || '',\n          address: info.address || ''\n        } : null);\n        \n        setShowClientInfoForm(true);\n        setIsCreatingOrder(false);\n      } catch (error) {\n        console.error('Error getting client information:', error);\n        toast.error('Ошибка загрузки данных. Пожалуйста, попробуйте позже.');\n        setIsCreatingOrder(false);\n      }\n    } catch (error: any) {\n      console.error('Error in order creation process:', error);\n      toast.error(`Error: ${error.message}`);\n      setIsCreatingOrder(false);\n    }\n  };\n  \n  // Handle client info form completion\n  const handleClientInfoComplete = (deliveryRate?: DeliveryRate) => {\n    setShowClientInfoForm(false);\n    if (deliveryRate) {\n      // alert(\"Setting delivery type to \" + deliveryRate.delivery_type);\n      setSelectedDeliveryRate(deliveryRate);\n    } else {\n      alert(\"No delivery rate provided\");\n    }\n    createOrderWithInfo(deliveryRate);\n  };\n\n  // Separate function to create order after client info is confirmed\n  const createOrderWithInfo = async (deliveryRate?: DeliveryRate) => {\n    try {\n      setIsCreatingOrder(true);\n      \n      const telegramUser = getTelegramUser();\n      if (!telegramUser) {\n        toast.error('Пожалуйста, войдите, чтобы создать заказ');\n        return;\n      }\n\n      // Fetch the latest client info after the form is submitted\n      const latestClientInfo = await getClientInfo();\n      \n      // Format items for the unified API\n      const formattedItems = items.map(item => {\n        if (item.item_type === 'preorder') {\n          // Map category_type to match API requirements\n          let categoryType = item.category_type;\n          if (categoryType === 'shoes') {\n            categoryType = 'sneakers';\n          }\n          \n          return {\n            item_type: 'preorder' as const,\n            dewu_url: item.dewu_url,\n            size: item.size,\n            category_type: categoryType, // Use mapped category type\n            shipping_type: item.shipping_type || (item.delivery_type === 'cargo' ? 'cargo' : 'aero'), // Use shipping_type or convert from delivery_type\n            price_cny: item.price_cny || Math.round(item.price / 12), // Use existing price_cny or estimate it\n            quantity: item.quantity\n          };\n        } else {\n          // For stock items, use stock_id which is the productId\n          return {\n            item_type: 'stock' as const,\n            stock_id: parseInt(item.productId) || undefined, // Try to parse as integer if possible\n            sku: !parseInt(item.productId) ? item.productId : undefined, // Use sku as fallback\n            size: item.size,\n            quantity: item.quantity\n          };\n        }\n      });\n      \n      // Create an order using the unified API endpoint\n      const orderData = {\n        telegram_user_id: telegramUser.id,\n        delivery_method: deliveryRate?.delivery_type || 'self_pickup', // Updated to use what the API expects\n        delivery_address: latestClientInfo?.address || '',\n        promocode_text: currentPromocode?.promocode_text,\n        dd_coins_amount: ddCoinsToUse,\n        items: formattedItems,\n        final_price: finalPriceAfterDDCoins\n      };\n\n      console.log('Creating unified order with data:', JSON.stringify(orderData));\n      \n      const response = await createUnifiedOrder(orderData);\n      \n      if (response.success) {\n        clearCart();\n        toast.success('Заказ создан успешно');\n      } else {\n        toast.error(response.message || 'Не удалось создать заказ. Пожалуйста, попробуйте позже.');\n      }\n    } catch (error: any) {\n      console.error('Error creating order:', error);\n      toast.error('Ошибка при создании заказа. Пожалуйста, попробуйте позже.');\n      setIsCreatingOrder(false);\n    }\n  };\n\n  return (\n    <PageLayout className=\"pb-20\">\n      <div className=\"max-w-4xl mx-auto px-4 py-4\">\n        <h1 className=\"text-2xl font-bold mb-6\">Корзина</h1>\n        \n        {items.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <ShoppingCart className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <h3 className=\"mt-4 text-lg font-medium text-gray-900 dark:text-gray-100\">Ваша корзина пуста</h3>\n            <p className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\n              Добавьте товары в корзину, чтобы продолжить покупки\n            </p>\n            <Link\n              to=\"/shop\"\n              className=\"mt-6 inline-flex items-center text-sm font-medium text-telegram-blue hover:text-telegram-dark\"\n            >\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Продолжить покупки\n            </Link>\n          </div>\n        ) : (\n          <div>\n            <div className=\"space-y-4\">\n              {items.map((item) => (\n                <CartItem\n                  key={`${item.productId}-${item.size}`}\n                  item={item}\n                  onRemove={() => removeFromCart(item.productId, item.size)}\n                />\n              ))}\n            </div>\n            \n            {/* Promocode Input */}\n            <div className=\"bg-white dark:bg-sidebar-accent rounded-lg p-4 shadow-sm mb-4 mt-6\">\n              <h3 className=\"text-sm font-medium mb-2\">У вас есть промокод?</h3>\n              <PromocodeInput\n                originalPrice={items.reduce((sum, item) => sum + (item.sale_price || item.price) * item.quantity, 0)}\n                onPromocodeApplied={handlePromocodeApplied}\n                onPromocodeRemoved={handlePromocodeRemoved}\n                currentPromocode={currentPromocode}\n              />\n            </div>\n            \n            {/* Order Summary */}\n            <div className=\"bg-white dark:bg-sidebar-accent rounded-lg p-4 shadow-sm mb-2\">\n              <h3 className=\"text-lg font-medium mb-4\">Информация о заказе</h3>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Сумма товаров</span>\n                  <span>₽{items.reduce((sum, item) => sum + (item.sale_price || item.price) * item.quantity, 0)}</span>\n                </div>\n                \n                {selectedDeliveryRate && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600 dark:text-gray-400\">\n                      Доставка ({selectedDeliveryRate.delivery_type === 'self_pickup' \n                        ? 'Самовывоз' \n                        : selectedDeliveryRate.delivery_type === 'courier'\n                          ? 'Курьер'\n                          : 'Почта'})\n                    </span>\n                    <span>\n                      {selectedDeliveryRate.price_rub > 0 \n                        ? `₽${selectedDeliveryRate.price_rub.toLocaleString()}`\n                        : 'Бесплатно'}\n                    </span>\n                  </div>\n                )}\n                \n                {currentPromocode && (\n                  <div className=\"flex justify-between text-telegram-blue\">\n                    <span>Скидка по промокоду</span>\n                    <span>\n                      {currentPromocode.discount_fixed ? \n                        `-₽${currentPromocode.discount_fixed}` : \n                        (currentPromocode.discount_percent && currentPromocode.discount_percent !== 'null') ? \n                          `-${currentPromocode.discount_percent}%` : \n                          ''\n                      }\n                    </span>\n                  </div>\n                )}\n                \n                {/* DD Coins Section */}\n                {ddCoinsBalance > 0 && finalPrice > 0 && (\n                  <div className=\"pt-3 border-t border-gray-200 dark:border-gray-700\">\n                    <div className=\"flex justify-between items-center mb-2\">\n                      <div className=\"flex items-center gap-1\">\n                        <Coins size={16} className=\"text-yellow-500\" />\n                        <span className=\"font-medium\">DD Коины</span>\n                      </div>\n                      <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        Баланс: {ddCoinsBalance}\n                      </span>\n                    </div>\n                    \n                    <div className=\"space-y-1\">\n                      <div className=\"flex justify-between text-sm\">\n                        <span>Использовать DD Коины для оплаты</span>\n                        <span className=\"text-telegram-blue\">{ddCoinsToUse} коинов (-₽{ddCoinsToUse})</span>\n                      </div>\n                      \n                      <input\n                        type=\"range\"\n                        min=\"0\"\n                        max={maxDDCoinsToUse}\n                        value={ddCoinsToUse}\n                        onChange={handleDDCoinsChange}\n                        className=\"w-full\"\n                        disabled={maxDDCoinsToUse <= 0}\n                      />\n                      \n                      <div className=\"flex justify-between text-xs text-gray-500\">\n                        <span>0</span>\n                        <span>Макс: {maxDDCoinsToUse} коинов (50% от суммы)</span>\n                      </div>\n                    </div>\n                  </div>\n                )}\n                \n                <div className=\"flex justify-between font-medium pt-2 border-t border-gray-200 dark:border-gray-700\">\n                  <span>Итого</span>\n                  <span>₽{finalPriceAfterDDCoins}</span>\n                </div>\n              </div>\n              <button\n                onClick={handleCreateOrder}\n                disabled={isCreatingOrder || isCheckingClientInfo}\n                className=\"w-full mt-4 bg-telegram-blue text-white py-3 rounded-lg font-medium hover:bg-telegram-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isCreatingOrder || isCheckingClientInfo ? (\n                  <>\n                    <LoadingSpinner size=\"xs\" inline className=\"mr-2\" />\n                    {isCheckingClientInfo ? 'Проверка данных...' : 'Создание заказа...'}\n                  </>\n                ) : (\n                  'Оформить заказ'\n                )}\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n      \n      {/* Client Info Form */}\n      {showClientInfoForm && (\n        <ClientInfoForm\n          onComplete={handleClientInfoComplete}\n          onCancel={() => setShowClientInfoForm(false)}\n          clientInfo={clientInfo}\n          orderSubtotal={items.reduce((sum, item) => sum + (item.sale_price || item.price) * item.quantity, 0)}\n          promocodeDiscount={currentPromocode ? {\n            text: currentPromocode.promocode_text,\n            amount: currentPromocode.discount_fixed || parseFloat(currentPromocode.discount_percent || '0'),\n            type: currentPromocode.discount_fixed ? 'fixed' : 'percent'\n          } : undefined}\n          ddCoinsDiscount={ddCoinsToUse}\n          finalPriceAfterDDCoins={finalPriceAfterDDCoins}\n        />\n      )}\n    </PageLayout>\n  );\n};\n\nexport default Cart;\n","import React from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport PageLayout from \"@/components/PageLayout\";\n\nconst NotFound = () => {\n  const navigate = useNavigate();\n\n  return (\n    <PageLayout fullHeight>\n      <div className=\"min-h-screen flex flex-col items-center justify-center p-4 text-center\">\n        <div className=\"text-8xl mb-4 animate-float\">🔍</div>\n        <h1 className=\"text-4xl font-bold mb-4\">404</h1>\n        <p className=\"text-xl text-gray-600 mb-6\">\n          Oops! We couldn't find that page\n        </p>\n        \n        <button\n          onClick={() => navigate(\"/\")}\n          className=\"px-6 py-3 bg-telegram-blue text-white rounded-lg hover:bg-telegram-dark transition-colors\"\n        >\n          Return to Home\n        </button>\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default NotFound;\n","import React, { useState, useEffect } from 'react';\nimport { Calculator, ExternalLink, Truck, Plane, ShoppingBag } from 'lucide-react';\nimport PageLayout from '@/components/PageLayout';\nimport LoadingSpinner from '@/components/LoadingSpinner';\nimport { hapticSelection, openTelegramUrl } from '@/utils/telegramUtils';\nimport { calculateShipping } from '@/services/api/orderService';\nimport { fetchCategories } from '@/services/api/productService';\nimport { Category } from '@/services/api/types';\nimport { toast } from 'sonner';\nimport { useCart } from '@/contexts/CartContext';\nimport { useScrollToTop } from '@/hooks/useScrollToTop';\n\n// Constants for fallback calculation if API fails\nconst CNY_USD_RATE = 0.14;\nconst USD_RUB_RATE = 90;\nconst COMMISSION_COEFFICIENT = 1700;\n\n// Shipping type coefficients\nconst SHIPPING_TYPE_COEFFICIENTS = {\n  car: 7,\n  plane: 15\n};\n\n// Helper function to capitalize first letter of each word\nconst formatCategoryName = (name: string): string => {\n  return name\n    .split(' ')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(' ');\n};\n\nconst DeliveryCalculator: React.FC = () => {\n  useScrollToTop();\n  const { addPreorderToCart } = useCart();\n  \n  // State for form inputs\n  const [price, setPrice] = useState<string>('');\n  const [itemType, setItemType] = useState<string>('');\n  const [shippingType, setShippingType] = useState<string>('car');\n  const [itemUrl, setItemUrl] = useState<string>('');\n  const [size, setSize] = useState<string>('');\n  const [isCalculating, setIsCalculating] = useState<boolean>(false);\n  const [isAddingToCart, setIsAddingToCart] = useState<boolean>(false);\n  const [categories, setCategories] = useState<Category[]>([]);\n  const [isLoadingCategories, setIsLoadingCategories] = useState<boolean>(false);\n  \n  // State for validation\n  const [priceError, setPriceError] = useState<string>('');\n  const [urlError, setUrlError] = useState<string>('');\n  \n  // State for calculation result\n  const [totalPrice, setTotalPrice] = useState<number | null>(null);\n  \n  // Fetch categories on component mount\n  useEffect(() => {\n    const loadCategories = async () => {\n      setIsLoadingCategories(true);\n      try {\n        const fetchedCategories = await fetchCategories();\n        setCategories(fetchedCategories);\n        \n        // Check if \"обувь\" category exists in the fetched categories\n        const shoesCategory = fetchedCategories.find(\n          category => category.name.toLowerCase() === 'обувь'\n        );\n        \n        if (shoesCategory) {\n          // Set \"обувь\" as default if it exists\n          setItemType(shoesCategory.name);\n        } else if (fetchedCategories.length > 0) {\n          // Fall back to first category if \"обувь\" doesn't exist\n          setItemType(fetchedCategories[0].name);\n        }\n      } catch (error) {\n        console.error('Failed to load categories:', error);\n        toast.error('Failed to load item categories');\n      } finally {\n        setIsLoadingCategories(false);\n      }\n    };\n    \n    loadCategories();\n  }, []);\n  \n  // Calculate price using the API with explicit button click\n  const handleCalculate = async () => {\n    if (!price || priceError) {\n      toast.error('Введите корректную цену для расчёта');\n      return;\n    }\n    \n    if (!itemType) {\n      toast.error('Выберите категорию товара');\n      return;\n    }\n    \n    // Map internal item type to API category_type\n    const apiCategoryType = mapToCategoryType(itemType);\n    if (!apiCategoryType) {\n      toast.error('Неверный тип категории');\n      return;\n    }\n    \n    setIsCalculating(true);\n    \n    try {\n      const priceInCNY = parseInt(price);\n      \n      // Call the API to calculate the shipping cost\n      const shippingCost = await calculateShipping(priceInCNY, shippingType, apiCategoryType);\n      \n      // Set the total price from the API response\n      setTotalPrice(shippingCost);\n    } catch (error: any) {\n      console.error('Error calculating shipping:', error);\n      toast.error(`Ошибка расчёта доставки: ${error.message}`);\n      setTotalPrice(null);\n    } finally {\n      setIsCalculating(false);\n    }\n  };\n  \n  // Simplified version that just lowercases the category\n  const mapToCategoryType = (internalCategory: string): string => {\n    return internalCategory.toLowerCase();\n  };\n  \n  // Validate price input\n  const handlePriceChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    \n    // Allow only numbers\n    if (value && !/^\\d+$/.test(value)) {\n      setPriceError('Введите только цифры');\n    } else {\n      setPriceError('');\n    }\n    \n    setPrice(value);\n  };\n  \n  // Validate URL input and extract clean URL if needed\n  const handleUrlChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    \n    // Extract the URL if there's pasted text with additional content\n    const extractedUrl = extractDewuUrl(value);\n    const cleanUrl = extractedUrl || value;\n    \n    if (cleanUrl && !isValidUrl(cleanUrl)) {\n      setUrlError('Введите корректную ссылку');\n    } else {\n      setUrlError('');\n    }\n    \n    // If we extracted a URL, use that instead of the original input\n    setItemUrl(extractedUrl || value);\n  };\n  \n  // Extract DEWU URL from pasted text\n  const extractDewuUrl = (text: string): string | null => {\n    // Common DEWU URL patterns\n    const urlPatterns = [\n      /https?:\\/\\/dw4\\.co\\/[^\\s]+/i,\n      /https?:\\/\\/m\\.dewu\\.com\\/[^\\s]+/i,\n      /https?:\\/\\/www\\.dewu\\.com\\/[^\\s]+/i,\n      /https?:\\/\\/dewu\\.com\\/[^\\s]+/i\n    ];\n    \n    // Try each pattern until we find a match\n    for (const pattern of urlPatterns) {\n      const match = text.match(pattern);\n      if (match && match[0]) {\n        console.log('Extracted DEWU URL:', match[0]);\n        return match[0];\n      }\n    }\n    \n    return null;\n  };\n  \n  // Check if string is a valid URL\n  const isValidUrl = (url: string) => {\n    try {\n      new URL(url);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  };\n  \n  // Handle item type selection\n  const handleItemTypeChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    hapticSelection();\n    setItemType(e.target.value);\n    // Reset total price when input changes\n    setTotalPrice(null);\n  };\n  \n  // Handle shipping type selection\n  const handleShippingTypeChange = (type: string) => {\n    hapticSelection();\n    setShippingType(type);\n    // Reset total price when input changes\n    setTotalPrice(null);\n  };\n  \n  const handleAddToCart = async () => {\n    if (!itemUrl) {\n      toast.error('Введите ссылку на товар');\n      return;\n    }\n    \n    if (urlError) {\n      toast.error('Введите корректную ссылку на товар');\n      return;\n    }\n    \n    if (!totalPrice) {\n      toast.error('Сначала рассчитайте стоимость');\n      return;\n    }\n    \n    // Map internal item type to API category_type\n    const apiCategoryType = mapToCategoryType(itemType);\n    if (!apiCategoryType) {\n      toast.error('Неверный тип категории');\n      return;\n    }\n    \n    setIsAddingToCart(true);\n    \n    try {\n      // Parse the price from the input\n      const priceInCNY = price ? parseInt(price) : 0;\n      \n      // Convert shipping type to the API expected format\n      const apiShippingType = shippingType === 'car' ? 'cargo' : 'aero';\n      \n      // Add the preorder item to cart\n      addPreorderToCart({\n        dewu_url: itemUrl,\n        size: size || 'Не указан', \n        category_type: apiCategoryType,\n        shipping_type: apiShippingType,\n        price: totalPrice,\n        price_cny: priceInCNY, // Include the price in CNY\n        name: `Предзаказ - ${apiCategoryType === 'обувь' ? 'Обувь' : \n              apiCategoryType === 'одежда' ? 'Одежда' : \n              apiCategoryType === 'аксессуары' ? 'Аксессуары' : \n              itemType} - ${size || 'Размер не указан'}`\n      });\n      \n      toast.success('Предзаказ добавлен в корзину');\n      \n      // Clear form after adding to cart\n      setItemUrl('');\n      setSize('');\n      setTotalPrice(null);\n    } catch (error: any) {\n      console.error('Error adding preorder to cart:', error);\n      toast.error('Ошибка при добавлении предзаказа в корзину');\n    } finally {\n      setIsAddingToCart(false);\n    }\n  };\n  \n  return (\n    <PageLayout className=\"pb-20\">\n      <div className=\"p-4\">\n        <div className=\"flex items-center mb-6\">\n          <Calculator className=\"mr-2 text-telegram-blue\" size={24} />\n          <h1 className=\"text-2xl font-semibold\">Калькулятор доставки</h1>\n        </div>\n        \n        {/* Info block */}\n        <div className=\"mb-3 text-xs text-telegram-hint\">\n          <p className=\"text-justify\">\n            В этом разделе вы можете добавить в заказ товары из POIZON. Рассчитайте стоимость доставки и добавьте предзаказ в корзину.\n            <br /> \n            <a \n              onClick={() => openTelegramUrl(\"https://telegra.ph/Ustanovka-POIZON-i-registraciya2-04-10\")}\n              className=\"text-telegram-button hover:underline cursor-pointer\"\n            >\n              Как установить POIZON?\n            </a> | \n            <a \n              onClick={() => openTelegramUrl(\"https://telegra.ph/Poisk-i-kartochka-tovara-ceny-razmernaya-setka-i-sroki-dostavki-04-11\")}\n              className=\"text-telegram-button hover:underline cursor-pointer\"\n            >\n               Как искать товары?\n            </a>\n          </p>\n        </div>\n        \n        <div className=\"space-y-6\">\n          {/* Price Input */}\n          <div className=\"space-y-2\">\n            <label className=\"block text-sm font-medium\">\n              Цена товара (юани)\n            </label>\n            <input\n              type=\"text\"\n              value={price}\n              onChange={handlePriceChange}\n              placeholder=\"Введите цену в юанях\"\n              className={`w-full p-3 rounded-lg border ${priceError ? 'border-red-500' : 'border-gray-300 dark:border-gray-700'} bg-white dark:bg-sidebar-accent`}\n            />\n            {priceError && (\n              <p className=\"text-red-500 text-sm\">{priceError}</p>\n            )}\n            <div className=\"flex items-center text-xs text-telegram-hint\">\n              <a \n                onClick={() => openTelegramUrl(\"https://telegra.ph/Poisk-i-kartochka-tovara-ceny-razmernaya-setka-i-sroki-dostavki-04-11\")}\n                className=\"flex items-center text-telegram-link\"\n              >\n                Как проверить цену? <ExternalLink size={12} className=\"ml-1\" />\n              </a>\n            </div>\n          </div>\n          \n          {/* Item Type Selection */}\n          <div className=\"space-y-2\">\n            <label className=\"block text-sm font-medium\">\n              Категория товара\n            </label>\n            <select\n              value={itemType}\n              onChange={handleItemTypeChange}\n              className=\"w-full p-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-sidebar-accent\"\n              disabled={isLoadingCategories}\n            >\n              {isLoadingCategories ? (\n                <option value=\"\">Загрузка категорий...</option>\n              ) : categories.length === 0 ? (\n                <option value=\"\">Нет доступных категорий</option>\n              ) : (\n                categories.map(category => (\n                  <option key={category.id} value={category.name}>\n                    {formatCategoryName(category.name)}\n                  </option>\n                ))\n              )}\n            </select>\n          </div>\n          \n          {/* Shipping Type Selection */}\n          <div className=\"space-y-2\">\n            <label className=\"block text-sm font-medium\">\n              Тип доставки\n            </label>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <button\n                type=\"button\"\n                onClick={() => handleShippingTypeChange('car')}\n                className={`p-3 rounded-lg flex flex-col items-center justify-center ${\n                  shippingType === 'car' \n                    ? 'bg-telegram-blue text-white' \n                    : 'bg-white dark:bg-sidebar-accent border border-gray-300 dark:border-gray-700'\n                }`}\n              >\n                <Truck size={24} className=\"mb-2\" />\n                <span className=\"font-medium\">Автомобиль</span>\n                <span className=\"text-xs mt-1 opacity-80\">21-35 дней</span>\n              </button>\n              \n              <button\n                type=\"button\"\n                onClick={() => handleShippingTypeChange('plane')}\n                className={`p-3 rounded-lg flex flex-col items-center justify-center ${\n                  shippingType === 'plane' \n                    ? 'bg-telegram-blue text-white' \n                    : 'bg-white dark:bg-sidebar-accent border border-gray-300 dark:border-gray-700'\n                }`}\n              >\n                <Plane size={24} className=\"mb-2\" />\n                <span className=\"font-medium\">Самолет</span>\n                <span className=\"text-xs mt-1 opacity-80\">5-10 дней</span>\n              </button>\n            </div>\n            <div className=\"mt-2 text-xs text-telegram-hint\">\n              * Указано время доставки только от склада в Китае до России. Срок доставки до склада в Китае всегда указан в самом Poizon на кнопке с ценой товара.\n            </div>\n          </div>\n          \n          {/* Calculate Button */}\n          <button\n            type=\"button\"\n            onClick={handleCalculate}\n            disabled={isCalculating || !price || !!priceError || !itemType}\n            className=\"w-full bg-green-600 text-white p-4 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isCalculating ? (\n              <>\n                <LoadingSpinner size=\"xs\" inline className=\"mr-2\" />\n                Идет расчет...\n              </>\n            ) : (\n              'Рассчитать стоимость доставки'\n            )}\n          </button>\n          \n          {/* Calculation Result */}\n          {totalPrice !== null && (\n            <div className=\"mt-8 p-4 bg-telegram-secondary-bg rounded-lg\">\n              <h2 className=\"text-lg font-medium mb-2\">Предварительная стоимость</h2>\n              <div className=\"flex justify-between items-center\">\n                <span>Итоговая цена:</span>\n                <span className=\"text-2xl font-bold text-telegram-blue\">\n                  ₽{totalPrice.toLocaleString()}\n                </span>\n              </div>\n              <div className=\"mt-4 text-xs text-telegram-hint\">\n                <p>Включает стоимость товара, доставки и комиссии</p>\n              </div>\n            </div>\n          )}\n          \n          {/* Item URL Input (Required) */}\n          <div className=\"space-y-2\">\n            <label className=\"block text-sm font-medium\">\n              Ссылка на товар <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              value={itemUrl}\n              onChange={handleUrlChange}\n              placeholder=\"Вставьте ссылку Poizon (DEWU)\"\n              className={`w-full p-3 rounded-lg border ${urlError ? 'border-red-500' : 'border-gray-300 dark:border-gray-700'} bg-white dark:bg-sidebar-accent`}\n            />\n            {urlError && (\n              <p className=\"text-red-500 text-sm\">{urlError}</p>\n            )}\n            <div className=\"flex items-center text-xs text-telegram-hint\">\n              <a \n                onClick={() => openTelegramUrl(\"https://telegra.ph/Gde-vzyat-ssylku-na-tovar-v-POIZON-05-10\")}\n                className=\"flex items-center text-telegram-link\"\n              >\n                Как получить ссылку? <ExternalLink size={12} className=\"ml-1\" />\n              </a>\n            </div>\n          </div>\n          \n          {/* Size Input (Optional) */}\n          <div className=\"space-y-2\">\n            <label className=\"block text-sm font-medium\">\n              Размер (Необязательно)\n            </label>\n            <input\n              type=\"text\"\n              value={size}\n              onChange={(e) => setSize(e.target.value)}\n              placeholder=\"например, 42, XL и т.д.\"\n              className=\"w-full p-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-sidebar-accent\"\n            />\n          </div>\n          \n          {/* Add to Cart Button */}\n          {totalPrice !== null && (\n            <button\n              onClick={handleAddToCart}\n              disabled={isAddingToCart || !itemUrl || !!urlError}\n              className=\"w-full mt-4 bg-telegram-blue text-white py-3 rounded-lg font-medium hover:bg-telegram-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n            >\n              {isAddingToCart ? (\n                <>\n                  <LoadingSpinner size=\"xs\" inline className=\"mr-2\" />\n                  Добавление в корзину...\n                </>\n              ) : (\n                <>\n                  <ShoppingBag size={20} />\n                  Добавить в корзину\n                </>\n              )}\n            </button>\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default DeliveryCalculator; ","import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { ChevronLeft, Save, Sun, Check, Bell } from 'lucide-react';\nimport PageLayout from '@/components/PageLayout';\nimport { useUser } from '@/contexts/UserContext';\nimport { toast } from 'sonner';\nimport { getClientInfo, updateClientInfo } from '@/services/api/clientService';\nimport LoadingSpinner from '@/components/LoadingSpinner';\nimport { useScrollToTop } from '@/hooks/useScrollToTop';\n\nconst Settings: React.FC = () => {\n  const navigate = useNavigate();\n  const { telegramUser } = useUser();\n  const useScrollToTopHook = useScrollToTop();\n  \n  // Form state\n  const [email, setEmail] = useState<string>('');\n  const [phone, setPhone] = useState<string>('');\n  const [address, setAddress] = useState<string>('');\n  const [mailingFlg, setMailingFlg] = useState<boolean>(true);\n  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const [isSaving, setIsSaving] = useState<boolean>(false);\n  const [currentTheme, setCurrentTheme] = useState<'light' | 'dark'>('light');\n  const [isResetting, setIsResetting] = useState<boolean>(false);\n  \n  // Load user data from API\n  useEffect(() => {\n    const loadClientInfo = async () => {\n      setIsLoading(true);\n      try {\n        const clientInfo = await getClientInfo();\n        if (clientInfo) {\n          setEmail(clientInfo.email || '');\n          setPhone(clientInfo.phone_number || '');\n          setAddress(clientInfo.address || '');\n          // If mailing_flg exists in the response, use it, otherwise default to true\n          setMailingFlg(clientInfo.mailing_flg !== undefined ? clientInfo.mailing_flg : true);\n        }\n      } catch (error) {\n        console.error('Error loading client info:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    \n    loadClientInfo();\n  }, []);\n  \n  // Handle form submission\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    \n    try {\n      // Email validation\n      if (!email.trim()) {\n        toast.error('Пожалуйста, введите ваш email');\n        setIsSubmitting(false);\n        return;\n      }\n      \n      // Phone validation\n      if (!phone.trim()) {\n        toast.error('Пожалуйста, введите ваш номер телефона');\n        setIsSubmitting(false);\n        return;\n      }\n      \n      // Address validation\n      if (!address.trim()) {\n        toast.error('Пожалуйста, введите ваш адрес');\n        setIsSubmitting(false);\n        return;\n      }\n      \n      // Call the API to update client info\n      const success = await updateClientInfo(phone, email, address, mailingFlg);\n      \n      if (success) {\n        // Return to profile page\n        navigate('/profile');\n      }\n    } catch (error) {\n      console.error('Error saving settings:', error);\n      toast.error('Ошибка сохранения настроек. Пожалуйста, попробуйте позже.');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n  \n  const handleThemeChange = (theme: 'light' | 'dark') => {\n    setIsSaving(true);\n    setCurrentTheme(theme);\n    // Implement theme change logic here\n    setIsSaving(false);\n  };\n  \n  const handleResetSettings = () => {\n    setIsResetting(true);\n    // Implement reset settings logic here\n    setIsResetting(false);\n  };\n  \n  return (\n    <PageLayout>\n      <div className=\"p-4\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <button \n            onClick={() => navigate('/profile')}\n            className=\"w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800\"\n          >\n            <ChevronLeft size={18} />\n          </button>\n          <h1 className=\"text-xl font-semibold\">Настройки</h1>\n        </div>\n        \n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <LoadingSpinner size=\"md\" />\n          </div>\n        ) : (\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"space-y-1\">\n              <label htmlFor=\"email\" className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Адрес электронной почты *\n              </label>\n              <input\n                id=\"email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-telegram-blue focus:border-telegram-blue dark:bg-gray-800\"\n                placeholder=\"your@email.com\"\n                required\n              />\n            </div>\n            \n            <div className=\"space-y-1\">\n              <label htmlFor=\"phone\" className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Номер телефона *\n              </label>\n              <input\n                id=\"phone\"\n                type=\"tel\"\n                value={phone}\n                onChange={(e) => setPhone(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-telegram-blue focus:border-telegram-blue dark:bg-gray-800\"\n                placeholder=\"+7 (999) 123-4567\"\n                required\n              />\n            </div>\n            \n            <div className=\"space-y-1\">\n              <label htmlFor=\"address\" className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Адрес *\n              </label>\n              <textarea\n                id=\"address\"\n                value={address}\n                onChange={(e) => setAddress(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-telegram-blue focus:border-telegram-blue dark:bg-gray-800\"\n                placeholder=\"Ваш полный адрес\"\n                rows={3}\n                required\n              />\n            </div>\n            \n            <div className=\"space-y-1\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Bell size={18} className=\"text-gray-600 dark:text-gray-400\" />\n                  <label htmlFor=\"mailing\" className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                    Получать уведомления\n                  </label>\n                </div>\n                <button\n                  type=\"button\"\n                  id=\"mailing\"\n                  onClick={() => setMailingFlg(!mailingFlg)}\n                  className={`relative inline-flex items-center h-6 rounded-full w-11 transition-colors focus:outline-none focus:ring-2 focus:ring-telegram-blue focus:ring-offset-2 ${\n                    mailingFlg ? 'bg-telegram-blue' : 'bg-gray-300 dark:bg-gray-600'\n                  }`}\n                >\n                  <span\n                    className={`inline-block w-4 h-4 transform transition-transform bg-white rounded-full ${\n                      mailingFlg ? 'translate-x-6' : 'translate-x-1'\n                    }`}\n                  />\n                </button>\n              </div>\n            </div>\n            \n            <button\n              type=\"submit\"\n              disabled={isSubmitting}\n              className=\"w-full flex items-center justify-center gap-2 bg-telegram-blue text-white py-2 px-4 rounded-md hover:bg-telegram-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isSubmitting ? (\n                <>\n                  <LoadingSpinner size=\"xs\" inline className=\"mr-2\" />\n                  Сохраняем...\n                </>\n              ) : (\n                <>\n                  <Save size={16} />\n                  Сохранить\n                </>\n              )}\n            </button>\n          </form>\n        )}\n\n        {isSaving && (\n          <div className=\"flex justify-center py-6\">\n            <LoadingSpinner size=\"md\" />\n          </div>\n        )}\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default Settings; ","import { Toaster } from \"sonner\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { HashRouter, Routes, Route, useLocation, useNavigate } from \"react-router-dom\";\nimport { UserProvider, useUser } from \"./contexts/UserContext\";\nimport { CartProvider } from \"./contexts/CartContext\";\nimport { ThemeProvider } from \"next-themes\";\nimport { useEffect, useState, useCallback } from \"react\";\nimport { \n  initTelegramWebApp, \n  getTelegramUser, \n  showBackButton, \n  hideBackButton,\n  syncTelegramTheme,\n  listenForThemeChanges,\n  setThemeClass,\n  setDarkGrayTheme,\n  setTelegramColors,\n  requestTelegramTheme,\n  setupThemeChangeListener\n} from \"./utils/telegramUtils\";\nimport { checkUserExists /*, getUserRank*/ } from \"./services/api\";\nimport { toast } from \"sonner\";\nimport useReferral from \"./hooks/useReferral\";\nimport useRegistration from \"./hooks/useRegistration\";\nimport Home from \"./pages/Home\";\nimport Shop from \"./pages/Shop\";\nimport ProductDetails from \"./pages/ProductDetails\";\nimport Profile from \"./pages/Profile\";\nimport Cart from \"./pages/Cart\";\nimport NotFound from \"./pages/NotFound\";\nimport DeliveryCalculator from \"./pages/DeliveryCalculator\";\nimport Settings from \"./pages/Settings\";\nimport LoadingSpinner from \"./components/LoadingSpinner\";\nimport ScrollToTop from \"./components/ScrollToTop\";\n\n// Create a query client\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      refetchOnWindowFocus: false,\n      staleTime: 1000 * 60 * 5, // 5 minutes\n    },\n  },\n});\n\n// Create a simple mock for useTelegram if the actual module is not available\nconst useTelegram = () => {\n  return {\n    tg: window.Telegram?.WebApp,\n    initWebApp: () => {\n      console.log(\"Mock initWebApp called\");\n      if (window.Telegram?.WebApp) {\n        // Use type assertion to avoid TypeScript errors\n        (window.Telegram.WebApp as any).ready?.();\n      }\n    },\n    getUserData: () => {\n      console.log(\"Mock getUserData called\");\n      if (window.Telegram?.WebApp?.initDataUnsafe?.user) {\n        return window.Telegram.WebApp.initDataUnsafe.user;\n      }\n      \n      // Try to get from localStorage as fallback\n      try {\n        const storedUser = localStorage.getItem('telegramUser');\n        if (storedUser) {\n          return JSON.parse(storedUser);\n        }\n      } catch (e) {\n        console.error(\"Error retrieving user data from localStorage:\", e);\n      }\n      \n      return null;\n    }\n  };\n};\n\n/**\n * TelegramInitializer component\n * This component handles initialization of the Telegram WebApp\n * and sets up navigation behavior and theme handling\n */\nconst TelegramInitializer = ({ children }: { children: React.ReactNode }) => {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const { updateTelegramUser } = useUser();\n  const [initialized, setInitialized] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Import the useTelegram hook\n  const { tg, initWebApp, getUserData } = useTelegram();\n  \n  // Initialize the referral system\n  const { referralCode, isProcessing: isProcessingReferral } = useReferral();\n  \n  // Check user registration status\n  const { isNewUser } = useRegistration({\n    onNewUser: (isNew) => {\n      if (isNew && referralCode) {\n        console.log(`New user registered with referral code: ${referralCode}`);\n        toast.success('Добро пожаловать! Вас пригласил друг.');\n      }\n    }\n  });\n\n  // Setup theme change listener for instant theme updates\n  useEffect(() => {\n    // Setup the theme change listener\n    const cleanupThemeListener = setupThemeChangeListener();\n    \n    // Clean up when component unmounts\n    return () => {\n      cleanupThemeListener();\n    };\n  }, []);\n\n  // Check user existence in the API\n  const checkUserInAPI = useCallback(async () => {\n    try {\n      const userResponse = await checkUserExists(true);\n      console.log(\"API user check result:\", userResponse);\n      \n      if (userResponse && typeof userResponse !== 'boolean') {\n        // Show welcome toast for new users getting 500 DD coins with a delay\n        if (userResponse.is_new_client && userResponse.dd_coins_balance === 500) {\n          // Add a delay to ensure the toast appears after the app has loaded\n          setTimeout(() => {\n            toast.success(\n              \"Добро пожаловать! Только что начислили вам 500 $DD коинов в честь нашего знакомства!\",\n              { duration: 6000 }\n            );\n          }, 1500); // 1.5 second delay to ensure visibility\n        }\n      }\n    } catch (error) {\n      console.error(\"Error checking user in API:\", error);\n    }\n  }, []);\n\n  // Initialize Telegram WebApp\n  const initializeTelegram = useCallback(async () => {\n    if (initialized) return;\n    \n    console.log(\"Initializing Telegram interface...\");\n    \n    // Check if we're in Telegram\n    const isTelegramBrowser = navigator.userAgent.toLowerCase().includes('telegram') || \n                             window.location.href.includes('tgwebapp');\n    \n    if (isTelegramBrowser) {\n      console.log(\"Running in Telegram browser\");\n    } else {\n      console.log(\"Not running in Telegram browser\");\n    }\n    \n    try {\n      // CRITICAL: Initialize the WebApp FIRST using the direct method\n      if (tg) {\n        // Initialize using the useTelegram hook\n        initWebApp();\n        \n        // Apply Telegram colors based on user's theme\n        setTelegramColors();\n        \n        // Request the current theme to ensure we have the latest\n        requestTelegramTheme();\n        \n        // Wait a moment for Telegram to initialize\n        // This is important for Mini Apps to receive initData\n        await new Promise(resolve => setTimeout(resolve, 300));\n        \n        // Try to get user data using the useTelegram hook\n        const userData = getUserData();\n        \n        if (userData) {\n          console.log(\"User data retrieved:\", userData);\n          updateTelegramUser(userData);\n          \n          // Check if user exists in the API system\n          await checkUserInAPI();\n          \n          setInitialized(true);\n          setIsLoading(false);\n        } else if (isTelegramBrowser) {\n          console.log(\"No user data available despite being in Telegram browser\");\n          \n          // Try one more time after a delay\n          // This is sometimes necessary as Telegram might not provide the data immediately\n          setTimeout(() => {\n            const retryUserData = getUserData();\n            if (retryUserData) {\n              console.log(\"User data retrieved after delay:\", retryUserData);\n              updateTelegramUser(retryUserData);\n            } else {\n              console.log(\"Still no user data after retry. This might indicate:\");\n              console.log(\"1. The Mini App is not properly configured in BotFather\");\n              console.log(\"2. The user is not using the official Telegram app\");\n              console.log(\"3. There's an issue with the initData validation\");\n              \n              // Try to use localStorage as a last resort\n              try {\n                const storedUser = localStorage.getItem('telegramUser');\n                if (storedUser) {\n                  const parsedUser = JSON.parse(storedUser);\n                  console.log(\"Using stored user data from localStorage:\", parsedUser);\n                  updateTelegramUser(parsedUser);\n                }\n              } catch (e) {\n                console.error(\"Error retrieving user data from localStorage:\", e);\n              }\n            }\n            setInitialized(true); // Mark as initialized anyway to prevent further attempts\n            setIsLoading(false);\n          }, 800);\n        } else {\n          console.log(\"Not in Telegram browser, continuing without user data\");\n          setInitialized(true);\n          setIsLoading(false);\n        }\n      } else {\n        // Fallback to the old method if tg is not available\n        console.log(\"Telegram WebApp is not available, using fallback method\");\n        initTelegramWebApp();\n        \n        // Apply Telegram colors based on user's theme\n        setTelegramColors();\n        \n        // Wait a moment for Telegram to initialize\n        await new Promise(resolve => setTimeout(resolve, 300));\n        \n        // Try to get user data using the old method\n        const userData = getTelegramUser();\n        \n        if (userData) {\n          console.log(\"User data retrieved using fallback method:\", userData);\n          updateTelegramUser(userData);\n        }\n        \n        setInitialized(true);\n        setIsLoading(false);\n      }\n    } catch (error) {\n      console.error(\"Error during Telegram initialization:\", error);\n      setInitialized(true); // Mark as initialized to prevent further attempts\n      setIsLoading(false);\n    }\n  }, [initialized, updateTelegramUser, tg, initWebApp, getUserData, checkUserInAPI]);\n\n  // Handle back button functionality\n  useEffect(() => {\n    // Hide back button on specific pages\n    const hideBackButtonPages = ['/', '/calculator', '/shop'];\n    if (hideBackButtonPages.includes(location.pathname)) {\n      console.log(\"Hiding back button for path:\", location.pathname);\n      hideBackButton();\n    } else {\n      console.log(\"Showing back button for path:\", location.pathname);\n      showBackButton(() => {\n        console.log(\"Back button pressed, navigating back\");\n        navigate(-1); // Go back to previous page\n      });\n    }\n    \n    // Clean up when component unmounts\n    return () => {\n      hideBackButton();\n    };\n  }, [location.pathname, navigate]);\n\n  // Listen for theme changes\n  useEffect(() => {\n    console.log(\"Setting up theme change listener\");\n    \n    // Request the theme from Telegram\n    requestTelegramTheme();\n    \n    // Apply Telegram colors based on user's theme\n    setTelegramColors();\n    \n    // Set up listener that will adapt to theme changes\n    const themeChangeHandler = () => {\n      console.log(\"Theme change detected, adapting to user theme\");\n      setTelegramColors();\n    };\n    \n    // Add event listener for theme changes\n    window.addEventListener('themechange', themeChangeHandler);\n    \n    // Return cleanup function\n    return () => {\n      window.removeEventListener('themechange', themeChangeHandler);\n    };\n  }, []);\n\n  useEffect(() => {\n    initializeTelegram().finally(() => {\n      // Set loading to false after initialization completes (success or failure)\n      setIsLoading(false);\n    });\n  }, [initializeTelegram]);\n\n  // Show nothing while loading to prevent 404 page flash\n  if (isLoading) {\n    return <div className=\"min-h-screen flex items-center justify-center\">\n      <LoadingSpinner size=\"xl\" />\n    </div>;\n  }\n\n  return children;\n};\n\n// Main App component\nconst App = () => {\n  // Ensure we're using HashRouter for GitHub Pages compatibility\n  return (\n    <ThemeProvider defaultTheme=\"dark\" attribute=\"class\">\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <UserProvider>\n            <CartProvider>\n              <Toaster richColors closeButton position=\"top-center\" />\n              <HashRouter>\n                <ScrollToTop />\n                <TelegramInitializer>\n                  <Routes>\n                    <Route path=\"/\" element={<Home />} />\n                    <Route path=\"/shop\" element={<Shop />} />\n                    <Route path=\"/product/:productId\" element={<ProductDetails />} />\n                    <Route path=\"/profile\" element={<Profile />} />\n                    <Route path=\"/cart\" element={<Cart />} />\n                    <Route path=\"/calculator\" element={<DeliveryCalculator />} />\n                    <Route path=\"/settings\" element={<Settings />} />\n                    <Route path=\"*\" element={<NotFound />} />\n                  </Routes>\n                </TelegramInitializer>\n              </HashRouter>\n            </CartProvider>\n          </UserProvider>\n        </TooltipProvider>\n      </QueryClientProvider>\n    </ThemeProvider>\n  );\n};\n\nexport default App;\n","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App.tsx'\nimport './index.css'\nimport { TelegramProvider } from './contexts/TelegramContext'\nimport { setTelegramColors, requestTelegramTheme } from './utils/telegramUtils'\nimport { toast } from 'sonner'\n\n// Declare global toast property\ndeclare global {\n  interface Window {\n    toast: typeof toast;\n  }\n}\n\n// Apply theme immediately before rendering\nrequestTelegramTheme();\nsetTelegramColors();\n\n// Listen for Telegram events after page loads\nwindow.addEventListener('load', () => {\n  // Sync colors with Telegram theme\n  setTelegramColors();\n  \n  // Request current theme from Telegram\n  setTimeout(() => {\n    requestTelegramTheme();\n  }, 1000);\n});\n\n// Make toast globally available\nwindow.toast = toast;\n\nReactDOM.createRoot(document.getElementById(\"root\")!).render(\n  <TelegramProvider>\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>\n  </TelegramProvider>\n);\n"],"file":"assets/main-D88zhNrf.js"}