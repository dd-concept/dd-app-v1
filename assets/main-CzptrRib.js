const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-Db7P92LC.js","assets/vendor-R9Y6aq4i.css"])))=>i.map(i=>d[i]);
import{w as Ze,x as Xe,J as w,Z as $,z as et,y as Ee,O as pe,B as ze,r as m,j as e,u as Oe,a as ee,L as H,i as X,D as tt,o as fe,F as Ce,G as rt,I as st,X as de,v as ve,K as ot,S as Be,d as Re,M as at,t as nt,Q as lt,U as Fe,V as it,W as ct,Y as dt,c as ut,n as ge,_ as gt,$ as mt,a0 as pt,a1 as ft,a2 as ht,a3 as xt,a4 as bt,a5 as yt,a6 as wt,a7 as vt,a8 as jt,a9 as Z,aa as Nt,R as kt}from"./vendor-Db7P92LC.js";import{P as q,U as Le,S as _t,I as Tt,B as St,L as W,D as Et,a as Ct,b as At,c as Dt,R as Pt,O as It,d as Ut,C as $t,e as zt,f as Ot,T as Bt,g as Rt}from"./components-BQcFFwdk.js";import"./main-CzptrRib.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const g of a.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&n(g)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();function rs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ss(...t){return Ze(Xe(t))}const Ne=["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ˜","ðŸ˜’","ðŸ˜ž","ðŸ˜”","ðŸ˜Ÿ","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜©","ðŸ¥º","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ¤¯","ðŸ˜³","ðŸ¥µ","ðŸ¥¶","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¥","ðŸ˜“","ðŸ¤—","ðŸ¤”","ðŸ¤­","ðŸ¤«","ðŸ¤¥","ðŸ˜¶","ðŸ˜","ðŸ˜‘","ðŸ˜¬","ðŸ™„","ðŸ˜¯"],Ft=["ðŸ‘•","ðŸ‘š","ðŸ‘”","ðŸ‘—","ðŸ‘–","ðŸ§¥","ðŸ§¦","ðŸ‘Ÿ","ðŸ‘ž","ðŸ§¢","ðŸ‘’","ðŸŽ©","ðŸ§£","ðŸ§¤","ðŸ‘œ","ðŸ‘","ðŸ‘›","ðŸ‘“","ðŸ•¶ï¸","ðŸ¥¾","ðŸ¥¿","ðŸŒ‚","â˜‚ï¸","ðŸ’¼","ðŸŽ’","ðŸ‘‘","ðŸ’„","ðŸ’","ðŸ’Ž","âŒš","ðŸ§¸","ðŸ”®","ðŸ§©","ðŸ§¶","ðŸ§µ","ðŸ”­","ðŸ§¬","ðŸ”¬","ðŸ§ª","ðŸ“±","ðŸ’»","ðŸ–¥ï¸","ðŸ–±ï¸","ðŸ–¨ï¸","ðŸ“·","ðŸŽ®","ðŸŽ§","ðŸŽµ","ðŸ“š","âœï¸"],Lt=["ðŸŽ‰","ðŸŽŠ","ðŸŽ","ðŸŽˆ","ðŸŽ€","ðŸŽ","ðŸŽ‡","ðŸŽ†","âœ¨","ðŸ”¥","ðŸ’«","â­","ðŸŒŸ","ðŸ’¥","ðŸ’¯","ðŸ’¢","ðŸ’¦","ðŸ’¤","ðŸ’¨","ðŸ•Šï¸","ðŸ’","ðŸ’–","ðŸ’—","ðŸ’“","ðŸ’ž","ðŸ’•","â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š"],qt=()=>{const t=Math.floor(Math.random()*Ne.length);return Ne[t]},Wt=(t,r)=>{const s=Array.from(t).reduce((a,g)=>a+g.charCodeAt(0),0),n=r==="avatar"?Ne:r==="product"?Ft:Lt,o=s%n.length;return n[o]},K="https://v2786182.hosted-by-vdsina.ru/api/v1",te={PRODUCTS:15e3,ORDERS:12e3,PROFILE:12e3},xe={PRODUCTS_TTL:5*60*1e3,PROFILE_TTL:10*60*1e3,ORDERS_TTL:3*60*1e3},z={_store:new Map,get(t,r){const s=this._store.get(t);return s?Date.now()-s.timestamp>r?(this._store.delete(t),null):s.data:null},set(t,r){this._store.set(t,{data:r,timestamp:Date.now()})},invalidate(t){this._store.delete(t)},clear(){this._store.clear()}},Mt=t=>{console.error("API Error:",t);let r="An error occurred. Please try again.";if(t.response){const s=t.response.status;try{const n=t.response.data;n&&n.detail?r=`API Error (${s}): ${n.detail}`:r=`API Error (${s}): ${t.response.statusText}`}catch{r=`API Error (${s}): Could not parse error details`}}else t.request?r="Network Error: No response from server. Using cached data instead.":t instanceof Error&&(r=`Error: ${t.message}`);return r.includes("Using cached data")?w.info(r):w.error(r),Promise.reject(new Error(r))},R=(t="GET",r,s=te.PRODUCTS)=>{const n=new AbortController,o=setTimeout(()=>n.abort(),s),a={method:t,signal:n.signal,mode:"cors",headers:{Accept:"application/json",...r?{"Content-Type":"application/json"}:{}},...r?{body:JSON.stringify(r)}:{}};return{signal:n.signal,options:a,clearTimeout:()=>clearTimeout(o)}},Jt="modulepreload",Ht=function(t){return"/dd-app-v1/"+t},Ae={},Kt=function(r,s,n){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),u=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));o=Promise.allSettled(s.map(l=>{if(l=Ht(l),l in Ae)return;Ae[l]=!0;const i=l.endsWith(".css"),f=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const c=document.createElement("link");if(c.rel=i?"stylesheet":Jt,i||(c.as="script"),c.crossOrigin="",c.href=l,u&&c.setAttribute("nonce",u),document.head.appendChild(c),i)return new Promise((d,N)=>{c.addEventListener("load",d),c.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(g){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=g,window.dispatchEvent(u),!u.defaultPrevented)throw g}return o.then(g=>{for(const u of g||[])u.status==="rejected"&&a(u.reason);return r().catch(a)})};function M(){var t;if(typeof window<"u"&&((t=window.Telegram)!=null&&t.WebApp))return window.Telegram.WebApp}function Gt(){try{console.log("Initializing Telegram WebApp...");try{et.ready(),Ee.expand(),setTimeout(()=>{Ee.expand(),console.log("Secondary viewport expansion attempted")},100);const r=M();r&&r.requestFullscreen?(console.log("Requesting fullscreen using Telegram API..."),r.requestFullscreen(),r.onEvent("fullscreenChanged",()=>{console.log("Fullscreen state changed:",r.isFullscreen)}),r.onEvent("fullscreenFailed",()=>{console.log("Fullscreen request failed")}),r.onEvent("activated",()=>{console.log("Mini App activated")}),r.onEvent("deactivated",()=>{console.log("Mini App deactivated")}),r.onEvent("safeAreaChanged",()=>{console.log("Safe area changed:",r.safeAreaInset)}),r.onEvent("contentSafeAreaChanged",()=>{console.log("Content safe area changed:",r.contentSafeAreaInset)})):console.log("Telegram fullscreen API not available, using viewport expansion only"),console.log("Telegram WebApp initialized successfully using SDK")}catch(r){console.warn("SDK initialization failed, falling back to direct WebApp API:",r);const s=M();if(s)s.ready(),s.expand(),setTimeout(()=>{s.expand(),console.log("Secondary WebApp expansion attempted")},100),s.requestFullscreen?(console.log("Requesting fullscreen using Telegram API (fallback)..."),s.requestFullscreen(),s.onEvent("fullscreenChanged",()=>{console.log("Fullscreen state changed:",s.isFullscreen)}),s.onEvent("fullscreenFailed",()=>{console.log("Fullscreen request failed")}),s.onEvent("activated",()=>{console.log("Mini App activated")}),s.onEvent("deactivated",()=>{console.log("Mini App deactivated")}),s.onEvent("safeAreaChanged",()=>{console.log("Safe area changed:",s.safeAreaInset)}),s.onEvent("contentSafeAreaChanged",()=>{console.log("Content safe area changed:",s.contentSafeAreaInset)})):console.log("Telegram fullscreen API not available, using viewport expansion only"),console.log("Telegram WebApp initialized successfully using direct WebApp API");else throw new Error("Telegram WebApp is not available")}const t=document.querySelector('meta[name="viewport"]');t&&t.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),document.body.style.height="100vh",document.body.style.overflow="hidden",document.documentElement.style.height="100vh",document.documentElement.style.overflow="hidden"}catch(t){console.error("Error initializing Telegram WebApp:",t)}}function Qt(){try{const t=document.documentElement;t.classList.add("telegram-webview");const r=M(),s=$.isDark||(r==null?void 0:r.colorScheme)==="dark";s?(t.classList.add("dark"),t.classList.remove("light")):(t.classList.add("light"),t.classList.remove("dark")),console.log(`Theme set to ${s?"dark":"light"} mode`)}catch(t){console.error("Error setting theme class:",t)}}function oe(){var t,r,s;try{if(console.log("Attempting to get Telegram user data..."),(s=(r=(t=window.Telegram)==null?void 0:t.WebApp)==null?void 0:r.initDataUnsafe)!=null&&s.user){const n=window.Telegram.WebApp.initDataUnsafe.user;console.log("User data found in window.Telegram.WebApp.initDataUnsafe:",n);try{localStorage.setItem("telegramUser",JSON.stringify(n))}catch(o){console.error("Error storing user data in localStorage:",o)}return n}return console.log("No Telegram user data available from any source"),null}catch(n){return console.error("Error getting Telegram user:",n),null}}function Yt(t){var r,s,n,o;try{console.log("Showing back button");try{pe.offClick(()=>{})}catch{console.log("No existing back button handlers to remove")}if(pe.onClick(t),pe.show(),(s=(r=window.Telegram)==null?void 0:r.WebApp)!=null&&s.BackButton)try{window.Telegram.WebApp.BackButton.onClick(t),window.Telegram.WebApp.BackButton.show()}catch(a){console.error("Error using direct WebApp API for back button:",a)}console.log("Back button shown and callback registered")}catch(a){if(console.error("Error showing back button:",a),(o=(n=window.Telegram)==null?void 0:n.WebApp)!=null&&o.BackButton)try{window.Telegram.WebApp.BackButton.onClick(t),window.Telegram.WebApp.BackButton.show(),console.log("Back button shown using direct WebApp API")}catch(g){console.error("Error using direct WebApp API for back button:",g)}}}function De(){var t,r,s,n;try{if(console.log("Hiding back button"),pe.hide(),(r=(t=window.Telegram)==null?void 0:t.WebApp)!=null&&r.BackButton)try{window.Telegram.WebApp.BackButton.hide()}catch(o){console.error("Error using direct WebApp API to hide back button:",o)}console.log("Back button hidden")}catch(o){if(console.error("Error hiding back button:",o),(n=(s=window.Telegram)==null?void 0:s.WebApp)!=null&&n.BackButton)try{window.Telegram.WebApp.BackButton.hide(),console.log("Back button hidden using direct WebApp API")}catch(a){console.error("Error using direct WebApp API to hide back button:",a)}}}function qe(t){var r,s,n;try{const o=M();o!=null&&o.postEvent?o.postEvent("web_app_trigger_haptic_feedback",JSON.stringify(t)):(s=(r=window.Telegram)==null?void 0:r.WebviewProxy)!=null&&s.postEvent?window.Telegram.WebviewProxy.postEvent("web_app_trigger_haptic_feedback",JSON.stringify(t)):(n=window.TelegramWebviewProxy)!=null&&n.postEvent?window.TelegramWebviewProxy.postEvent("web_app_trigger_haptic_feedback",JSON.stringify(t)):console.warn("No method available to send haptic feedback event")}catch(o){console.error("Error sending haptic feedback event:",o)}}const os=(t="medium")=>{try{try{ze.impactOccurred(t),console.log(`Haptic impact triggered via SDK: ${t}`)}catch(r){console.warn("SDK haptic impact failed, falling back to direct WebApp API:",r),qe({type:"impact",impact_style:t}),console.log(`Haptic impact triggered via WebApp API: ${t}`)}}catch(r){console.error("Error triggering haptic impact:",r)}},G=()=>{try{try{ze.selectionChanged(),console.log("Haptic selection triggered via SDK")}catch(t){console.warn("SDK haptic selection failed, falling back to direct WebApp API:",t),qe({type:"selection_change"}),console.log("Haptic selection triggered via WebApp API")}}catch(t){console.error("Error triggering haptic selection:",t)}};function ue(){try{console.log("Requesting current theme from Telegram");try{const r=$.isDark;console.log("Using current theme params, isDark:",r);return}catch(r){console.warn("SDK theme params access failed, trying fallback method:",r)}const t=M();if(!t){console.warn("Telegram WebApp is not available, can't request theme");return}if(typeof t.postEvent!="function"){console.warn("postEvent is not available in this Telegram client"),Q();return}try{t.postEvent("web_app_request_theme"),console.log("Theme request sent successfully")}catch(r){console.warn("Error requesting theme using postEvent:",r),Q()}}catch(t){console.error("Error requesting Telegram theme:",t),Q()}}function Vt(){console.log("Setting up theme change listener for instant updates");const t=()=>{console.log("Theme change detected, updating colors and styles"),Qt(),Q()},r=M();if(r)try{return r.onEvent("themeChanged",t),window.addEventListener("themechange",t),()=>{try{r.offEvent("themeChanged",t)}catch(s){console.warn("Error removing Telegram theme listener:",s)}window.removeEventListener("themechange",t)}}catch(s){return console.error("Error setting up Telegram event listener:",s),window.addEventListener("themechange",t),()=>{window.removeEventListener("themechange",t)}}return window.addEventListener("themechange",t),()=>{window.removeEventListener("themechange",t)}}function Q(){var t,r,s,n,o,a,g,u,l;try{console.log("Setting Telegram Mini App colors based on Telegram's native theme");const i=M();let f,c,d,N,v,h,j,T;if(i){console.log("WebApp theme params:",i.themeParams),f=((t=i.themeParams)==null?void 0:t.bg_color)||(i.colorScheme==="dark"?"#271a28":"#ffffff"),c=((r=i.themeParams)==null?void 0:r.secondary_bg_color)||(i.colorScheme==="dark"?"#382639":"#f7f7f7"),d=((s=i.themeParams)==null?void 0:s.text_color)||(i.colorScheme==="dark"?"#ffffff":"#000000"),N=((n=i.themeParams)==null?void 0:n.hint_color)||(i.colorScheme==="dark"?"#7d7d7d":"#999999"),v=((o=i.themeParams)==null?void 0:o.link_color)||(i.colorScheme==="dark"?"#64baff":"#2481cc"),h=((a=i.themeParams)==null?void 0:a.button_color)||(i.colorScheme==="dark"?"#3390ec":"#2481cc"),j=((g=i.themeParams)==null?void 0:g.button_text_color)||"#ffffff",T=i.colorScheme==="dark",console.log("Using native Telegram theme colors:",{bgColor:f,secondaryBgColor:c,textColor:d,hintColor:N,linkColor:v,buttonColor:h,buttonTextColor:j,isDark:T});try{if(i.setHeaderColor?(i.setHeaderColor(c),console.log("Header color set using WebApp.setHeaderColor:",c)):(i.postEvent("web_app_set_header_color",JSON.stringify({color:c})),console.log("Header color set using postEvent:",c)),(u=window.Telegram)!=null&&u.WebApp){const b=window.Telegram.WebApp;typeof b.setHeaderColor=="function"&&(b.setHeaderColor(c),console.log("Header color set using global Telegram.WebApp.setHeaderColor"))}}catch(b){console.error("Error setting header color:",b);try{(l=window.Telegram)!=null&&l.WebApp&&typeof window.Telegram.WebApp.setHeaderColor=="function"&&(window.Telegram.WebApp.setHeaderColor("secondary_bg_color"),console.log("Header color set using color_key: secondary_bg_color"))}catch(k){console.error("All attempts to set header color failed:",k)}}try{i.setBackgroundColor?(i.setBackgroundColor(c),console.log("Background color set using WebApp.setBackgroundColor:",c)):(i.postEvent("web_app_set_background_color",JSON.stringify({color:c})),console.log("Background color set using postEvent:",c))}catch(b){console.error("Error setting background color:",b)}}else{console.log("WebApp not available, using SDK theme params"),f=$.backgroundColor||($.isDark?"#271a28":"#ffffff"),c=$.secondaryBackgroundColor||($.isDark?"#382639":"#f7f7f7"),d=$.textColor||($.isDark?"#ffffff":"#000000"),N=$.hintColor||($.isDark?"#7d7d7d":"#999999"),v=$.linkColor||($.isDark?"#64baff":"#2481cc"),h=$.buttonColor||($.isDark?"#3390ec":"#2481cc"),j=$.buttonTextColor||"#ffffff",T=!!$.isDark,console.log("Using SDK theme colors:",{bgColor:f,secondaryBgColor:c,textColor:d,hintColor:N,linkColor:v,buttonColor:h,buttonTextColor:j,isDark:T});try{Kt(async()=>{const{postEvent:b}=await import("./vendor-Db7P92LC.js").then(k=>k.ab);return{postEvent:b}},__vite__mapDeps([0,1])).then(({postEvent:b})=>{b("web_app_set_header_color",{color:c}),console.log("Header color set to match frontend background:",c,"via SDK"),b("web_app_set_background_color",{color:c}),console.log("Background color set to:",c,"via SDK")}).catch(b=>{console.error("Error importing SDK for postEvent:",b)})}catch(b){console.error("Error setting colors via SDK:",b)}}Zt(c,d,N,v,h,j,c,T),ue()}catch(i){console.error("Error setting Telegram colors:",i)}}function Zt(t,r,s,n,o,a,g,u){try{const l=u===!0,i=t,f=g;console.log(`Applying ${l?"dark":"light"} theme CSS with Telegram colors`),console.log(`Using main background color: ${i}`),console.log(`Using header background color: ${f}`);const c=document.documentElement;l?(c.classList.add("dark"),c.classList.remove("light")):(c.classList.add("light"),c.classList.remove("dark")),c.classList.add("telegram-webview");const d=document.createElement("style");d.textContent=`
      :root {
        --tg-theme-bg-color: ${f} !important;
        --tg-theme-secondary-bg-color: ${i} !important;
        --tg-theme-text-color: ${r} !important;
        --tg-theme-hint-color: ${s} !important;
        --tg-theme-link-color: ${n} !important;
        --tg-theme-button-color: ${o} !important;
        --tg-theme-button-text-color: ${a} !important;
        --tg-color-scheme: ${l?"dark":"light"} !important;
        
        --telegram-bg: ${i} !important;
        --telegram-header-bg: ${f} !important;
        --telegram-secondary-bg: ${f} !important;
        --telegram-text: ${r} !important;
        --telegram-hint: ${s} !important;
        --telegram-link: ${n} !important;
        --telegram-button: ${o} !important;
        --telegram-button-text: ${a} !important;
      }
      
      body, html, #root {
        background-color: ${i} !important;
        color: ${r} !important;
      }
      
      .${l?"dark":"light"} body, .${l?"dark":"light"} html, .${l?"dark":"light"} #root {
        background-color: ${i} !important;
      }
      
      /* Apply colors to common UI elements */
      .card, .popover, .dropdown-menu, .card-container {
        background-color: ${f} !important;
        color: ${r} !important;
        border: 1px solid ${l?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"} !important;
      }
      
      a {
        color: ${n} !important;
      }
      
      .hint, .text-muted {
        color: ${s} !important;
      }
      
      .btn-primary, .button-primary {
        background-color: ${o} !important;
        color: ${a} !important;
      }
      
      /* Search inputs and form controls */
      input, select, textarea {
        background-color: ${i} !important;
        color: ${r} !important;
        border-color: ${s}30 !important;
      }
      
      input:focus, select:focus, textarea:focus {
        border-color: ${o} !important;
        box-shadow: 0 0 0 2px ${o}30 !important;
      }
      
      /* Size selector buttons */
      .size-button {
        background-color: ${i} !important;
        color: ${r} !important;
        border-color: ${s}30 !important;
      }
      
      .size-button.selected {
        background-color: ${o}10 !important;
        color: ${o} !important;
        border-color: ${o} !important;
      }
      
      /* Bottom navigation bar - solid color matching the secondary background color */
      .bottom-nav-bar {
        background-color: ${f} !important;
        /* Remove border and shadow */
        border-top: none !important;
        box-shadow: none !important;
        /* Add a subtle top border for separation */
        border-top: 1px solid ${l?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"} !important;
      }
      
      /* Bottom navigation items */
      .bottom-nav-bar a {
        color: ${s} !important;
        padding: 8px 0 !important;
        transition: all 0.2s ease !important;
      }
      
      /* Active navigation items */
      .bottom-nav-bar a.active, 
      .bottom-nav-bar a.active svg,
      .bottom-nav-bar a[aria-current="page"],
      .bottom-nav-bar a[aria-current="page"] svg {
        color: ${o} !important;
      }
      
      /* Navigation item hover effect */
      .bottom-nav-bar a:hover {
        color: ${o}CC !important;
        transform: translateY(-2px) !important;
      }
      
      /* Badge styling */
      .bottom-nav-bar .badge {
        background-color: ${o} !important;
        color: ${a} !important;
      }
      
      /* Force styles for desktop view */
      @media (min-width: 768px) {
        body, html, #root, .telegram-webview, .dark body, .dark html, .dark #root {
          background-color: ${i} !important;
        }
        
        .bottom-nav-bar, .dark .bottom-nav-bar {
          background-color: ${f} !important;
          border-top: none !important;
          box-shadow: none !important;
        }
      }
    `;const N=document.getElementById("telegram-theme-style");if(N&&N.remove(),d.id="telegram-theme-style",document.head.appendChild(d),c.style.setProperty("--tg-theme-bg-color",f,"important"),c.style.setProperty("--tg-theme-secondary-bg-color",i,"important"),c.style.setProperty("--tg-theme-text-color",r,"important"),c.style.setProperty("--tg-theme-hint-color",s,"important"),c.style.setProperty("--tg-theme-link-color",n,"important"),c.style.setProperty("--tg-theme-button-color",o,"important"),c.style.setProperty("--tg-theme-button-text-color",a,"important"),c.style.setProperty("--tg-color-scheme",l?"dark":"light","important"),document.body.style.backgroundColor=i,document.body.style.setProperty("background-color",i,"important"),document.body.style.color=r,document.body.style.setProperty("color",r,"important"),document.getElementById("root")){const h=document.getElementById("root");h.style.backgroundColor=i,h.style.setProperty("background-color",i,"important")}const v=document.querySelector(".bottom-nav-bar");v&&(v.style.backgroundColor=f,v.style.setProperty("background-color",f,"important"),v.style.backdropFilter="none",v.style.setProperty("-webkit-backdrop-filter","none","important"),v.style.borderTop="none",v.style.setProperty("border-top","none","important"),v.style.boxShadow="none",v.style.setProperty("box-shadow","none","important")),document.documentElement.style.backgroundColor=i,document.documentElement.style.setProperty("background-color",i,"important"),console.log(`${l?"Dark":"Light"} theme CSS applied with Telegram colors`)}catch(l){console.error("Error applying theme CSS:",l)}}function me(t){var r;try{console.log("Opening URL in Telegram:",t);const s=M();if(s&&typeof s.openLink=="function"){s.openLink(t,{try_instant_view:!0}),console.log("URL opened using WebApp.openLink");return}if((r=window.Telegram)!=null&&r.WebApp){const n=window.Telegram.WebApp;if(typeof n.openLink=="function"){n.openLink(t,{try_instant_view:!0}),console.log("URL opened using global Telegram.WebApp.openLink");return}}console.warn("No Telegram-specific method available to open URL, falling back to window.open"),window.open(t,"_blank")}catch(s){console.error("Error opening URL in Telegram:",s),window.open(t,"_blank")}}function Xt(){try{const t=M();t&&t.requestFullscreen?(console.log("Requesting fullscreen mode..."),t.requestFullscreen()):console.warn("Telegram fullscreen API not available")}catch(t){console.error("Error requesting fullscreen:",t)}}function er(){try{const t=M();t&&t.exitFullscreen?(console.log("Exiting fullscreen mode..."),t.exitFullscreen()):console.warn("Telegram fullscreen API not available")}catch(t){console.error("Error exiting fullscreen:",t)}}function tr(){try{const t=M();return(t==null?void 0:t.isFullscreen)??!1}catch(t){return console.error("Error checking fullscreen status:",t),!1}}function rr(t,r,s,n){try{const o=M();if(!o)return console.warn("Telegram WebApp not available for event listeners"),()=>{};const a=[];if(t){const g=()=>t(o.isFullscreen??!1);o.onEvent("fullscreenChanged",g),a.push({event:"fullscreenChanged",handler:g})}return r&&(o.onEvent("fullscreenFailed",r),a.push({event:"fullscreenFailed",handler:r})),s&&(o.onEvent("activated",s),a.push({event:"activated",handler:s})),n&&(o.onEvent("deactivated",n),a.push({event:"deactivated",handler:n})),()=>{a.forEach(({event:g,handler:u})=>{o.offEvent(g,u)})}}catch(o){return console.error("Error setting up fullscreen event listeners:",o),()=>{}}}const We={PROFILE:t=>`profile_${t}`,RANK:t=>`rank_${t}`,DD_COINS:t=>`dd_coins_${t}`,DELIVERY_RATES:"delivery_rates"},F=()=>{try{const t=oe();if(t)return console.log("Using Telegram user data from telegramUtils"),t;if(window.Telegram&&window.Telegram.WebApp){const r=window.Telegram.WebApp.initDataUnsafe.user;if(r&&r.id)return r;console.warn("Telegram WebApp available but user data is invalid")}return console.error("No Telegram user data available"),null}catch(t){return console.error("Error getting Telegram user:",t),null}},ae=async(t=!0)=>{try{const r=F();if(!r)return console.error("No Telegram user data available for existence check"),!1;console.log(`Checking if user exists: ID=${r.id}, username=${r.username||"not set"}`);const s={telegram_user_id:r.id};r.username&&(s.telegram_username=r.username);const{options:n,clearTimeout:o}=R("POST",s,te.PROFILE);try{const a=await fetch(`${K}/users/check-exists`,n);if(o(),!a.ok){if(a.status===404)return console.log("User not found (404), considered as non-existent"),!1;const l=await a.text();let i;try{i=JSON.parse(l).detail||l}catch{i=l||`HTTP error ${a.status}`}throw new Error(i)}const g=await a.text(),u=JSON.parse(g);if(console.log("User existence check result:",u),u.dd_coins_balance!==void 0){const l=We.DD_COINS(r.id);z.set(l,u.dd_coins_balance)}return t?u:u.is_new_client}catch(a){return console.error("Error checking if user exists:",a),!1}}catch(r){return console.error("Error in checkUserExists:",r),!1}},Me=async t=>{try{const r=F(),s=t||(r?r.id:0),n=r?r.username||`user_${s}`:`user_${s}`;if(!s)throw console.error("No user ID available for profile check"),new Error("User ID required");return{telegram_username:n,rank:0,total_orders:0}}catch(r){return console.error("Error in legacy checkUserProfile:",r),{telegram_username:`user_${t||0}`,rank:0,total_orders:0}}},Je=async()=>{try{const t=F();if(!t||!t.id)return console.error("No Telegram user data available for getting DD coins balance"),0;const r=t.id;console.log(`Getting DD coins balance for user ID: ${r}`);const s=We.DD_COINS(r),n=z.get(s,xe.PROFILE_TTL);if(n!==null)return console.log("Using cached DD coins balance:",n),n;console.log("No cached DD coins balance, fetching from API...");const o=await ae(!0);if(o&&typeof o!="boolean"){const a=o.dd_coins_balance;return console.log("DD coins balance from user check:",a),z.set(s,a),a}return 0}catch(t){return console.error("Error getting DD coins balance:",t),0}},je=[{sku:"TS001-BLK",item_name:"Basic T-Shirt",color_code:"BLK",brand:"FashionBrand",description:"Original SKU: TS001-BLK",price_rub:500,sizes:[{size:"M",quantity:2},{size:"L",quantity:2}],photos:[{photo_url:"https://example.com/photos/ts001_front.jpg",photo_category:"front"},{photo_url:"https://example.com/photos/ts001_side.jpg",photo_category:"side"}]},{sku:"JN002-BLU",item_name:"Slim Jeans",color_code:"BLU",brand:"DenimCo",description:"Original SKU: JN002-BLU",price_rub:1200,sizes:[{size:"32",quantity:2}],photos:[{photo_url:"https://example.com/photos/jn002_front.jpg",photo_category:"front"}]},{sku:"SW003-RED",item_name:"Wool Sweater",color_code:"RED",brand:"WinterWear",description:"Original SKU: SW003-RED",price_rub:1500,sizes:[{size:"S",quantity:1},{size:"M",quantity:3}],photos:[{photo_url:"https://example.com/photos/sw003_front.jpg",photo_category:"front"}]}],he={PRODUCTS:"products",CATEGORIES:"categories"},Te=async()=>{var t;console.log("Fetching products...");try{const r=F(),s=r==null?void 0:r.id;s?console.log(`Found Telegram user ID: ${s}`):console.warn("No Telegram user ID available for products fetch");const n=z.get(he.PRODUCTS,xe.PRODUCTS_TTL);if(n)return console.log("Using cached products data"),n;console.log("No cached products, fetching from API...");const{options:o,clearTimeout:a}=R("GET",void 0,te.PRODUCTS);try{let g=`${K}/stock/in-stock`;s&&(g=`${g}?telegram_id=${s}`),console.log(`Making request to: ${g}`);const u=await fetch(g,o);if(a(),!u.ok){const c=await u.text();let d;try{d=JSON.parse(c).detail||c}catch{d=c||`HTTP error ${u.status}`}throw new Error(d)}const l=await u.text(),i=JSON.parse(l);if(console.log("Products fetched successfully, count:",((t=i.items)==null?void 0:t.length)||0),!i.items||!Array.isArray(i.items))return console.error("API returned invalid products data"),w.error("Invalid products data received from API"),je;const f=i.items.map(c=>{const d=typeof c.price_rub=="string"?parseFloat(c.price_rub.replace(/[^\d.-]/g,"")):Number(c.price_rub),N=Array.isArray(c.photos)?c.photos:[],v=Array.isArray(c.sizes)?c.sizes.map(h=>({...h,quantity:typeof h.quantity=="string"?parseInt(h.quantity,10):h.quantity})):[];return{...c,price_rub:isNaN(d)?0:d,photos:N,sizes:v}});return z.set(he.PRODUCTS,f),f}catch(g){return console.error("Error fetching products:",g),w.error(`Error loading products: ${g.message}`),je}}catch(r){return console.error("Error in fetchProducts:",r),w.error(`Error: ${r.message}`),je}},He=async()=>{var t;console.log("Fetching categories...");try{const r=z.get(he.CATEGORIES,xe.PRODUCTS_TTL);if(r)return console.log("Using cached categories data"),r;console.log("No cached categories, fetching from API...");const{options:s,clearTimeout:n}=R("GET",void 0,te.PRODUCTS);try{const o=await fetch(`${K}/stock/get-categories`,s);if(n(),!o.ok){const u=await o.text();let l;try{l=JSON.parse(u).detail||u}catch{l=u||`HTTP error ${o.status}`}throw new Error(l)}const a=await o.text(),g=JSON.parse(a);return console.log("Categories fetched successfully, count:",((t=g.categories)==null?void 0:t.length)||0),!g.categories||!Array.isArray(g.categories)?(console.error("API returned invalid categories data"),w.error("Invalid categories data received from API"),[]):(z.set(he.CATEGORIES,g.categories),g.categories)}catch(o){throw console.error("Error fetching categories:",o),o}}catch(r){return console.error("Failed to fetch categories:",r),Mt("Failed to fetch categories"),[]}},sr={ORDERS:t=>`orders_${t}`},Ke=async()=>{try{const t=F();if(!t||!t.id)return console.error("No user data available when fetching orders"),[];console.log(`Fetching orders for user ID: ${t.id}...`);const r=sr.ORDERS(t.id),s=z.get(r,xe.ORDERS_TTL);if(s)return console.log("Using cached orders data"),s;console.log("No cached orders, fetching from API...");const n={telegram_user_id:t.id},{options:o,clearTimeout:a}=R("POST",n,te.ORDERS);try{const g=await fetch(`${K}/users/orders`,o);if(a(),g.status===404)return console.log("User has no orders or not found in orders API"),z.set(r,[]),[];if(!g.ok){const i=await g.text();let f;try{f=JSON.parse(i).detail||i}catch{f=i||`HTTP error ${g.status}`}throw new Error(f)}const u=await g.text(),l=JSON.parse(u);return console.log("Orders fetched successfully:",l),!l.orders||!Array.isArray(l.orders)?(console.error("API returned invalid orders data"),[]):(z.set(r,l.orders),l.orders)}catch(g){return console.error("Error fetching orders:",g),g.message.includes("User not found")||w.error("Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·."),[]}}catch(t){return console.error("Error in fetchOrders:",t),t.message.includes("User not found")||w.error("Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·."),[]}},or=async(t,r)=>{try{return console.log(`[MOCK API] Added product to cart - Product ID: ${t}, Size: ${r}`),!0}catch(s){return console.error("Error adding product to cart:",s),!1}},ar=async(t,r,s)=>{try{let n=null;try{const f=localStorage.getItem("telegramUser");f&&(n=JSON.parse(f).id)}catch(f){console.error("Error retrieving user data from localStorage:",f)}const a={price_cny:t,shipping_type:r==="car"?"cargo":r==="plane"?"aero":r,category:s,telegram_id:n};console.log("Shipping calculation request:",a);const{options:g,clearTimeout:u}=R("POST",a,te.PRODUCTS),l=await fetch(`${K}/orders/calculate-shipping`,g);if(u(),console.log(`Response status: ${l.status} ${l.statusText}`),!l.ok){const f=await l.json().catch(()=>null);throw console.error("API response not OK:",l.status,l.statusText),console.error("Error data:",f),new Error(`Failed to calculate shipping: ${(f==null?void 0:f.message)||l.statusText}`)}const i=await l.json();return console.log("Shipping calculation response:",i),i.shipping_cost}catch(n){throw console.error("Error calculating shipping:",n),new Error(`Error calculating shipping: ${n.message}`)}},nr=async t=>{var r;try{if(!((r=t.items)!=null&&r.length))throw new Error("Order must contain at least one item");const s=t.items.map(l=>{if(l.item_type==="preorder"){if(!l.dewu_url)throw new Error("Preorder item must have a URL");if(!l.category_type)throw new Error("Preorder item must have a category type");if(!l.shipping_type)throw new Error("Preorder item must have a shipping type");if(!l.price_cny)throw new Error("Preorder item must have a price in CNY");const i=["Ð¾Ð±ÑƒÐ²ÑŒ","Ð¾Ð´ÐµÐ¶Ð´Ð°","Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹"];if(!i.includes(l.category_type))throw new Error(`Invalid category type for preorder. Must be one of: ${i.join(", ")}`);const f=["cargo","aero"];if(!f.includes(l.shipping_type))throw new Error(`Invalid shipping type for preorder. Must be one of: ${f.join(", ")}`);return{item_type:"preorder",dewu_url:l.dewu_url,size:l.size||"",price_cny:l.price_cny,category_type:l.category_type,shipping_type:l.shipping_type,quantity:l.quantity||1}}else{if(l.stock_id)return{item_type:"stock",stock_id:l.stock_id};if(!l.sku)throw new Error("Stock item must have a SKU");return{item_type:"stock",sku:l.sku,size:l.size||"",quantity:l.quantity||1}}});if((t.delivery_method==="courier"||t.delivery_method==="shipping")&&!t.delivery_address)throw new Error("Delivery address is required for courier or shipping delivery method");const n={telegram_user_id:t.telegram_user_id,items:s,delivery_method:t.delivery_method,delivery_address:t.delivery_address||"",promocode_text:t.promocode_text,dd_coins_amount:t.dd_coins_amount,final_price:t.final_price};console.log("Sending unified order request:",JSON.stringify(n,null,2));const{options:o,clearTimeout:a}=R("POST",n),g=await fetch(`${K}/orders/create-order`,o);if(a(),!g.ok){const l=await g.text();let i;try{i=JSON.parse(l).detail||l}catch{i=l}throw new Error(i)}return await g.json()}catch(s){throw console.error("Error creating unified order:",s),s}},as=async()=>{try{const{options:t,clearTimeout:r}=R("GET",void 0,te.PRODUCTS),s=await fetch(`${K}/orders/delivery-types`,t);if(r(),!s.ok){const o=await s.json().catch(()=>null);throw console.error("API response not OK:",s.status,s.statusText),console.error("Error data:",o),new Error(`Failed to fetch delivery types: ${(o==null?void 0:o.message)||s.statusText}`)}return(await s.json()).delivery_types||[]}catch(t){throw console.error("Error fetching delivery types:",t),t}},ke=async t=>{try{const r=F(),s=t||(r?r.id:null);if(!s)return console.error("No Telegram user ID available for client info"),w.error("User data not available"),null;console.log(`Fetching client info for Telegram ID: ${s}`);const{options:n,clearTimeout:o}=R("GET"),a=await fetch(`${K}/clients/by-telegram/${s}`,n);if(o(),!a.ok){if(a.status===404)return console.log("Client info not found (404)"),null;const l=await a.text();return console.error(`API Error (${a.status}): ${l}`),w.error("Failed to fetch client information"),null}const g=await a.text(),u=JSON.parse(g);return console.log("Client info fetched:",u),u}catch(r){return console.error("Error fetching client info:",r),w.error("Failed to fetch client information"),null}},lr=async(t,r,s,n)=>{try{const o=F();if(!o)return console.error("No Telegram user data available"),w.error("User data not available"),!1;console.log(`Updating client info for Telegram ID: ${o.id}`);const a={telegram_id:o.id};t&&(a.phone_number=t),r&&(a.email=r),s&&(a.address=s),n!==void 0&&(a.mailing_flg=n),console.log("Update client info request:",a);const{options:g,clearTimeout:u}=R("POST",a),l=await fetch(`${K}/clients/update-info`,g);if(u(),l.ok)return console.log(`Client info update successful with status: ${l.status}`),!0;{const i=await l.text();return console.error(`API Error (${l.status}): ${i}`),!1}}catch(o){return console.error("Error updating client info:",o),!1}},be=`${K}/referrals`,Pe=async(t=0)=>{try{const r=F();if(!r)return console.error("No Telegram user data available"),w.error("User data not available"),null;console.log(`Getting referral info for Telegram ID: ${r.id}`);const{options:s,clearTimeout:n}=R("GET"),o=await fetch(`${be}/info/${r.id}`,s);if(n(),!o.ok){const u=await o.text();if(console.error(`API Error (${o.status}): ${u}`),o.status===404){console.log("No referral code found, creating one...");const l=await Ie();if(l)return l;if(t===0)return console.log("Retrying to get referral info after creation..."),Pe(1)}return(t>0||o.status!==404)&&w.error("Failed to fetch referral information"),null}const a=await o.text(),g=JSON.parse(a);if(console.log("Referral info fetched:",g),!g.telegram_deep_link){if(console.error("API returned referral info without telegram_deep_link:",g),t===0){console.log("Attempting to create a new referral code due to missing link...");const u=await Ie();if(u&&u.telegram_deep_link)return u}return w.error("ÐžÑˆÐ¸Ð±ÐºÐ°: Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"),null}return g}catch(r){return console.error("Error fetching referral info:",r),t===0?(console.log("Retrying to get referral info after error..."),Pe(1)):(w.error("Failed to fetch referral information"),null)}},Ie=async()=>{try{const t=F();if(!t)return console.error("No Telegram user data available"),w.error("User data not available"),null;console.log(`Creating referral code for Telegram ID: ${t.id}`);const{options:r,clearTimeout:s}=R("POST",{telegram_id:t.id}),n=await fetch(`${be}/create`,r);if(s(),!n.ok){const g=await n.text();return console.error(`API Error (${n.status}): ${g}`),w.error("Failed to create referral code"),null}const o=await n.text(),a=JSON.parse(o);return console.log("Referral code created:",a),a.telegram_deep_link?a:(console.error("API returned created referral without telegram_deep_link:",a),w.error("ÐžÑˆÐ¸Ð±ÐºÐ°: Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ"),null)}catch(t){return console.error("Error creating referral code:",t),w.error("Failed to create referral code"),null}},ns=async()=>{try{const t=F();if(!t)return console.error("No Telegram user data available"),w.error("User data not available"),null;console.log(`Getting referral stats for Telegram ID: ${t.id}`);const{options:r,clearTimeout:s}=R("GET"),n=await fetch(`${be}/stats/${t.id}`,r);if(s(),!n.ok){const g=await n.text();return console.error(`API Error (${n.status}): ${g}`),w.error("Failed to fetch referral statistics"),null}const o=await n.text(),a=JSON.parse(o);return console.log("Referral stats fetched:",a),a}catch(t){return console.error("Error fetching referral stats:",t),w.error("Failed to fetch referral statistics"),null}},ls=async t=>{try{return!t||!t.telegram_deep_link?(console.error("Missing referral link:",t),w.error("ÐžÑˆÐ¸Ð±ÐºÐ°: Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"),!1):(console.log("Sharing referral link:",t.telegram_deep_link),navigator.share?(await navigator.share({title:"ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÐ¹ÑÑ Ðº DD:CONCEPT",text:`Ð”ÐµÑ€Ð¶Ð¸ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ DD:CONCEPT!
${t.telegram_deep_link}`,url:t.telegram_deep_link}),w.success("Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° DD Store ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð°"),!0):(await navigator.clipboard.writeText(t.telegram_deep_link),w.success("Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð² Ð±ÑƒÑ„ÐµÑ€ Ð¾Ð±Ð¼ÐµÐ½Ð°"),!0))}catch(r){console.error("Error sharing referral link:",r);try{if(t&&t.telegram_deep_link)return await navigator.clipboard.writeText(t.telegram_deep_link),w.success("Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð² Ð±ÑƒÑ„ÐµÑ€ Ð¾Ð±Ð¼ÐµÐ½Ð°"),!0;throw new Error("Missing referral link")}catch(s){return console.error("Clipboard error:",s),w.error("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÑÑÑ‹Ð»ÐºÐ¾Ð¹"),!1}}},ir=async t=>{try{const r=F();if(!r)return console.error("No Telegram user data available"),!1;console.log(`Registering referral for user ${r.id} with code ${t}`);const{options:s,clearTimeout:n}=R("POST",{telegram_id:r.id,referral_code:t}),o=await fetch(`${be}/register`,s);if(n(),!o.ok){const u=await o.text();return console.error(`API Error (${o.status}): ${u}`),!1}const a=await o.text(),g=JSON.parse(a);return console.log("Referral registration result:",g),g.success}catch(r){return console.error("Error registering referral:",r),!1}},_e={DD_COINS:t=>`dd_coins_${t}`,DD_COINS_TTL:5*60*1e3},cr=async t=>{const r=_e.DD_COINS(t),s=z.get(r,_e.DD_COINS_TTL);if(s!==null)return console.log("Using cached DD coins balance from optimized service:",s),s;try{const n=await Je();return z.set(r,n),n}catch(n){return console.error("Error fetching DD coins in optimized service:",n),0}},Ge=async t=>{console.log("Fetching initial data in parallel...");try{const r=await Promise.allSettled([Me(t),Ke(),Te(),cr(t)]),s=r[0].status==="fulfilled"?r[0].value:null,n=r[1].status==="fulfilled"?r[1].value:[],o=r[2].status==="fulfilled"?r[2].value:[],a=r[3].status==="fulfilled"?r[3].value:0;return r[0].status==="rejected"&&console.error("Failed to fetch profile:",r[0].reason),r[1].status==="rejected"&&console.error("Failed to fetch orders:",r[1].reason),r[2].status==="rejected"&&console.error("Failed to fetch products:",r[2].reason),r[3].status==="rejected"&&console.error("Failed to fetch DD coins balance:",r[3].reason),{profile:s,orders:n,products:o,ddCoinsBalance:a}}catch(r){return console.error("Error in parallel fetch:",r),w.error("Error loading data. Some features may be limited."),{profile:null,orders:[],products:[],ddCoinsBalance:0}}},dr=async t=>{try{Ge(t).then(()=>console.log("Background prefetch completed")).catch(r=>console.error("Background prefetch failed:",r));return}catch(r){console.error("Error starting prefetch:",r)}},ur=async t=>{try{const r=`profile_${t}`,s=`orders_${t}`,n=_e.DD_COINS(t);z.invalidate(r),z.invalidate(s),z.invalidate(n),z.invalidate("products"),await Ge(t),w.success("Data refreshed successfully")}catch(r){console.error("Error refreshing data:",r),w.error("Failed to refresh data")}},Qe=m.createContext(void 0),gr=({children:t})=>{const[r,s]=m.useState(null),[n,o]=m.useState(""),[a,g]=m.useState(""),[u,l]=m.useState(null),[i,f]=m.useState(qt()),[c,d]=m.useState(!0),[N,v]=m.useState(!1),h=m.useCallback(b=>{if(!b)return;console.log("Updating Telegram user data:",b),s(b),b.username?o(b.username):o(`user_${b.id}`);let k=b.first_name;b.last_name&&(k+=` ${b.last_name}`),g(k);try{localStorage.setItem("telegramUser",JSON.stringify(b)),localStorage.getItem("telegramUserData")&&localStorage.removeItem("telegramUserData")}catch{console.warn("Failed to store user data in localStorage")}const E=b.username||`user_${b.id}`;dr(E,b.id).then(()=>{j(E,b.id)}).catch(C=>{console.error("Error during prefetch:",C),j(E,b.id)})},[]),j=m.useCallback(async(b,k)=>{try{console.log("Checking user profile...");const E=await Me(b,k);console.log("User profile loaded"),l(E)}catch(E){console.error("Error fetching user profile:",E);const C={telegram_username:b,rank:1,total_orders:0};console.log("Using default profile"),l(C)}},[]),T=m.useCallback(async()=>{try{if(d(!0),r){const b=r.username||`user_${r.id}`;await ur(b,r.id),await j(b,r.id)}else w.error("No user data available for refresh")}catch(b){console.error("Error refreshing user data:",b),w.error(`Error refreshing data: ${b.message}`)}finally{d(!1)}},[r,j]);return m.useCallback(()=>{if(console.log("DEBUG - RAW TELEGRAM DATA:"),window.Telegram)if(console.log("window.Telegram exists"),window.Telegram.WebApp){if(console.log("window.Telegram.WebApp exists"),console.log("initData:",window.Telegram.WebApp.initData),window.Telegram.WebApp.initDataUnsafe)if(console.log("initDataUnsafe contents:",JSON.stringify(window.Telegram.WebApp.initDataUnsafe||{},null,2)),window.Telegram.WebApp.initDataUnsafe.user){const b=window.Telegram.WebApp.initDataUnsafe.user;return console.log("RAW USER OBJECT:",b),b}else console.log("No user data in initDataUnsafe");else console.log("No initDataUnsafe available");if(window.Telegram.WebApp.initData)try{const b=new URLSearchParams(window.Telegram.WebApp.initData);if(console.log("Parsed initData params:",Array.from(b.entries())),b.has("user"))try{const k=JSON.parse(decodeURIComponent(b.get("user")||"{}"));return console.log("User data parsed from initData:",k),k}catch(k){console.error("Error parsing user data from initData:",k)}else console.log("No user param in initData")}catch(b){console.error("Error parsing initData:",b)}else console.log("initData is empty")}else console.log("No WebApp in Telegram object");else console.log("No Telegram object in window");return null},[]),m.useEffect(()=>{if(N)return;(async()=>{try{d(!0),v(!0),console.log("Initializing user data...");const k=oe();if(k){console.log("User data retrieved from Telegram WebApp:",k),h(k),d(!1);return}try{const E=localStorage.getItem("telegramUser")||localStorage.getItem("telegramUserData");if(E){const C=JSON.parse(E);console.log("Using stored user data:",C),h(C),d(!1);return}}catch{console.warn("Failed to retrieve user data from localStorage")}try{const E=await F();if(E){console.log("User data retrieved from API:",E),h(E),d(!1);return}}catch(E){console.error("Error getting user data from API:",E)}console.log("No user data available, using default values"),o("guest"),g("Guest User"),d(!1)}catch(k){console.error("Error initializing user data:",k),o("guest"),g("Guest User"),d(!1)}})()},[h,N]),e.jsx(Qe.Provider,{value:{username:n,displayName:a,telegramUser:r,profile:u,avatarEmoji:i,loading:c,setUsername:o,setAvatarEmoji:f,updateTelegramUser:h,refreshUserData:T},children:t})},ye=()=>{const t=m.useContext(Qe);if(t===void 0)throw new Error("useUser must be used within a UserProvider");return t},Ye=m.createContext(void 0),mr=({children:t})=>{const[r,s]=m.useState([]),n=r.reduce((c,d)=>c+d.quantity,0),o=r.reduce((c,d)=>c+d.price*d.quantity,0);m.useEffect(()=>{const c=localStorage.getItem("cart");if(c)try{s(JSON.parse(c))}catch(d){console.error("Failed to parse cart from localStorage:",d)}},[]),m.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(r))},[r]);const a=(c,d)=>{s(N=>{const v=N.findIndex(h=>h.productId===c.id&&h.size===d);if(v>=0){const h=[...N];return h[v].quantity+=1,h}else return[...N,{productId:c.id,name:c.name,color:c.color,size:d,price:c.price,quantity:1,item_type:"stock",photo_url:c.photo_url}]})},g=c=>{const d=`preorder-${btoa(c.dewu_url)}-${c.size}`;s(N=>{const v=N.findIndex(h=>h.productId===d);if(v>=0){const h=[...N];return h[v].quantity+=1,h}else return[...N,{productId:d,name:c.name,color:"",size:c.size,price:c.price,quantity:1,item_type:"preorder",dewu_url:c.dewu_url,category_type:c.category_type,delivery_type:c.delivery_type,shipping_type:c.shipping_type,price_cny:c.price_cny,photo_url:c.photo_url}]})},u=(c,d)=>{s(N=>{const v=N.findIndex(h=>h.productId===c&&h.size===d);if(v>=0){const h=[...N];return h[v].quantity>1?h[v].quantity-=1:h.splice(v,1),h}return N})},l=(c,d,N)=>{s(v=>{const h=v.findIndex(j=>j.productId===c&&j.size===d);if(h>=0){const j=[...v];return N<=0?j.splice(h,1):j[h].quantity=N,j}else N>0&&console.warn("Attempted to update quantity for non-existent item");return v})},i=(c,d)=>{const N=r.find(v=>v.productId===c&&v.size===d);return N?N.quantity:0},f=()=>{s([])};return e.jsx(Ye.Provider,{value:{items:r,addToCart:a,addPreorderToCart:g,removeFromCart:u,clearCart:f,itemCount:n,totalPrice:o,updateQuantity:l,getItemQuantity:i},children:t})},we=()=>{const t=m.useContext(Ye);if(t===void 0)throw new Error("useCart must be used within a CartProvider");return t},pr=()=>{const[t,r]=m.useState(null),[s,n]=m.useState(!1),[o,a]=m.useState(!1);return m.useEffect(()=>{(()=>{try{const u=new URL(window.location.href),l=u.searchParams.get("ref"),i=u.searchParams.get("start");if(i&&i.startsWith("ref_")){const c=i.substring(4);if(c){console.log("Referral code detected from Telegram deep link:",c),r(c),u.searchParams.delete("start"),window.history.replaceState({},document.title,u.toString());return}}const f=window.location.pathname.split("/");if(f.length>=3&&f[1]==="ref"){const c=f[2];if(c){console.log("Referral code detected from path:",c),r(c);const d=window.location.pathname.replace(/\/ref\/[^\/]+/,"");window.history.replaceState({},document.title,d+window.location.search);return}}l&&(console.log("Referral code detected from query parameter:",l),r(l),u.searchParams.delete("ref"),window.history.replaceState({},document.title,u.toString()))}catch(u){console.error("Error detecting referral code:",u)}})()},[]),m.useEffect(()=>{(async()=>{if(!(!t||o||s)){n(!0);try{const u=JSON.parse(localStorage.getItem("processedReferrals")||"[]");if(u.includes(t)){console.log("Referral already processed:",t),a(!0),n(!1);return}await ir(t)&&(console.log("Referral registered successfully"),u.push(t),localStorage.setItem("processedReferrals",JSON.stringify(u))),a(!0)}catch(u){console.error("Error processing referral:",u)}finally{n(!1)}}})()},[t,o,s]),{referralCode:t,isProcessing:s,isProcessed:o}},fr=t=>{const[r,s]=m.useState(!1),[n,o]=m.useState(!1),[a,g]=m.useState(!1);return m.useEffect(()=>{(async()=>{if(!(a||n)){o(!0);try{if(!F()){console.log("No Telegram user available, cannot check registration status"),o(!1);return}const i=await ae(!0);if(console.log("User check response:",i),i&&typeof i!="boolean"){const f=i;s(f.is_new_client),f.is_new_client&&(t!=null&&t.onNewUser)&&t.onNewUser(!0)}else s(!1);g(!0)}catch(l){console.error("Error checking user registration:",l)}finally{o(!1)}}})()},[a,n,t]),{isNewUser:r,isChecking:n,hasChecked:a}},Ue=()=>{window.scrollTo(0,0),window.scrollTo({top:0,behavior:"auto"}),document.documentElement&&(document.documentElement.scrollTop=0),document.body&&(document.body.scrollTop=0),console.log("scrollToTop utility function executed")},hr=()=>{Ue();const r=[10,50,100,200,500].map(s=>setTimeout(Ue,s));return()=>r.forEach(s=>clearTimeout(s))},is="data:image/webp;base64,UklGRiwDAABXRUJQVlA4ICADAACQQwCdASpiAoUBPpFIoE0lpCMiIAgAsBIJaW7hcQEqxNZ99z/6/h/84fwCt/3P+5A8/5G0AJ7APfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D322aG7z1FT956ip+89RU/eeoqfvPUVM7PUVP3nqKn7z1FT956ip+89RU/eealYCrJtsBVk22AqybbAVZNtgKsm2vA+mHBi2Lckw/l5qYfL2kOjk+SgRyaIEdZNtgKsm2wFWTbYCrJtsBVk22ASNH6I6ybbAVZNtgKsm2wFWTbYCrJgaCrJtsBVk22AqybbAVZNtgKsm2wFM1Sqn8nbgw+TtwYfJ24MPk7cGHydtjJ9NtgKsm2wFWTbYCrJtsBVk22AqvAaI6ybamLOfNgKsm2wEcvDkCrJtqMrJtsBVk22AqybbAVZNtgKsm2wFWSJ6n8nbj5bFtwYfJ24MPl7SGHyduC/YqhJP5e2wFWTbYCrJtsBVk22Aqya7sPk7cHRy8ODD5O3Bh/Lckw+TtwYddUJJ/J24MPk7cGHyduDD5O3Bh8nbYzWTDkCOXtqYf021MWxblARyfNgI2wAA/v5r0AAAAAAAAAAAAAAPK6tAEMNI4DopnQ5qGV4JSELz2aXNZvl6qQPP1x3gAAAAZY8NwDoYIQBsBZDNHfON9N/b3wxoY0MaGNDGhjQxoY0MaGNDGhjQxoY0MdDBJNk1VAAAAAAY/N4vkUe78sBNR43M7wAAjnR/74MsGWDLBldgiWYOmlsWQqDb9N9+1vpv7e+GNDHQwSYU7wR+6vOjYAAAAtpp+s1vrfW+VqpT4qVjGhjQxoY0MY8VKfFSsY0MaGNDHQw0dec8TtSJvo+zd7p1Ou5snvdOp1/UmL4ZJKh1GFX7F0FVEOVal7TH0E+NjYTLdo7WQgAAAA==",re=()=>{const{pathname:t}=Oe();m.useEffect(()=>{const r=hr();return console.log(`useScrollToTop hook executed for path: ${t}`),r},[t])},xr="/dd-app-v1/assets/jointgbanner-z8r3ZTiB.webp",br="/dd-app-v1/assets/catsofa_banner-DZMOOpqY.webp",yr="/dd-app-v1/assets/ddcoins_banner-BdNzn1Na.webp",wr="/dd-app-v1/assets/calcbanner-DYKRYP7q.webp",vr="/dd-app-v1/assets/gotoshopbanner-BBwQ6dpk.webp",jr="/dd-app-v1/assets/sneakers_category_banner-DKr6-pVn.webp",Nr="/dd-app-v1/assets/clothes_category_banner-v623PAGN.webp",kr="/dd-app-v1/assets/jeans_category_banner-DZUGsAeq.webp",_r="/dd-app-v1/assets/belt_category_banner-hZV84ikf.webp",Tr="/dd-app-v1/assets/guide_story_preview-CxC0CQYN.png",Sr="/dd-app-v1/assets/story_rebuilt_1-BO3KpZdx.png",Er="/dd-app-v1/assets/Instagram%20story%20-%207-hiTFq4GM.png",Cr="/dd-app-v1/assets/Instagram%20story%20-%208-Bhp72jef.png",Ar="/dd-app-v1/assets/Frame%202669-qNoll5Bu.png",Dr="/dd-app-v1/assets/Instagram%20story%20-%2010-CbWqs2Yb.png",Pr="/dd-app-v1/assets/Instagram%20story%20-%2012-Dl_D5Klm.png",Ir="/dd-app-v1/assets/Instagram%20story%20-%2013-atwak8eX.png",Ur="/dd-app-v1/assets/Instagram%20story%20-%2014-C5BKq9qg.png",$r="/dd-app-v1/assets/Instagram%20story%20-%2016-nMDTbbna.png",zr="/dd-app-v1/assets/Instagram%20story%20-%2017-DZB4qRWz.png",Or=()=>{re();const{username:t,displayName:r,telegramUser:s,avatarEmoji:n,updateTelegramUser:o}=ye(),a=ee(),[g,u]=m.useState(0),[l,i]=m.useState(!1),[f,c]=m.useState(null),[d,N]=m.useState([]),v=[{id:"beginner-guide",title:"ÐšÑ€Ð°Ñ‚ÐºÐ¸Ð¹ Ð³Ð°Ð¹Ð´",previewImage:Tr,images:[Sr,Er,Cr],viewed:d.includes("beginner-guide")},{id:"faq",title:"FAQ",previewImage:Ar,images:[Ir,Dr,Pr,Ur,zr,$r],viewed:d.includes("faq")}],h=E=>{G();const C=v.find(A=>A.id===E);C&&c(C)};m.useEffect(()=>{s!=null&&s.id&&j(s.id)},[s]);const j=async E=>{if(E){i(!0);try{console.log(`Fetching DD coins for user ID: ${E}`);const C=await ae(!0);C&&typeof C!="boolean"?(console.log("Home page: DD coins balance received:",C.dd_coins_balance),u(C.dd_coins_balance),C.is_new_client&&C.dd_coins_balance===500&&setTimeout(()=>{w.success("Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ! Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾ Ð½Ð°Ñ‡Ð¸ÑÐ»Ð¸Ð»Ð¸ Ð²Ð°Ð¼ 500 $DD ÐºÐ¾Ð¸Ð½Ð¾Ð² Ð² Ñ‡ÐµÑÑ‚ÑŒ Ð½Ð°ÑˆÐµÐ³Ð¾ Ð·Ð½Ð°ÐºÐ¾Ð¼ÑÑ‚Ð²Ð°!",{duration:6e3})},1500)):(console.error("Failed to get DD coins balance from user check"),u(0))}catch(C){console.error("Error fetching DD coins balance:",C),w.error("Failed to load DD coins balance")}finally{i(!1)}}},T=[{image:yr,link:"/profile"},{image:xr,link:"https://t.me/dd_concept",external:!0},{image:br,link:"/shop?brand=Cat%26Sofa"}],b=(s==null?void 0:s.username)||t,k=E=>{E.preventDefault(),G(),a("/profile")};return e.jsxs(q,{fullHeight:!0,className:"p-4 pb-20",hideNavigation:!!f,children:[e.jsx("header",{className:"mb-6",children:e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center shrink-0 mr-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-telegram-blue/50 rounded-full blur-lg animate-pulse-slow"}),e.jsx("div",{className:"cursor-pointer",onClick:k,children:e.jsx(Le,{user:s,emoji:n,size:"lg",className:"relative z-10 hover-lift"})})]}),e.jsxs("div",{className:"flex flex-col items-center text-center mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400 truncate w-16",children:["@",b]}),e.jsx("span",{className:"text-xs font-medium text-telegram-blue",children:"DD:ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ"})]})]}),e.jsx("div",{className:"flex-1 overflow-x-auto no-scrollbar",children:e.jsx(_t,{stories:v,onStoryClick:h})})]})})}),f&&e.jsx(Tt,{story:f,onClose:()=>c(null)}),e.jsx("section",{className:"mb-8 animate-slide-up",children:e.jsx(St,{banners:T})}),e.jsxs("section",{className:"mb-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(H,{to:"/shop",className:"bg-cover bg-center rounded-lg p-4 h-full col-span-1 shadow-sm hover-lift flex flex-col justify-end",style:{backgroundImage:`url(${vr})`},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-medium text-white",children:"Ð—Ð°ÐºÐ°Ð·Ð°Ñ‚ÑŒ"}),e.jsx(X,{size:20,className:"text-white"})]})}),e.jsxs("div",{className:"col-span-1 space-y-4",children:[e.jsxs(H,{to:"/profile",className:"bg-telegram-blue text-white dark:bg-telegram-blue rounded-lg p-4 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1 flex flex-col justify-between",children:[e.jsx("h3",{className:"font-medium text-white",children:"$DD COINS:"}),e.jsx("div",{className:"text-4xl font-bold mb-1 text-white",children:l?e.jsx("div",{className:"flex items-center justify-center h-10",children:e.jsx(W,{size:"md",className:"text-white"})}):g||0}),e.jsx("p",{className:"text-xs text-white/80",children:"Ð‘Ð°Ð»Ð°Ð½Ñ Ð¸ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð°"}),e.jsx("div",{className:"flex justify-end mt-1",children:e.jsx(X,{size:20,className:"text-white"})})]}),e.jsx(Et,{})]})]}),e.jsxs(H,{to:"/calculator",onClick:()=>window.scrollTo(0,0),className:"w-full rounded-lg overflow-hidden relative hover-lift h-16 block mt-4",style:{backgroundImage:`url(${wr})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"}),e.jsxs("div",{className:"absolute inset-0 flex items-center p-4",children:[e.jsx("h3",{className:"font-medium text-white text-lg flex-1 text-center",children:"Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÑƒ"}),e.jsx(X,{className:"text-white",size:20})]})]})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-medium mb-4",children:"Ð§Ñ‚Ð¾ ÐºÑƒÐ¿Ð¸Ñ‚ÑŒ?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs(H,{to:"/shop?category=Ð¾Ð±ÑƒÐ²ÑŒ",className:"rounded-lg overflow-hidden relative hover-lift aspect-[5/3]",style:{backgroundImage:`url(${jr})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 w-full p-4 flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium text-white",children:"ÐšÑ€Ð¾ÑÑÐ¾Ð²ÐºÐ¸"}),e.jsx(X,{className:"text-white",size:20})]})]}),e.jsxs(H,{to:"/shop?category=Ð²ÐµÑ€Ñ…",className:"rounded-lg overflow-hidden relative hover-lift aspect-[5/3]",style:{backgroundImage:`url(${Nr})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 w-full p-4 flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium text-white",children:"Ð’ÐµÑ€Ñ…"}),e.jsx(X,{className:"text-white",size:20})]})]}),e.jsxs(H,{to:"/shop?category=Ð½Ð¸Ð·",className:"rounded-lg overflow-hidden relative hover-lift aspect-[5/3]",style:{backgroundImage:`url(${kr})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 w-full p-4 flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium text-white",children:"ÐÐ¸Ð·"}),e.jsx(X,{className:"text-white",size:20})]})]}),e.jsxs(H,{to:"/shop?category=Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹",className:"rounded-lg overflow-hidden relative hover-lift aspect-[5/3]",style:{backgroundImage:`url(${_r})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 w-full p-4 flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium text-white",children:"ÐÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹"}),e.jsx(X,{className:"text-white",size:20})]})]})]})]})]})},Br=t=>{const r=u=>/^[\d.,]+$/.test(u),s=u=>{const l={XXXS:1,XXS:2,XS:3,S:4,M:5,L:6,XL:7,XXL:8,XXXL:9,"3XS":1,"2XS":2,"3XL":9},i=u.toUpperCase().trim();return l[i]||999},n=t.filter(r),o=t.filter(u=>!r(u)),a=n.sort((u,l)=>parseFloat(u)-parseFloat(l)),g=o.sort((u,l)=>s(u)-s(l));return[...a,...g]},$e=["Ð¾Ð±ÑƒÐ²ÑŒ","Ð½Ð¸Ð·","Ð²ÐµÑ€Ñ…","Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹"],Rr=()=>{const[t,r]=tt();ee();const[s,n]=m.useState(""),[o,a]=m.useState([]),[g,u]=m.useState([]),[l,i]=m.useState([]),[f,c]=m.useState(!1),[d,N]=m.useState(!1),[v,h]=m.useState("category-asc");we(),re();const{data:j,isLoading:T,error:b,isError:k,refetch:E}=fe({queryKey:["products"],queryFn:Te,staleTime:5*60*1e3,retry:1,retryDelay:1e3});fe({queryKey:["categories"],queryFn:He,staleTime:5*60*1e3,retry:1,retryDelay:1e3}),m.useEffect(()=>{const p=t.get("brand"),_=t.get("category"),S=t.get("size"),B=t.get("search"),ce=t.get("sort");p&&u(p.split(",")),_&&i(_.split(",")),S&&a(S.split(",")),B&&n(B),ce&&["category-asc","category-desc","price-asc","price-desc"].includes(ce)&&h(ce)},[t]),m.useEffect(()=>{const p=new URLSearchParams;g.length>0&&p.set("brand",g.join(",")),l.length>0&&p.set("category",l.join(",")),o.length>0&&p.set("size",o.join(",")),s&&p.set("search",s),v!=="category-asc"&&p.set("sort",v),p.toString()!==t.toString()&&r(p)},[g,l,o,s,v,r,t]),m.useEffect(()=>{k&&b instanceof Error&&w.error(`Shop error: ${b.message}`)},[k,b]);const C=m.useMemo(()=>{if(!j)return[];const p=new Set;return j.forEach(_=>{Array.isArray(_.sizes)&&_.sizes.forEach(S=>{S.quantity>0&&p.add(S.size)})}),Array.from(p).sort()},[j]),A=m.useMemo(()=>{if(!j)return[];const p=new Set;return j.forEach(_=>{_.brand&&p.add(_.brand)}),Array.from(p).sort()},[j]),P=m.useMemo(()=>{if(!j)return[];const p=new Set;return j.forEach(_=>{_.category&&p.add(_.category)}),Array.from(p).sort()},[j]),I=p=>{a(_=>_.includes(p)?_.filter(S=>S!==p):[..._,p])},J=p=>{u(_=>_.includes(p)?_.filter(S=>S!==p):[..._,p])},U=p=>{i(_=>_.includes(p)?_.filter(S=>S!==p):[..._,p])},O=m.useMemo(()=>j?j.filter(p=>{const _=s===""||p.item_name.toLowerCase().includes(s.toLowerCase())||p.color_code.toLowerCase().includes(s.toLowerCase())||p.brand&&p.brand.toLowerCase().includes(s.toLowerCase()),S=o.length===0||Array.isArray(p.sizes)&&p.sizes.some(Se=>o.includes(Se.size)&&Se.quantity>0),B=g.length===0||p.brand&&g.includes(p.brand),ce=l.length===0||p.category&&l.includes(p.category);return _&&S&&B&&ce}):[],[j,s,o,g,l]),se=()=>{a([]),u([]),i([]),n("")},ne=p=>{a(_=>_.filter(S=>S!==p))},le=p=>{u(_=>_.filter(S=>S!==p))},ie=p=>{i(_=>_.filter(S=>S!==p))},Y=o.length>0||g.length>0||l.length>0||s.length>0,V=p=>{const _=$e.indexOf(p);return _!==-1?_:$e.length},y=m.useMemo(()=>O?[...O].sort((p,_)=>{if(v==="price-asc"){const S=typeof p.price_rub=="string"?parseFloat(p.price_rub):p.price_rub,B=typeof _.price_rub=="string"?parseFloat(_.price_rub):_.price_rub;return S-B}else if(v==="price-desc"){const S=typeof p.price_rub=="string"?parseFloat(p.price_rub):p.price_rub;return(typeof _.price_rub=="string"?parseFloat(_.price_rub):_.price_rub)-S}else if(v==="category-desc"){const S=V(p.category||"");return V(_.category||"")-S}else{const S=V(p.category||""),B=V(_.category||"");return S-B}}):[],[O,v]),x=()=>{N(!d)},D=p=>{h(p),N(!1)},L=p=>{switch(p){case"price-asc":return"ÐŸÐ¾ Ñ†ÐµÐ½Ðµ (Ð¾Ñ‚ Ð¼Ð¸Ð½. Ðº Ð¼Ð°ÐºÑ.)";case"price-desc":return"ÐŸÐ¾ Ñ†ÐµÐ½Ðµ (Ð¾Ñ‚ Ð¼Ð°ÐºÑ. Ðº Ð¼Ð¸Ð½.)";case"category-asc":return"ÐŸÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (Ð¾Ð±ÑƒÐ²ÑŒâ†’Ð½Ð¸Ð·â†’Ð²ÐµÑ€Ñ…â†’Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹)";case"category-desc":return"ÐŸÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹â†’Ð²ÐµÑ€Ñ…â†’Ð½Ð¸Ð·â†’Ð¾Ð±ÑƒÐ²ÑŒ)";default:return"ÐŸÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"}};return e.jsx(q,{className:"pb-20",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("header",{className:"mb-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h1",{className:"text-2xl font-semibold",children:"ÐœÐ°Ð³Ð°Ð·Ð¸Ð½"})}),e.jsx("div",{className:"mb-3 text-xs text-telegram-hint",children:e.jsxs("p",{className:"text-justify",children:["Ð’ ÑÑ‚Ð¾Ð¼ Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ Ð¿Ð¾ÐºÐ° ÐµÑÑ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ Ð² Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ð¸ Ð² ÐœÐ¾ÑÐºÐ²Ðµ. Ð”Ð»Ñ Ð·Ð°ÐºÐ°Ð·Ð° Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð¸Ð· Poizon Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ",e.jsx(H,{to:"/calculator",className:"text-telegram-button hover:underline",children:"Ñ€Ð°ÑÑÑ‡ÐµÑ‚ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸"})]})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ce,{size:20,className:"text-telegram-hint"})}),e.jsx("input",{type:"text",placeholder:"Ð˜ÑÐºÐ°Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹...",className:"w-full p-3 pl-10 pr-4 border border-telegram-hint/30 rounded-lg bg-telegram-bg text-telegram-text focus:outline-none focus:ring-2 focus:ring-telegram-button focus:border-transparent",value:s,onChange:p=>n(p.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{className:"flex items-center gap-2 text-sm text-telegram-text",onClick:()=>c(!f),children:[e.jsx(rt,{size:18,className:"text-telegram-hint"}),e.jsx("span",{children:f?"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹":"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹"})]}),e.jsxs("button",{className:"flex items-center gap-2 text-sm text-telegram-text",onClick:x,children:[e.jsx(st,{size:18,className:"text-telegram-hint"}),e.jsx("span",{children:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°"})]})]}),Y&&e.jsxs("button",{className:"flex items-center gap-1 text-xs text-red-500",onClick:se,children:[e.jsx(de,{size:14}),e.jsx("span",{children:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹"})]})]}),d&&e.jsxs("div",{className:"mb-4 p-4 bg-telegram-secondary-bg rounded-lg animate-slide-down space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2 text-telegram-text",children:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾:"}),e.jsx("div",{className:"flex flex-col gap-2",children:["category-asc","category-desc","price-asc","price-desc"].map(p=>e.jsx("button",{className:`px-3 py-2 text-sm rounded-lg text-left transition-colors ${v===p?"bg-telegram-button text-telegram-button-text":"bg-telegram-bg text-telegram-text hover:bg-telegram-bg/80"}`,onClick:()=>D(p),children:L(p)},p))})]}),Y&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[o.map(p=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-telegram-light text-telegram-blue text-xs rounded-full",children:[e.jsx(ve,{size:12}),"Ð Ð°Ð·Ð¼ÐµÑ€: ",p,e.jsx("button",{className:"ml-1",onClick:()=>ne(p),children:e.jsx(de,{size:12})})]},`filter-size-${p}`)),g.map(p=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-telegram-light text-telegram-blue text-xs rounded-full",children:[e.jsx(ve,{size:12}),"Ð‘Ñ€ÐµÐ½Ð´: ",p,e.jsx("button",{className:"ml-1",onClick:()=>le(p),children:e.jsx(de,{size:12})})]},`filter-brand-${p}`)),l.map(p=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-telegram-light text-telegram-blue text-xs rounded-full",children:[e.jsx(ve,{size:12}),"ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ: ",p,e.jsx("button",{className:"ml-1",onClick:()=>ie(p),children:e.jsx(de,{size:12})})]},`filter-category-${p}`)),s&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-telegram-light text-telegram-blue text-xs rounded-full",children:[e.jsx(Ce,{size:12}),'"',s,'"',e.jsx("button",{className:"ml-1",onClick:()=>n(""),children:e.jsx(de,{size:12})})]})]}),f&&e.jsxs("div",{className:"mb-4 p-4 bg-telegram-secondary-bg rounded-lg animate-slide-down space-y-4",children:[P.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2 text-telegram-text",children:"Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(p=>e.jsx("button",{className:`px-3 py-1 text-sm rounded-full border transition-colors ${l.includes(p)?"bg-telegram-button text-telegram-button-text border-telegram-button":"bg-telegram-bg text-telegram-text border-telegram-hint/30 hover:border-telegram-hint/50"}`,onClick:()=>U(p),children:p},p))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2 text-telegram-text",children:"Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ñƒ"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(p=>e.jsx("button",{className:`px-3 py-1 text-sm rounded-full border transition-colors ${o.includes(p)?"bg-telegram-button text-telegram-button-text border-telegram-button":"bg-telegram-bg text-telegram-text border-telegram-hint/30 hover:border-telegram-hint/50"}`,onClick:()=>I(p),children:p},p))})]}),A.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2 text-telegram-text",children:"Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð±Ñ€ÐµÐ½Ð´Ñƒ"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.map(p=>e.jsx("button",{className:`px-3 py-1 text-sm rounded-full border transition-colors ${g.includes(p)?"bg-telegram-button text-telegram-button-text border-telegram-button":"bg-telegram-bg text-telegram-text border-telegram-hint/30 hover:border-telegram-hint/50"}`,onClick:()=>J(p),children:p},p))})]})]})]}),k&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-300 rounded-lg mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-red-700",children:"Error Loading Products:"}),e.jsx("p",{className:"text-xs text-red-600",children:b instanceof Error?b.message:"Unknown error"})]}),T?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(W,{size:"lg"})}):k?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("h2",{className:"text-lg font-medium text-red-600 mb-2",children:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ"}),e.jsx("button",{className:"px-4 py-2 bg-telegram-blue text-white rounded-lg",onClick:()=>E(),children:"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ½Ð¾Ð²Ð°"})]}):O.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-700",children:"Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²Ð°ÑˆÐ¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð¸Ð»Ð¸ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ"}),Y&&e.jsx("button",{className:"mt-4 px-4 py-2 bg-telegram-blue text-white rounded-lg",onClick:se,children:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:y.map(p=>e.jsx(Ct,{product:p,className:"animate-fade-in"},p.sku))})]})})},Fr=()=>{const{productId:t}=ot(),r=ee(),{addToCart:s,updateQuantity:n,getItemQuantity:o}=we(),[a,g]=m.useState(""),{data:u,isLoading:l,error:i,isError:f,refetch:c}=fe({queryKey:["products"],queryFn:Te,staleTime:5*60*1e3,retry:1,retryDelay:1e3}),d=u==null?void 0:u.find(A=>A.sku===t),N=m.useMemo(()=>{if(!d)return[];if(Array.isArray(d.sizes)){const A=d.sizes.filter(P=>P.quantity>0).map(P=>P.size);return Br(A)}return[]},[d]);m.useEffect(()=>{N.length>0&&!a&&g(N[0])},[N,a]);const v=d?Wt(`${d.item_name}-${d.color_code}`,"product"):"ðŸ“¦",h=m.useMemo(()=>!d||!a?0:o(d.sku,a),[d,a,o]),j=m.useMemo(()=>!d||!d.photos?[]:Array.isArray(d.photos)?d.photos.map(A=>typeof A=="string"?A:A.photo_url||"").filter(A=>A):[],[d]),T=m.useMemo(()=>{if(!d||!a)return 0;const A=d.sizes.find(P=>P.size===a);return A?A.quantity:0},[d,a]),b=()=>{if(!d||!a)return;if(h>=T){w.error(`Ð˜Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ, Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ${T} ÑˆÑ‚. Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° ${a}`);return}G();const A=typeof d.price_rub=="string"?parseFloat(d.price_rub.replace(/[^\d.-]/g,"")):d.price_rub,P={id:d.sku,name:d.item_name,color:d.color_code,sizes:N,price:A,quantity:1,photo_url:j.length>0?j[0]:void 0};s(P,a),or(d.sku,a)},k=()=>{if(!(!d||!a)){if(h>=T){w.error(`Ð˜Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ, Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ${T} ÑˆÑ‚. Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° ${a}`);return}G(),n(d.sku,a,h+1)}},E=()=>{!d||!a||h<=0||(G(),n(d.sku,a,h-1))},C=()=>{G(),r("/cart")};return re(),l?e.jsx(q,{children:e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(W,{size:"lg"})})}):f||!d?e.jsx(q,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("h2",{className:"text-lg font-medium text-red-600 mb-2",children:f?"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¾Ð²Ð°Ñ€Ð°":"Ð¢Ð¾Ð²Ð°Ñ€ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:f?"ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ":"Ð­Ñ‚Ð¾Ñ‚ Ñ‚Ð¾Ð²Ð°Ñ€ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[f&&e.jsx("button",{className:"px-4 py-2 bg-telegram-blue text-white rounded-lg",onClick:()=>c(),children:"ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ"}),e.jsx("button",{className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg",onClick:()=>r("/shop"),children:"Ð’ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½"})]})]})}):e.jsx(q,{children:e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx(At,{photos:j,productName:d.item_name,fallbackEmoji:v}),e.jsxs("div",{className:"p-4 flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold mb-2",children:[d.brand," ",d.item_name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d.brand&&e.jsx(H,{to:`/shop?brand=${encodeURIComponent(d.brand)}`,className:"px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-xs rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:d.brand}),e.jsx("span",{className:"px-2 py-1 bg-telegram-light dark:bg-telegram-dark/20 text-telegram-blue dark:text-telegram-blue text-xs rounded-full",children:d.color_code})]})]}),e.jsxs("p",{className:"text-2xl font-bold text-telegram-blue",children:["â‚½",typeof d.price_rub=="string"?parseFloat(d.price_rub.replace(/[^\d.-]/g,"")).toLocaleString():d.price_rub.toLocaleString()]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð¼ÐµÑ€"}),e.jsx(Dt,{availableSizes:N,selectedSize:a,onChange:g})]}),e.jsx("div",{className:"mb-6",children:d.description&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"font-medium mb-2",children:"ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:d.description})]})}),e.jsx("div",{className:"h-2"}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-sidebar-primary border-t border-gray-200 dark:border-gray-800 pb-16",children:e.jsx("div",{className:"max-w-md mx-auto px-4 py-4",children:a&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium",children:["Ð Ð°Ð·Ð¼ÐµÑ€: ",a]}),o(d.sku,a)>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Ð’ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ðµ: ",o(d.sku,a)," ÑˆÑ‚."]})]}),o(d.sku,a)===0?e.jsxs("button",{onClick:b,disabled:!a||N.length===0,className:"w-full py-3 px-4 bg-telegram-blue text-white rounded-lg flex items-center justify-center gap-2 hover:bg-telegram-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Be,{size:20}),e.jsx("span",{children:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:C,className:"flex-1 py-3 px-4 bg-telegram-blue text-white rounded-lg flex items-center justify-center gap-2 hover:bg-telegram-dark transition-colors",children:[e.jsx(Re,{size:20}),e.jsx("span",{children:"ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ"})]}),e.jsxs("div",{className:"flex items-center justify-between border border-gray-200 dark:border-gray-700 rounded-lg p-1",children:[e.jsx("button",{onClick:E,className:"w-10 h-10 flex items-center justify-center text-telegram-text bg-gray-100 dark:bg-gray-800 rounded-md",children:e.jsx(at,{size:18})}),e.jsx("span",{className:"font-medium px-4",children:o(d.sku,a)}),e.jsx("button",{onClick:k,className:"w-10 h-10 flex items-center justify-center text-telegram-text bg-gray-100 dark:bg-gray-800 rounded-md",children:e.jsx(nt,{size:18})})]})]})]})})})]})]})})},Ve=m.createContext(null),Lr=({children:t})=>{var u,l,i;const r=typeof window<"u"?(u=window.Telegram)==null?void 0:u.WebApp:void 0,g={tg:r,onClose:()=>{r&&r.close()},onToggleButton:()=>{var f;(f=r==null?void 0:r.MainButton)!=null&&f.isVisible?r.MainButton.hide():r!=null&&r.MainButton&&r.MainButton.show()},initWebApp:()=>{console.log("Initializing Telegram WebApp with direct access..."),r?(r.ready(),console.log("Telegram WebApp initialized successfully")):console.error("Telegram WebApp is not available")},getUserData:()=>{var f;if((f=r==null?void 0:r.initDataUnsafe)!=null&&f.user){console.log("User data found in initDataUnsafe:",r.initDataUnsafe.user);try{localStorage.setItem("telegramUser",JSON.stringify(r.initDataUnsafe.user))}catch(c){console.error("Error storing user data in localStorage:",c)}return r.initDataUnsafe.user}console.log("No user data found in initDataUnsafe");try{const c=localStorage.getItem("telegramUser");if(c){const d=JSON.parse(c);return console.log("Using stored user data from localStorage:",d),d}}catch(c){console.error("Error retrieving user data from localStorage:",c)}return null},user:(l=r==null?void 0:r.initDataUnsafe)==null?void 0:l.user,queryId:(i=r==null?void 0:r.initDataUnsafe)==null?void 0:i.query_id};return e.jsx(Ve.Provider,{value:g,children:t})},qr=()=>{const t=m.useContext(Ve);if(!t)throw new Error("useTelegram must be used within a TelegramProvider");return t},Wr=()=>{const{username:t,displayName:r,telegramUser:s,profile:n,avatarEmoji:o,updateTelegramUser:a}=ye(),[g,u]=m.useState(!0),[l,i]=m.useState(0),[f,c]=m.useState(!1),[d,N]=m.useState(!1),v=ee(),{tg:h,initWebApp:j,getUserData:T}=qr();re(),m.useEffect(()=>{(async()=>{try{console.log("Initializing Telegram WebApp on Profile page..."),j();const J=T();if(J){console.log("Telegram user found on Profile page:",J),a(J);const U=await ae(!0);U&&typeof U!="boolean"?(u(!0),i(U.dd_coins_balance),c(!1)):u(!1)}else console.log("No Telegram user data found on Profile page"),setTimeout(async()=>{const U=T();if(U){console.log("Telegram user found after delay:",U),a(U);const O=await ae(!0);O&&typeof O!="boolean"?(u(!0),i(O.dd_coins_balance),c(!1)):u(!1)}else console.log("Still no Telegram user data after retry")},500)}catch(J){console.error("Error initializing Telegram on Profile page:",J)}})()},[a,j,T,h]);const{data:b,isLoading:k,error:E,isError:C,refetch:A}=fe({queryKey:["orders"],queryFn:Ke,staleTime:60*1e3,retry:1,retryDelay:1e3,enabled:g});if(k)return e.jsx(q,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(W,{size:"lg"})})});if(C&&E instanceof Error&&!E.message.includes("not found"))return e.jsx(q,{className:"pb-20",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("h2",{className:"text-lg font-medium text-red-600 dark:text-red-400 mb-2",children:"Error loading profile"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:E instanceof Error?E.message:"Please try again later"}),e.jsx("button",{className:"px-4 py-2 bg-telegram-blue text-white rounded-lg",onClick:()=>A(),children:"Retry"})]})});const P=b||[];return e.jsx(q,{className:"pb-32",children:e.jsxs("div",{className:"p-4 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Le,{user:s,emoji:o,size:"lg",className:"hover-lift"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:s!=null&&s.username?`@${s.username}`:r}),s&&e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[s.first_name," ",s.last_name||""]})]})]}),e.jsx("button",{onClick:()=>v("/settings"),className:"w-10 h-10 flex items-center justify-center rounded-full bg-telegram-light dark:bg-sidebar-accent hover:bg-telegram-secondary-bg dark:hover:bg-sidebar-primary transition-colors","aria-label":"Settings",children:e.jsx(lt,{size:20,className:"text-telegram-blue"})})]}),e.jsx("div",{className:"mb-8 bg-telegram-blue dark:bg-telegram-blue rounded-lg p-5 shadow-sm animate-slide-up text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{size:28,className:"text-yellow-400"}),e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"$DD Ð‘Ð°Ð»Ð°Ð½Ñ:"}),f?e.jsx(W,{size:"sm",className:"text-white ml-2"}):e.jsx("span",{className:"text-3xl font-bold text-white",children:l||0})]})]}),e.jsx("button",{onClick:()=>N(!0),className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors","aria-label":"DD Coins Information",children:e.jsx(it,{size:22})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-medium mb-4",children:"ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸ Ð´Ñ€ÑƒÐ·ÐµÐ¹"}),e.jsxs("div",{className:"bg-white dark:bg-sidebar-accent rounded-lg shadow-sm overflow-hidden",children:[e.jsx(Pt,{className:"animate-fade-in"}),e.jsx("div",{className:"p-4 border-b border-gray-100 dark:border-gray-800/50",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"*ÐŸÐ¾Ð´ÐµÐ»Ð¸ÑÑŒ ÑÐ²Ð¾ÐµÐ¹ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÑÑÑ‹Ð»ÐºÐ¾Ð¹ Ñ Ð´Ñ€ÑƒÐ·ÑŒÑÐ¼Ð¸ Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ð¹ Ð½Ð°Ð³Ñ€Ð°Ð´Ñƒ Ð² $DD, ÐºÐ¾Ð³Ð´Ð° Ð¾Ð½Ð¸ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÑ‚ÑÑ Ð¸ ÑÐ´ÐµÐ»Ð°ÑŽÑ‚ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸!"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8 animate-slide-up",children:[e.jsxs("div",{className:"bg-white dark:bg-sidebar-accent rounded-lg p-4 text-center shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-telegram-blue",children:P.length}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Ð’ÑÐµÐ³Ð¾ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²"})]}),e.jsxs("div",{className:"bg-white dark:bg-sidebar-accent rounded-lg p-4 text-center shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-telegram-blue",children:P.filter(I=>I.status==="delivered").length}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð½Ñ‹Ñ…"})]}),e.jsxs("div",{className:"bg-white dark:bg-sidebar-accent rounded-lg p-4 text-center shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-telegram-blue",children:P.filter(I=>I.status!=="delivered").length}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-medium mb-4",children:"Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²"}),b&&b.length>0?e.jsx("div",{className:"space-y-4",children:b.map(I=>e.jsx(It,{order:I},I.order_id))}):e.jsxs("div",{className:"p-6 text-center bg-telegram-secondary-bg rounded-lg",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Ð•Ñ‰Ðµ Ð½ÐµÑ‚ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Ð’Ñ‹ ÐµÑ‰Ðµ Ð½Ðµ ÑÐ´ÐµÐ»Ð°Ð»Ð¸ Ð½Ð¸ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð·Ð°ÐºÐ°Ð·Ð°. ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ Ð¸Ñ… Ð·Ð´ÐµÑÑŒ."}),e.jsx("button",{onClick:()=>v("/shop"),className:"px-4 py-2 bg-telegram-blue text-white rounded-lg",children:"Ð’ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½!"})]})]}),e.jsx("div",{className:"h-16"}),e.jsx(Ut,{isOpen:d,onClose:()=>N(!1)})]})})},cs=async t=>{try{const r=F();if(!r)throw new Error("No Telegram user data available");const{options:s,clearTimeout:n}=R("POST",{telegram_id:r.id,promocode_text:t}),o=await fetch(`${K}/promocodes/validate`,s);if(n(),!o.ok){const g=await o.text();throw new Error(g||"Failed to validate promocode")}return await o.json()}catch(r){throw console.error("Error validating promocode:",r),r}},ds=(t,r)=>{let s=t;if(r.discount_fixed>0&&(s=Math.max(0,s-r.discount_fixed)),r.discount_percent&&r.discount_percent!=="null"){const n=s*parseFloat(r.discount_percent)/100;s=Math.max(0,s-n)}return Math.round(s)},Mr=()=>{const{items:t,removeFromCart:r,clearCart:s}=we(),[n,o]=m.useState(!1),[a,g]=m.useState(!1),[u,l]=m.useState(!1),[i,f]=m.useState(),[c,d]=m.useState(0),[N,v]=m.useState(0),[h,j]=m.useState(0),[T,b]=m.useState(!1),[k,E]=m.useState(null),[C,A]=m.useState(null),[P,I]=m.useState(!1);re(),m.useEffect(()=>{const y=rr(x=>{I(x),console.log("Fullscreen state changed:",x)},()=>{console.log("Fullscreen request failed"),w.error("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð²Ð¾Ð¹Ñ‚Ð¸ Ð² Ð¿Ð¾Ð»Ð½Ð¾ÑÐºÑ€Ð°Ð½Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼")},()=>{console.log("App activated")},()=>{console.log("App deactivated")});return I(tr()),y},[]);const J=()=>{G(),P?er():Xt()};m.useEffect(()=>{(async()=>{if(oe()){b(!0);try{const D=await Je();v(D)}catch(D){console.error("Error fetching DD coins balance:",D)}finally{b(!1)}}})()},[]),m.useEffect(()=>{const y=t.reduce((x,D)=>x+(D.sale_price||D.price)*D.quantity,0);if(i){let x=y;if(i.discount_fixed&&(x=Math.max(0,x-i.discount_fixed)),i.discount_percent&&i.discount_percent!=="null"){const D=x*parseFloat(i.discount_percent)/100;x=Math.max(0,x-D)}k&&(x+=k.price_rub),d(Math.round(x))}else{let x=y;k&&(x+=k.price_rub),d(x)}j(0)},[t,i,k]);const U=Math.min(N,Math.floor(c*.5)),O=c-h,se=y=>{const x=parseInt(y.target.value);j(x),G()},ne=(y,x)=>{f(y),d(Math.round(x))},le=()=>{f(void 0),d(t.reduce((y,x)=>y+(x.sale_price||x.price)*x.quantity,0))},ie=async()=>{try{if(o(!0),t.length===0){w.error("Ð’Ð°ÑˆÐ° ÐºÐ¾Ñ€Ð·Ð¸Ð½Ð° Ð¿ÑƒÑÑ‚Ð°!"),o(!1);return}if(!oe()){w.error("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·"),o(!1);return}try{const x=await ke();A(x?{email:x.email||"",phone_number:x.phone_number||"",address:x.address||""}:null),l(!0),o(!1)}catch(x){console.error("Error getting client information:",x),w.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ."),o(!1)}}catch(y){console.error("Error in order creation process:",y),w.error(`Error: ${y.message}`),o(!1)}},Y=y=>{l(!1),y?E(y):alert("No delivery rate provided"),V(y)},V=async y=>{try{o(!0);const x=oe();if(!x){w.error("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·");return}const D=await ke(),L=t.map(S=>{if(S.item_type==="preorder"){let B=S.category_type;return B==="shoes"&&(B="sneakers"),{item_type:"preorder",dewu_url:S.dewu_url,size:S.size,category_type:B,shipping_type:S.shipping_type||(S.delivery_type==="cargo"?"cargo":"aero"),price_cny:S.price_cny||Math.round(S.price/12),quantity:S.quantity}}else return{item_type:"stock",stock_id:parseInt(S.productId)||void 0,sku:parseInt(S.productId)?void 0:S.productId,size:S.size,quantity:S.quantity}}),p={telegram_user_id:x.id,delivery_method:(y==null?void 0:y.delivery_type)||"self_pickup",delivery_address:(D==null?void 0:D.address)||"",promocode_text:i==null?void 0:i.promocode_text,dd_coins_amount:h,items:L,final_price:O};console.log("Creating unified order with data:",JSON.stringify(p));const _=await nr(p);_.success?(s(),w.success("Ð—Ð°ÐºÐ°Ð· ÑÐ¾Ð·Ð´Ð°Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾")):w.error(_.message||"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ.")}catch(x){console.error("Error creating order:",x),w.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð·Ð°ÐºÐ°Ð·Ð°. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ."),o(!1)}};return e.jsxs(q,{className:"pb-20",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð°"}),e.jsx("button",{onClick:J,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:P?"Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· Ð¿Ð¾Ð»Ð½Ð¾ÑÐºÑ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð°":"Ð’Ð¾Ð¹Ñ‚Ð¸ Ð² Ð¿Ð¾Ð»Ð½Ð¾ÑÐºÑ€Ð°Ð½Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼",children:P?e.jsx(ct,{size:20,className:"text-gray-600 dark:text-gray-300"}):e.jsx(dt,{size:20,className:"text-gray-600 dark:text-gray-300"})})]}),t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-gray-100",children:"Ð’Ð°ÑˆÐ° ÐºÐ¾Ñ€Ð·Ð¸Ð½Ð° Ð¿ÑƒÑÑ‚Ð°"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹ Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸"}),e.jsxs("div",{className:"mt-6 flex flex-col gap-3",children:[e.jsx(H,{to:"/shop",className:"inline-flex items-center justify-center px-4 py-3 text-sm font-medium text-telegram-blue bg-white border border-telegram-blue rounded-lg hover:bg-telegram-blue hover:text-white transition-colors",children:"ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ Ð¸Ð· Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ"}),e.jsx(H,{to:"/calculator",className:"inline-flex items-center justify-center px-4 py-3 text-sm font-medium text-telegram-blue bg-white border border-telegram-blue rounded-lg hover:bg-telegram-blue hover:text-white transition-colors",children:"Ð—Ð°ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ñ€ÑÐ¼Ð¸ÐºÐ¾Ð¼ Ñ Poizon"})]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"space-y-4",children:t.map(y=>e.jsx($t,{item:y,onRemove:()=>r(y.productId,y.size)},`${y.productId}-${y.size}`))}),e.jsxs("div",{className:"bg-white dark:bg-sidebar-accent rounded-lg p-4 shadow-sm mb-4 mt-6",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Ð£ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´?"}),e.jsx(zt,{originalPrice:t.reduce((y,x)=>y+(x.sale_price||x.price)*x.quantity,0),onPromocodeApplied:ne,onPromocodeRemoved:le,currentPromocode:i})]}),e.jsxs("div",{className:"bg-white dark:bg-sidebar-accent rounded-lg p-4 shadow-sm mb-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð·Ð°ÐºÐ°Ð·Ðµ"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ð¡ÑƒÐ¼Ð¼Ð° Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²"}),e.jsxs("span",{children:["â‚½",t.reduce((y,x)=>y+(x.sale_price||x.price)*x.quantity,0)]})]}),k&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ° (",k.delivery_type==="self_pickup"?"Ð¡Ð°Ð¼Ð¾Ð²Ñ‹Ð²Ð¾Ð·":k.delivery_type==="courier"?"ÐšÑƒÑ€ÑŒÐµÑ€":"ÐŸÐ¾Ñ‡Ñ‚Ð°",")"]}),e.jsx("span",{children:k.price_rub>0?`â‚½${k.price_rub.toLocaleString()}`:"Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð¾"})]}),i&&e.jsxs("div",{className:"flex justify-between text-telegram-blue",children:[e.jsx("span",{children:"Ð¡ÐºÐ¸Ð´ÐºÐ° Ð¿Ð¾ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñƒ"}),e.jsx("span",{children:i.discount_fixed?`-â‚½${i.discount_fixed}`:i.discount_percent&&i.discount_percent!=="null"?`-${i.discount_percent}%`:""})]}),N>0&&c>0&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{size:16,className:"text-yellow-500"}),e.jsx("span",{className:"font-medium",children:"DD ÐšÐ¾Ð¸Ð½Ñ‹"})]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Ð‘Ð°Ð»Ð°Ð½Ñ: ",N]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ DD ÐšÐ¾Ð¸Ð½Ñ‹ Ð´Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹"}),e.jsxs("span",{className:"text-telegram-blue",children:[h," ÐºÐ¾Ð¸Ð½Ð¾Ð² (-â‚½",h,")"]})]}),e.jsx("input",{type:"range",min:"0",max:U,value:h,onChange:se,className:"w-full",disabled:U<=0}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"0"}),e.jsxs("span",{children:["ÐœÐ°ÐºÑ: ",U," ÐºÐ¾Ð¸Ð½Ð¾Ð² (50% Ð¾Ñ‚ ÑÑƒÐ¼Ð¼Ñ‹)"]})]})]})]}),e.jsxs("div",{className:"flex justify-between font-medium pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{children:"Ð˜Ñ‚Ð¾Ð³Ð¾"}),e.jsxs("span",{children:["â‚½",O]})]})]}),e.jsx("button",{onClick:ie,disabled:n||a,className:"w-full mt-4 bg-telegram-blue text-white py-3 rounded-lg font-medium hover:bg-telegram-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n||a?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:"xs",inline:!0,className:"mr-2"}),a?"ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…...":"Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð°..."]}):"ÐžÑ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·"})]})]})]}),u&&e.jsx(Ot,{onComplete:Y,onCancel:()=>l(!1),clientInfo:C,orderSubtotal:t.reduce((y,x)=>y+(x.sale_price||x.price)*x.quantity,0),promocodeDiscount:i?{text:i.promocode_text,amount:i.discount_fixed||parseFloat(i.discount_percent||"0"),type:i.discount_fixed?"fixed":"percent"}:void 0,ddCoinsDiscount:h,finalPriceAfterDDCoins:O})]})},Jr=()=>{const t=ee();return e.jsx(q,{fullHeight:!0,children:e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 text-center",children:[e.jsx("div",{className:"text-8xl mb-4 animate-float",children:"ðŸ”"}),e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-6",children:"Oops! We couldn't find that page"}),e.jsx("button",{onClick:()=>t("/"),className:"px-6 py-3 bg-telegram-blue text-white rounded-lg hover:bg-telegram-dark transition-colors",children:"Return to Home"})]})})},Hr=t=>t.split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "),Kr=()=>{re();const{addPreorderToCart:t}=we(),[r,s]=m.useState(""),[n,o]=m.useState(""),[a,g]=m.useState("car"),[u,l]=m.useState(""),[i,f]=m.useState(""),[c,d]=m.useState(!1),[N,v]=m.useState(!1),[h,j]=m.useState([]),[T,b]=m.useState(!1),[k,E]=m.useState(""),[C,A]=m.useState(""),[P,I]=m.useState(null);m.useEffect(()=>{(async()=>{b(!0);try{const x=await He();j(x);const D=x.find(L=>L.name.toLowerCase()==="Ð¾Ð±ÑƒÐ²ÑŒ");D?o(D.name):x.length>0&&o(x[0].name)}catch(x){console.error("Failed to load categories:",x),w.error("Failed to load item categories")}finally{b(!1)}})()},[]);const J=async()=>{if(!r||k){w.error("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½ÑƒÑŽ Ñ†ÐµÐ½Ñƒ Ð´Ð»Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð°");return}if(!n){w.error("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ Ñ‚Ð¾Ð²Ð°Ñ€Ð°");return}const y=U(n);if(!y){w.error("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ‚Ð¸Ð¿ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸");return}d(!0);try{const x=parseInt(r),D=await ar(x,a,y);I(D)}catch(x){console.error("Error calculating shipping:",x),w.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð° Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸: ${x.message}`),I(null)}finally{d(!1)}},U=y=>y.toLowerCase(),O=y=>{const x=y.target.value;x&&!/^\d+$/.test(x)?E("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ†Ð¸Ñ„Ñ€Ñ‹"):E(""),s(x)},se=y=>{const x=y.target.value,D=ne(x),L=D||x;L&&!le(L)?A("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ"):A(""),l(D||x)},ne=y=>{const x=[/https?:\/\/dw4\.co\/[^\s]+/i,/https?:\/\/m\.dewu\.com\/[^\s]+/i,/https?:\/\/www\.dewu\.com\/[^\s]+/i,/https?:\/\/dewu\.com\/[^\s]+/i];for(const D of x){const L=y.match(D);if(L&&L[0])return console.log("Extracted DEWU URL:",L[0]),L[0]}return null},le=y=>{try{return new URL(y),!0}catch{return!1}},ie=y=>{G(),o(y.target.value),I(null)},Y=y=>{G(),g(y),I(null)},V=async()=>{if(!u){w.error("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ñ‚Ð¾Ð²Ð°Ñ€");return}if(C){w.error("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ñ‚Ð¾Ð²Ð°Ñ€");return}if(!P){w.error("Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ");return}const y=U(n);if(!y){w.error("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ‚Ð¸Ð¿ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸");return}v(!0);try{const x=r?parseInt(r):0;t({dewu_url:u,size:i||"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½",category_type:y,shipping_type:a==="car"?"cargo":"aero",price:P,price_cny:x,name:`ÐŸÑ€ÐµÐ´Ð·Ð°ÐºÐ°Ð· - ${y==="Ð¾Ð±ÑƒÐ²ÑŒ"?"ÐžÐ±ÑƒÐ²ÑŒ":y==="Ð¾Ð´ÐµÐ¶Ð´Ð°"?"ÐžÐ´ÐµÐ¶Ð´Ð°":y==="Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹"?"ÐÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹":n} - ${i||"Ð Ð°Ð·Ð¼ÐµÑ€ Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½"}`}),w.success("ÐŸÑ€ÐµÐ´Ð·Ð°ÐºÐ°Ð· Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ"),l(""),f(""),I(null)}catch(x){console.error("Error adding preorder to cart:",x),w.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð¿Ñ€ÐµÐ´Ð·Ð°ÐºÐ°Ð·Ð° Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ")}finally{v(!1)}};return e.jsx(q,{className:"pb-20",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ut,{className:"mr-2 text-telegram-blue",size:24}),e.jsx("h1",{className:"text-2xl font-semibold",children:"ÐšÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 mb-6",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"text-blue-600 dark:text-blue-400 mt-0.5",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"text-sm",children:e.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["Ð’ ÑÑ‚Ð¾Ð¼ Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² Ð·Ð°ÐºÐ°Ð· Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹ Ð¸Ð· POIZON. Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ñ€ÐµÐ´Ð·Ð°ÐºÐ°Ð· Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ.",e.jsx("br",{}),e.jsxs("a",{onClick:()=>me("https://telegra.ph/Ustanovka-POIZON-i-registraciya2-04-10"),className:"text-blue-800 dark:text-blue-200 font-medium hover:underline cursor-pointer flex items-center",children:["ÐšÐ°Ðº ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ POIZON? ",e.jsx(ge,{size:12,className:"ml-1"})]})," ",e.jsxs("a",{onClick:()=>me("https://telegra.ph/Poisk-i-kartochka-tovara-ceny-razmernaya-setka-i-sroki-dostavki-04-11"),className:"text-blue-800 dark:text-blue-200 font-medium hover:underline cursor-pointer flex items-center",children:["ÐšÐ°Ðº Ð¸ÑÐºÐ°Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹? ",e.jsx(ge,{size:12,className:"ml-1"})]})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Ð¦ÐµÐ½Ð° Ñ‚Ð¾Ð²Ð°Ñ€Ð° (ÑŽÐ°Ð½Ð¸)"}),e.jsx("input",{type:"text",value:r,onChange:O,placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ†ÐµÐ½Ñƒ Ð² ÑŽÐ°Ð½ÑÑ…",className:`w-full p-3 rounded-lg border ${k?"border-red-500":"border-gray-300 dark:border-gray-700"} bg-white dark:bg-sidebar-accent`}),k&&e.jsx("p",{className:"text-red-500 text-sm",children:k}),e.jsx("div",{className:"flex items-center text-xs text-telegram-hint",children:e.jsxs("a",{onClick:()=>me("https://telegra.ph/Poisk-i-kartochka-tovara-ceny-razmernaya-setka-i-sroki-dostavki-04-11"),className:"flex items-center text-telegram-link",children:["ÐšÐ°Ðº Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ†ÐµÐ½Ñƒ? ",e.jsx(ge,{size:12,className:"ml-1"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð°"}),e.jsx("select",{value:n,onChange:ie,className:"w-full p-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-sidebar-accent",disabled:T,children:T?e.jsx("option",{value:"",children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹..."}):h.length===0?e.jsx("option",{value:"",children:"ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹"}):h.map(y=>e.jsx("option",{value:y.name,children:Hr(y.name)},y.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Ð¢Ð¸Ð¿ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>Y("car"),className:`p-3 rounded-lg flex flex-col items-center justify-center ${a==="car"?"bg-telegram-blue text-white":"bg-white dark:bg-sidebar-accent border border-gray-300 dark:border-gray-700"}`,children:[e.jsx(gt,{size:24,className:"mb-2"}),e.jsx("span",{className:"font-medium",children:"ÐÐ²Ñ‚Ð¾Ð¼Ð¾Ð±Ð¸Ð»ÑŒ"}),e.jsx("span",{className:"text-xs mt-1 opacity-80",children:"21-35 Ð´Ð½ÐµÐ¹"})]}),e.jsxs("button",{type:"button",onClick:()=>Y("plane"),className:`p-3 rounded-lg flex flex-col items-center justify-center ${a==="plane"?"bg-telegram-blue text-white":"bg-white dark:bg-sidebar-accent border border-gray-300 dark:border-gray-700"}`,children:[e.jsx(mt,{size:24,className:"mb-2"}),e.jsx("span",{className:"font-medium",children:"Ð¡Ð°Ð¼Ð¾Ð»ÐµÑ‚"}),e.jsx("span",{className:"text-xs mt-1 opacity-80",children:"5-10 Ð´Ð½ÐµÐ¹"})]})]}),e.jsx("div",{className:"mt-2 text-xs text-telegram-hint",children:"* Ð£ÐºÐ°Ð·Ð°Ð½Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ñ‚ ÑÐºÐ»Ð°Ð´Ð° Ð² ÐšÐ¸Ñ‚Ð°Ðµ Ð´Ð¾ Ð Ð¾ÑÑÐ¸Ð¸. Ð¡Ñ€Ð¾Ðº Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ð´Ð¾ ÑÐºÐ»Ð°Ð´Ð° Ð² ÐšÐ¸Ñ‚Ð°Ðµ Ð²ÑÐµÐ³Ð´Ð° ÑƒÐºÐ°Ð·Ð°Ð½ Ð² ÑÐ°Ð¼Ð¾Ð¼ Poizon Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐµ Ñ Ñ†ÐµÐ½Ð¾Ð¹ Ñ‚Ð¾Ð²Ð°Ñ€Ð°."})]}),e.jsx("button",{type:"button",onClick:J,disabled:c||!r||!!k||!n,className:"w-full bg-green-600 text-white p-4 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:c?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:"xs",inline:!0,className:"mr-2"}),"Ð˜Ð´ÐµÑ‚ Ñ€Ð°ÑÑ‡ÐµÑ‚..."]}):"Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸"}),P!==null&&e.jsxs("div",{className:"mt-8 p-4 bg-telegram-secondary-bg rounded-lg",children:[e.jsx("h2",{className:"text-lg font-medium mb-2",children:"ÐŸÑ€ÐµÐ´Ð²Ð°Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð°:"}),e.jsxs("span",{className:"text-2xl font-bold text-telegram-blue",children:["â‚½",P.toLocaleString()]})]}),e.jsx("div",{className:"mt-4 text-xs text-telegram-hint",children:e.jsx("p",{children:"Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€Ð°, Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ð¸ ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ð¸"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° Ñ‚Ð¾Ð²Ð°Ñ€ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:u,onChange:se,placeholder:"Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÑÑ‹Ð»ÐºÑƒ Poizon (DEWU)",className:`w-full p-3 rounded-lg border ${C?"border-red-500":"border-gray-300 dark:border-gray-700"} bg-white dark:bg-sidebar-accent`}),C&&e.jsx("p",{className:"text-red-500 text-sm",children:C}),e.jsx("div",{className:"flex items-center text-xs text-telegram-hint",children:e.jsxs("a",{onClick:()=>me("https://telegra.ph/Gde-vzyat-ssylku-na-tovar-v-POIZON-05-10"),className:"flex items-center text-telegram-link",children:["ÐšÐ°Ðº Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ? ",e.jsx(ge,{size:12,className:"ml-1"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Ð Ð°Ð·Ð¼ÐµÑ€ (ÐÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)"}),e.jsx("input",{type:"text",value:i,onChange:y=>f(y.target.value),placeholder:"Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 42, XL Ð¸ Ñ‚.Ð´.",className:"w-full p-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-sidebar-accent"})]}),P!==null&&e.jsx("button",{onClick:V,disabled:N||!u||!!C,className:"w-full mt-4 bg-telegram-blue text-white py-3 rounded-lg font-medium hover:bg-telegram-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:"xs",inline:!0,className:"mr-2"}),"Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{size:20}),"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ"]})})]})]})})},Gr=()=>{const t=ee();ye(),re();const[r,s]=m.useState(""),[n,o]=m.useState(""),[a,g]=m.useState(""),[u,l]=m.useState(!0),[i,f]=m.useState(!1),[c,d]=m.useState(!0),[N,v]=m.useState(!1);m.useState("light"),m.useState(!1),m.useEffect(()=>{(async()=>{d(!0);try{const T=await ke();T&&(s(T.email||""),o(T.phone_number||""),g(T.address||""),l(T.mailing_flg!==void 0?T.mailing_flg:!0))}catch(T){console.error("Error loading client info:",T)}finally{d(!1)}})()},[]);const h=async j=>{j.preventDefault(),f(!0);try{if(!r.trim()){w.error("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ email"),f(!1);return}if(!n.trim()){w.error("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð½Ð¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð°"),f(!1);return}if(!a.trim()){w.error("ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð°Ð´Ñ€ÐµÑ"),f(!1);return}await lr(n,r,a,u)&&t("/profile")}catch(T){console.error("Error saving settings:",T),w.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ.")}finally{f(!1)}};return e.jsx(q,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>t("/profile"),className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",children:e.jsx(pt,{size:18})}),e.jsx("h1",{className:"text-xl font-semibold",children:"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"})]}),c?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(W,{size:"md"})}):e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"ÐÐ´Ñ€ÐµÑ ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ð¹ Ð¿Ð¾Ñ‡Ñ‚Ñ‹ *"}),e.jsx("input",{id:"email",type:"email",value:r,onChange:j=>s(j.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-telegram-blue focus:border-telegram-blue dark:bg-gray-800",placeholder:"your@email.com",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"ÐÐ¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° *"}),e.jsx("input",{id:"phone",type:"tel",value:n,onChange:j=>o(j.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-telegram-blue focus:border-telegram-blue dark:bg-gray-800",placeholder:"+7 (999) 123-4567",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"address",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"ÐÐ´Ñ€ÐµÑ *"}),e.jsx("textarea",{id:"address",value:a,onChange:j=>g(j.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-telegram-blue focus:border-telegram-blue dark:bg-gray-800",placeholder:"Ð’Ð°Ñˆ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ",rows:3,required:!0})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{size:18,className:"text-gray-600 dark:text-gray-400"}),e.jsx("label",{htmlFor:"mailing",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"ÐŸÐ¾Ð»ÑƒÑ‡Ð°Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ"})]}),e.jsx("button",{type:"button",id:"mailing",onClick:()=>l(!u),className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors focus:outline-none focus:ring-2 focus:ring-telegram-blue focus:ring-offset-2 ${u?"bg-telegram-blue":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block w-4 h-4 transform transition-transform bg-white rounded-full ${u?"translate-x-6":"translate-x-1"}`})})]})}),e.jsx("button",{type:"submit",disabled:i,className:"w-full flex items-center justify-center gap-2 bg-telegram-blue text-white py-2 px-4 rounded-md hover:bg-telegram-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:"xs",inline:!0,className:"mr-2"}),"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{size:16}),"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"]})})]}),N&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(W,{size:"md"})})]})})},Qr=new xt({defaultOptions:{queries:{refetchOnWindowFocus:!1,staleTime:1e3*60*5}}}),Yr=()=>{var t;return{tg:(t=window.Telegram)==null?void 0:t.WebApp,initWebApp:()=>{var r,s,n;console.log("Mock initWebApp called"),(r=window.Telegram)!=null&&r.WebApp&&((n=(s=window.Telegram.WebApp).ready)==null||n.call(s))},getUserData:()=>{var r,s,n;if(console.log("Mock getUserData called"),(n=(s=(r=window.Telegram)==null?void 0:r.WebApp)==null?void 0:s.initDataUnsafe)!=null&&n.user)return window.Telegram.WebApp.initDataUnsafe.user;try{const o=localStorage.getItem("telegramUser");if(o)return JSON.parse(o)}catch(o){console.error("Error retrieving user data from localStorage:",o)}return null}}},Vr=({children:t})=>{const r=Oe(),s=ee(),{updateTelegramUser:n}=ye(),[o,a]=m.useState(!1),[g,u]=m.useState(!0),{tg:l,initWebApp:i,getUserData:f}=Yr(),{referralCode:c,isProcessing:d}=pr();fr({onNewUser:h=>{h&&c&&(console.log(`New user registered with referral code: ${c}`),w.success("Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ! Ð’Ð°Ñ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑÐ¸Ð» Ð´Ñ€ÑƒÐ³."))}}),m.useEffect(()=>{const h=Vt();return()=>{h()}},[]);const N=m.useCallback(async()=>{try{const h=await ae(!0);console.log("API user check result:",h),h&&typeof h!="boolean"&&h.is_new_client&&h.dd_coins_balance===500&&setTimeout(()=>{w.success("Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ! Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾ Ð½Ð°Ñ‡Ð¸ÑÐ»Ð¸Ð»Ð¸ Ð²Ð°Ð¼ 500 $DD ÐºÐ¾Ð¸Ð½Ð¾Ð² Ð² Ñ‡ÐµÑÑ‚ÑŒ Ð½Ð°ÑˆÐµÐ³Ð¾ Ð·Ð½Ð°ÐºÐ¾Ð¼ÑÑ‚Ð²Ð°!",{duration:6e3})},1500)}catch(h){console.error("Error checking user in API:",h)}},[]),v=m.useCallback(async()=>{if(o)return;console.log("Initializing Telegram interface...");const h=navigator.userAgent.toLowerCase().includes("telegram")||window.location.href.includes("tgwebapp");console.log(h?"Running in Telegram browser":"Not running in Telegram browser");try{if(l){i(),Q(),ue(),await new Promise(T=>setTimeout(T,300));const j=f();j?(console.log("User data retrieved:",j),n(j),await N(),a(!0),u(!1)):h?(console.log("No user data available despite being in Telegram browser"),setTimeout(()=>{const T=f();if(T)console.log("User data retrieved after delay:",T),n(T);else{console.log("Still no user data after retry. This might indicate:"),console.log("1. The Mini App is not properly configured in BotFather"),console.log("2. The user is not using the official Telegram app"),console.log("3. There's an issue with the initData validation");try{const b=localStorage.getItem("telegramUser");if(b){const k=JSON.parse(b);console.log("Using stored user data from localStorage:",k),n(k)}}catch(b){console.error("Error retrieving user data from localStorage:",b)}}a(!0),u(!1)},800)):(console.log("Not in Telegram browser, continuing without user data"),a(!0),u(!1))}else{console.log("Telegram WebApp is not available, using fallback method"),Gt(),Q(),await new Promise(T=>setTimeout(T,300));const j=oe();j&&(console.log("User data retrieved using fallback method:",j),n(j)),a(!0),u(!1)}}catch(j){console.error("Error during Telegram initialization:",j),a(!0),u(!1)}},[o,n,l,i,f,N]);return m.useEffect(()=>(["/","/calculator","/shop"].includes(r.pathname)?(console.log("Hiding back button for path:",r.pathname),De()):(console.log("Showing back button for path:",r.pathname),Yt(()=>{console.log("Back button pressed, navigating back"),s(-1)})),()=>{De()}),[r.pathname,s]),m.useEffect(()=>{console.log("Setting up theme change listener"),ue(),Q();const h=()=>{console.log("Theme change detected, adapting to user theme"),Q()};return window.addEventListener("themechange",h),()=>{window.removeEventListener("themechange",h)}},[]),m.useEffect(()=>{v().finally(()=>{u(!1)})},[v]),g?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(W,{size:"xl"})}):t},Zr=()=>e.jsx(bt,{defaultTheme:"dark",attribute:"class",children:e.jsx(yt,{client:Qr,children:e.jsx(Bt,{children:e.jsx(gr,{children:e.jsxs(mr,{children:[e.jsx(wt,{richColors:!0,closeButton:!0,position:"top-center"}),e.jsxs(vt,{children:[e.jsx(Rt,{}),e.jsx(Vr,{children:e.jsxs(jt,{children:[e.jsx(Z,{path:"/",element:e.jsx(Or,{})}),e.jsx(Z,{path:"/shop",element:e.jsx(Rr,{})}),e.jsx(Z,{path:"/product/:productId",element:e.jsx(Fr,{})}),e.jsx(Z,{path:"/profile",element:e.jsx(Wr,{})}),e.jsx(Z,{path:"/cart",element:e.jsx(Mr,{})}),e.jsx(Z,{path:"/calculator",element:e.jsx(Kr,{})}),e.jsx(Z,{path:"/settings",element:e.jsx(Gr,{})}),e.jsx(Z,{path:"*",element:e.jsx(Jr,{})})]})})]})]})})})})});ue();Q();window.addEventListener("load",()=>{Q(),setTimeout(()=>{ue()},1e3)});window.toast=w;Nt.createRoot(document.getElementById("root")).render(e.jsx(Lr,{children:e.jsx(kt.StrictMode,{children:e.jsx(Zr,{})})}));export{qt as a,Br as b,ss as c,os as d,Pe as e,ns as f,Wt as g,G as h,ls as i,as as j,ke as k,lr as l,is as m,ds as n,hr as o,rs as p,Ue as s,we as u,cs as v};
//# sourceMappingURL=main-CzptrRib.js.map
